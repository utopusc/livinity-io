---
phase: v1.1-05-ai-chat-redesign
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - livos/packages/ui/src/routes/ai-chat/index.tsx
autonomous: true

must_haves:
  truths:
    - "Conversation sidebar uses semantic surface/border/text tokens instead of raw white/XX opacity"
    - "Conversation items show relative timestamps (e.g. '5 minutes ago')"
    - "Active conversation item uses surface-3 background, inactive uses surface-1 on hover"
    - "Chat/MCP tab switcher uses brand border color for active state"
    - "User message bubbles use bg-brand (wallpaper-adaptive) instead of bg-blue-600"
    - "Assistant message bubbles use bg-surface-2 instead of bg-white/10"
    - "Tool call cards use semantic border-default, surface-base, and caption typography"
    - "Status indicator uses semantic surface-base and text-secondary tokens"
  artifacts:
    - path: "livos/packages/ui/src/routes/ai-chat/index.tsx"
      provides: "ConversationSidebar, ChatMessage, ToolCallDisplay, StatusIndicator with semantic tokens"
      contains: "formatDistanceToNow"
  key_links:
    - from: "index.tsx ConversationSidebar"
      to: "date-fns formatDistanceToNow"
      via: "import and usage on conv.updatedAt"
      pattern: "formatDistanceToNow.*updatedAt"
    - from: "index.tsx ChatMessage"
      to: "bg-brand"
      via: "user message bubble className"
      pattern: "bg-brand.*text-white"
    - from: "index.tsx"
      to: "cn utility"
      via: "import from @/shadcn-lib/utils"
      pattern: "import.*cn.*from.*shadcn-lib/utils"
---

<objective>
Migrate the AI chat sidebar (ConversationSidebar), message bubbles (ChatMessage), tool call display (ToolCallDisplay), and status indicator (StatusIndicator) in index.tsx to use semantic design tokens. Add relative timestamps to conversation items.

Purpose: The top half of the AI chat view (sidebar + messages) is the most visible part of the chat experience. Migrating these components first ensures the core conversation UI matches the refined design language from Phase 1.

Output: index.tsx lines 1-237 fully migrated to semantic tokens, with `cn()` utility and `formatDistanceToNow` imported.
</objective>

<execution_context>
@C:\Users\hello\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\hello\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP-v1.1.md
@.planning/STATE.md
@.planning/phases/v1.1-05-ai-chat-redesign/05-RESEARCH.md

Source file:
@livos/packages/ui/src/routes/ai-chat/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate ConversationSidebar to semantic tokens + add timestamps (AC-01)</name>
  <files>livos/packages/ui/src/routes/ai-chat/index.tsx</files>
  <action>
Add two imports at the top of the file:
- `import {cn} from '@/shadcn-lib/utils'` (after existing `@/` imports)
- `import {formatDistanceToNow} from 'date-fns'` (in the third-party imports section, after remark-gfm)

Migrate ConversationSidebar (lines 162-237) class strings. **Only modify className values, do not touch logic, state, props, or event handlers.**

Specific replacements in ConversationSidebar:

1. Sidebar container (line 163):
   - `border-r border-white/10 bg-black/20` -> `border-r border-border-default bg-surface-base`

2. Header border (line 164):
   - `border-b border-white/10` -> `border-b border-border-default`

3. Header title (line 169):
   - `text-sm font-semibold text-white/80` -> `text-body font-semibold text-text-primary`

4. New conversation button (line 173):
   - `rounded-lg p-1.5 text-white/60 transition-colors hover:bg-white/10 hover:text-white` -> `rounded-radius-sm p-1.5 text-text-secondary transition-colors hover:bg-surface-2 hover:text-text-primary`

5. View switcher border (line 181):
   - `border-b border-white/10` -> `border-b border-border-default`

6. Tab buttons (lines 184-185, 193-194) — convert from template literal to cn():
   - Active state: `border-b-2 border-violet-500 text-white` -> `border-b-2 border-brand text-text-primary`
   - Inactive state: `text-white/40 hover:text-white/60` -> `text-text-tertiary hover:text-text-secondary`
   - Base classes: `text-xs` -> `text-caption`

7. Empty conversations text (line 206):
   - `text-xs text-white/30` -> `text-caption text-text-tertiary`

8. Conversation item buttons (lines 212-213) — convert from template literal to cn():
   - Base: `rounded-lg` -> `rounded-radius-sm`
   - Active: `bg-white/15 text-white` -> `bg-surface-3 text-text-primary`
   - Inactive: `text-white/60 hover:bg-white/5 hover:text-white/80` -> `text-text-secondary hover:bg-surface-1 hover:text-text-primary`

9. Conversation title (line 217):
   - `text-xs` -> `text-caption`
   - Wrap in a container div for timestamp layout:
   ```tsx
   <div className='min-w-0 flex-1'>
     <span className='block truncate text-body-sm'>{conv.title}</span>
     <span className='text-caption-sm text-text-tertiary'>
       {formatDistanceToNow(conv.updatedAt, {addSuffix: true})}
     </span>
   </div>
   ```
   Remove the old standalone `<span className='flex-1 truncate text-xs'>{conv.title}</span>` and replace with the container div above.

10. Delete button (line 223):
    - `text-white/40 hover:text-red-400` -> `text-text-tertiary hover:text-red-400` (keep red for delete)

**Preserve:** Brand gradient on logo icon (`from-violet-500/30 to-blue-500/30`), `text-violet-400` on brand icon, `rounded-lg` on logo container (line 166). These are brand identity elements.

**Use cn() for all conditional class expressions** — convert template literal ternaries like:
```tsx
className={`base ${condition ? 'active' : 'inactive'}`}
```
to:
```tsx
className={cn('base', condition ? 'active' : 'inactive')}
```
  </action>
  <verify>
Run `npx tsc --noEmit --project livos/packages/ui/tsconfig.json` — no type errors.
Verify `formatDistanceToNow` import compiles correctly.
Search file for remaining `white/` patterns in lines 1-237 — should only find brand gradient values (`violet-500/30`, `blue-500/30`) and `text-violet-400`.
  </verify>
  <done>
ConversationSidebar fully uses semantic tokens. Conversation items show relative timestamps. Chat/MCP tab uses border-brand. No raw white/XX opacity values remain except brand gradients. cn() imported and used for all conditional classes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate ChatMessage, ToolCallDisplay, StatusIndicator to semantic tokens (AC-02, AC-05)</name>
  <files>livos/packages/ui/src/routes/ai-chat/index.tsx</files>
  <action>
Migrate ChatMessage (lines 70-108), ToolCallDisplay (lines 38-68), and StatusIndicator (lines 112-141). **Only modify className values.**

**ToolCallDisplay (lines 38-68):**

1. Tool card container (line 42):
   - `rounded-lg border border-white/10 bg-white/5 text-xs` -> `rounded-radius-sm border border-border-default bg-surface-base text-caption`

2. Expand button hover (line 45):
   - `hover:bg-white/5` -> `hover:bg-surface-1`

3. Tool name accent — KEEP `text-blue-400` (lines 48-49, semantic tool accent)

4. Status badge (line 50) — convert to cn():
   - `text-[10px]` -> `text-caption-sm`
   - Keep `text-green-400` / `text-red-400` (semantic status colors)
   - Convert: `` className={`ml-auto text-[10px] ${...}`} `` -> `className={cn('ml-auto text-caption-sm', ...)}`

5. Expanded section divider (line 55):
   - `border-t border-white/10` -> `border-t border-border-default`

6. Section labels (lines 56, 60):
   - `text-[10px] uppercase text-white/40` -> `text-caption-sm uppercase text-text-tertiary`

7. Pre content (lines 57, 61):
   - `text-white/60` -> `text-text-secondary`

**ChatMessage (lines 70-108):**

1. Message bubble (lines 82-83) — convert to cn():
   - `rounded-2xl` -> `rounded-radius-xl`
   - User: `bg-blue-600 text-white` -> `bg-brand text-white`
   - Assistant: `bg-white/10 text-white/90` -> `bg-surface-2 text-text-primary`

2. User message text (line 87):
   - `text-sm` -> `text-body`

3. Keep `prose prose-sm prose-invert max-w-none` for assistant markdown (line 89) — do NOT change prose classes.

4. User avatar (line 103):
   - `bg-white/20` -> `bg-surface-3`

5. User avatar icon (line 104):
   - `text-white/80` -> `text-text-primary`

6. Liv avatar — KEEP brand gradient (`from-violet-500/30 to-blue-500/30`) and `text-violet-400` (lines 76-77)

**StatusIndicator (lines 135-140):**

1. Status container (line 136):
   - `rounded-xl bg-white/5` -> `rounded-radius-md bg-surface-base`
   - `text-sm` -> `text-body`

2. Status text (line 138):
   - `text-white/50` -> `text-text-secondary`

3. Keep animated icon colors (`text-violet-400`, `text-purple-400`, `text-orange-400`, `text-blue-400`) — these are semantic tool status indicators.

**Use cn() for all conditional class expressions** in ChatMessage and ToolCallDisplay.
  </action>
  <verify>
Run `npx tsc --noEmit --project livos/packages/ui/tsconfig.json` — no type errors.
Search file for `bg-blue-600` — should not exist (replaced with bg-brand).
Search file for `bg-white/10` in lines 38-141 — should not exist (replaced with semantic tokens).
Search file for `text-white/` in lines 38-141 — should only find none (all replaced with semantic text tokens).
Verify `bg-brand` appears in ChatMessage user bubble.
  </verify>
  <done>
ChatMessage uses bg-brand for user bubbles and bg-surface-2 for assistant. ToolCallDisplay uses semantic border/surface/text tokens. StatusIndicator uses surface-base and text-secondary. All conditional classes use cn(). Brand gradients and semantic status colors preserved.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. `npx tsc --noEmit --project livos/packages/ui/tsconfig.json` passes
2. `grep -n 'white/' livos/packages/ui/src/routes/ai-chat/index.tsx | head -30` — lines 1-237 should only contain brand gradient values (violet-500/30, blue-500/30)
3. `grep -c 'cn(' livos/packages/ui/src/routes/ai-chat/index.tsx` — multiple cn() usages present
4. `grep 'formatDistanceToNow' livos/packages/ui/src/routes/ai-chat/index.tsx` — import and usage present
5. `grep 'bg-brand' livos/packages/ui/src/routes/ai-chat/index.tsx` — present for user message bubble
6. `grep 'border-brand' livos/packages/ui/src/routes/ai-chat/index.tsx` — present for active tab indicator
</verification>

<success_criteria>
- ConversationSidebar fully migrated to semantic tokens with relative timestamps
- ChatMessage user bubble uses bg-brand, assistant uses bg-surface-2
- ToolCallDisplay uses semantic tokens (border-default, surface-base, caption typography)
- StatusIndicator uses surface-base and text-secondary
- All conditional classes converted from template literals to cn()
- cn() and formatDistanceToNow properly imported
- Brand elements preserved (gradients, violet accents, status colors)
- No type errors introduced
</success_criteria>

<output>
After completion, create `.planning/phases/v1.1-05-ai-chat-redesign/05-01-SUMMARY.md`
</output>

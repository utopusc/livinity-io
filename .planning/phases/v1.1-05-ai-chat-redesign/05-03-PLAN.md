---
phase: v1.1-05-ai-chat-redesign
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - livos/packages/ui/src/routes/ai-chat/mcp-panel.tsx
autonomous: true

must_haves:
  truths:
    - "MCP panel header uses semantic surface/border/text tokens"
    - "MCP panel tab bar uses border-brand for active tab"
    - "Featured cards use semantic border-subtle, surface-base, text-primary typography"
    - "Marketplace search input uses semantic tokens with brand focus"
    - "Search results use semantic surface/border tokens"
    - "Install dialog uses bg-dialog-content instead of bg-[#111118]"
    - "Install dialog inputs use semantic border/surface/text with brand focus"
    - "Install dialog buttons use bg-brand instead of bg-violet-600"
    - "Installed tab server cards use semantic surface/border tokens"
    - "Installed tab expanded details use semantic text-tertiary labels"
    - "Config tab textarea and save button use semantic tokens"
    - "Category badge colors and status colors (green/red/amber) preserved"
    - "Featured card gradients preserved as brand identity"
  artifacts:
    - path: "livos/packages/ui/src/routes/ai-chat/mcp-panel.tsx"
      provides: "Complete MCP panel with semantic tokens"
      contains: "bg-brand"
  key_links:
    - from: "mcp-panel.tsx McpPanel"
      to: "semantic tokens"
      via: "border-border-default, bg-surface-base classes"
      pattern: "border-border-default"
    - from: "mcp-panel.tsx InstallDialog"
      to: "bg-dialog-content"
      via: "dialog background class"
      pattern: "bg-dialog-content"
    - from: "mcp-panel.tsx inputs"
      to: "brand focus"
      via: "focus-visible:border-brand class"
      pattern: "focus-visible:border-brand"
---

<objective>
Migrate the entire MCP panel (mcp-panel.tsx, 1,270 lines) to semantic design tokens. This is the largest file in the AI chat feature with ~81 raw opacity values across 5 sub-components.

Purpose: The MCP panel is a self-contained management interface for MCP servers. Migrating it to semantic tokens brings it in line with the refined design language, ensuring consistent visual treatment with the rest of the application.

Output: mcp-panel.tsx fully migrated to semantic tokens with consistent border/surface/text hierarchy.
</objective>

<execution_context>
@C:\Users\hello\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\hello\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP-v1.1.md
@.planning/STATE.md
@.planning/phases/v1.1-05-ai-chat-redesign/05-RESEARCH.md

Source file:
@livos/packages/ui/src/routes/ai-chat/mcp-panel.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate McpPanel header, tab bar, MarketplaceTab, and FeaturedCard (AC-06 part 1)</name>
  <files>livos/packages/ui/src/routes/ai-chat/mcp-panel.tsx</files>
  <action>
Add `import {cn} from '@/shadcn-lib/utils'` at the top of the file after the @tabler/icons-react import block.

Migrate McpPanel (lines 1182-1269), FeaturedCard (lines 364-415), and MarketplaceTab (lines 419-552). **Only modify className values, do not touch logic, state, props, event handlers, or data arrays (FEATURED_MCPS, CATEGORY_COLORS, ICON_MAP).**

**Opacity mapping reference (from research):**
- `white/[0.02]` or `white/[0.03]` -> `surface-base` (0.04)
- `white/[0.04]` or `white/[0.05]` -> `surface-1` (0.06)
- `white/[0.06]` -> `surface-1` (0.06)
- `white/[0.08]` or `white/[0.10]` -> `surface-2` (0.10)
- `white/[0.12]` or `white/[0.14]` -> `surface-3` (0.14)
- `border-white/[0.06]` -> `border-border-subtle` (0.06)
- `border-white/[0.08]` or `border-white/[0.10]` -> `border-border-default` (0.10)
- `border-white/[0.12]` or `border-white/[0.15]` -> `border-border-emphasis` (0.20)
- `hover:bg-white/[0.06]` -> `hover:bg-surface-1`
- `hover:bg-white/[0.08]` or `hover:bg-white/[0.10]` -> `hover:bg-surface-2`
- `hover:bg-white/[0.12]` or `hover:bg-white/[0.14]` -> `hover:bg-surface-3`
- `focus:border-white/[0.15]` -> `focus-visible:border-brand`
- `focus:bg-white/[0.05]` -> (remove, not needed with brand focus)
- `text-white/85` or `text-white/90` -> `text-text-primary`
- `text-white/70` or `text-white/80` -> `text-text-primary`
- `text-white/50` or `text-white/60` -> `text-text-secondary`
- `text-white/30` or `text-white/35` or `text-white/40` -> `text-text-tertiary`
- `text-white/15` or `text-white/20` or `text-white/25` -> `text-text-tertiary`
- `placeholder-white/20` or `placeholder-white/25` -> `placeholder-text-tertiary`
- `text-[10px]` -> `text-caption-sm`
- `text-[11px]` -> `text-caption-sm`
- `text-[12px]` -> `text-caption`
- `text-[13px]` -> `text-body-sm`
- `text-[14px]` -> `text-body`
- `rounded-2xl` -> `rounded-radius-xl`
- `rounded-xl` -> `rounded-radius-lg`
- `rounded-lg` -> `rounded-radius-sm`
- `rounded-md` -> `rounded-radius-sm`

**McpPanel main component (lines 1203-1268):**

1. Panel container (line 1204):
   - `bg-black/20` -> `bg-surface-base`

2. Header border (line 1206):
   - `border-b border-white/[0.06]` -> `border-b border-border-subtle`

3. Header icon container (line 1208):
   - `rounded-xl` -> `rounded-radius-lg`
   - Keep gradient `from-blue-500/20 to-violet-500/20` and `text-blue-400`

4. Panel title (line 1212):
   - `text-[14px] font-semibold text-white/85` -> `text-body font-semibold text-text-primary`

5. Panel description (line 1213):
   - `text-[11px] leading-relaxed text-white/35` -> `text-caption-sm leading-relaxed text-text-tertiary`

6. Tab bar border (line 1222):
   - `border-b border-white/[0.06]` -> `border-b border-border-subtle`

7. Tab buttons (lines 1227-1231) — convert to cn():
   - `text-[12px]` -> `text-caption`
   - Active: `border-b-2 border-violet-500 text-white/90` -> `border-b-2 border-brand text-text-primary`
   - Inactive: `text-white/30 hover:text-white/50` -> `text-text-tertiary hover:text-text-secondary`

**FeaturedCard (lines 376-414):**

1. Card container (line 377):
   - `rounded-2xl border border-white/[0.06] bg-white/[0.03] p-4 transition-all hover:border-white/[0.12] hover:bg-white/[0.05]`
   -> `rounded-radius-xl border border-border-subtle bg-surface-base p-4 transition-all hover:border-border-emphasis hover:bg-surface-1`

2. Icon container (line 379):
   - `rounded-xl` -> `rounded-radius-lg`
   - Keep gradient (`${mcp.gradient}`) and icon color

3. Icon text (line 380):
   - `text-white/80` -> `text-text-primary`

4. Display name (line 384):
   - `text-[13px] font-semibold text-white/90` -> `text-body-sm font-semibold text-text-primary`

5. Category badge (line 385):
   - `rounded-md` -> `rounded-radius-sm`
   - `text-[10px]` -> `text-caption-sm`
   - Keep `${catColor}` (CATEGORY_COLORS are domain-specific)

6. Description (line 389):
   - `text-xs leading-relaxed text-white/40` -> `text-caption leading-relaxed text-text-tertiary`

7. Package name (line 395):
   - `text-[10px] text-white/20` -> `text-caption-sm text-text-tertiary`

8. Installed badge (line 399):
   - `rounded-lg bg-green-500/10` -> `rounded-radius-sm bg-green-500/10`
   - `text-[11px]` -> `text-caption-sm`
   - Keep `text-green-400` (status color)

9. Install button (line 406):
   - `rounded-lg bg-white/[0.08]` -> `rounded-radius-sm bg-surface-2`
   - `text-[11px] font-medium text-white/70` -> `text-caption-sm font-medium text-text-secondary`
   - `hover:bg-white/[0.14] hover:text-white` -> `hover:bg-surface-3 hover:text-text-primary`

**MarketplaceTab (lines 463-551):**

1. Search border (line 466):
   - `border-b border-white/[0.06]` -> `border-b border-border-subtle`

2. Search icon (line 468):
   - `text-white/25` -> `text-text-tertiary`

3. Search input (line 474):
   - `rounded-xl border border-white/[0.08] bg-white/[0.03]` -> `rounded-radius-lg border border-border-default bg-surface-base`
   - `text-[13px] text-white placeholder-white/25` -> `text-body-sm text-text-primary placeholder-text-tertiary`
   - `focus:border-white/[0.15] focus:bg-white/[0.05]` -> `focus-visible:border-brand focus-visible:ring-3 focus-visible:ring-brand/20`

4. Loading spinner in search (line 477):
   - `text-white/30` -> `text-text-tertiary`

5. Loading spinner centered (line 488):
   - `text-white/20` -> `text-text-tertiary`

6. Empty results icon (line 492):
   - `text-white/15` -> `text-text-tertiary`

7. Empty results text (line 493):
   - `text-[13px] text-white/30` -> `text-body-sm text-text-tertiary`

8. Search result card (line 500):
   - `rounded-xl border border-white/[0.06] bg-white/[0.02] p-3 transition-all hover:border-white/[0.1] hover:bg-white/[0.04]`
   -> `rounded-radius-lg border border-border-subtle bg-surface-base p-3 transition-all hover:border-border-default hover:bg-surface-1`

9. Search result icon container (line 502):
   - `rounded-lg` -> `rounded-radius-sm`
   - Keep gradient `from-blue-500/15 to-violet-500/15` and `text-blue-400/70`

10. Search result name (line 507):
    - `text-[13px] font-medium text-white/85` -> `text-body-sm font-medium text-text-primary`

11. Search result description (line 510):
    - `text-[11px] text-white/35` -> `text-caption-sm text-text-tertiary`

12. Search result package (line 513):
    - `text-[10px] text-white/20` -> `text-caption-sm text-text-tertiary`

13. Search result install button (line 520):
    - `rounded-lg bg-white/[0.06]` -> `rounded-radius-sm bg-surface-1`
    - `text-[11px] font-medium text-white/60` -> `text-caption-sm font-medium text-text-secondary`
    - `hover:bg-white/[0.12] hover:text-white/80` -> `hover:bg-surface-3 hover:text-text-primary`

14. Popular servers heading (line 535):
    - `text-[12px] font-semibold uppercase tracking-wide text-white/40` -> `text-caption font-semibold uppercase tracking-wide text-text-tertiary`

**Do NOT modify:**
- FEATURED_MCPS array (data, not styling)
- CATEGORY_COLORS map (domain-specific status colors)
- ICON_MAP (data mapping)
- API helper functions
- Any event handlers, state, or business logic
  </action>
  <verify>
Run `npx tsc --noEmit --project livos/packages/ui/tsconfig.json` — no type errors.
Search for `bg-black/20` in file — should not exist (replaced with bg-surface-base).
Search for `border-violet-500` in file — should not exist (replaced with border-brand).
Search for `text-\[13px\]` — should not exist in FeaturedCard or MarketplaceTab sections.
Verify `cn` import is present.
  </verify>
  <done>
McpPanel, FeaturedCard, and MarketplaceTab fully migrated to semantic tokens. Tab bar uses border-brand. Search input uses brand focus. Featured cards use border-subtle, surface-base hierarchy. Category colors and gradients preserved. All `text-[Npx]` replaced with semantic typography tokens.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate InstallDialog, InstalledTab, and ConfigTab (AC-06 part 2)</name>
  <files>livos/packages/ui/src/routes/ai-chat/mcp-panel.tsx</files>
  <action>
Migrate InstallDialog (lines 556-820), InstalledTab (lines 824-1079), and ConfigTab (lines 1083-1176). **Only modify className values.**

Use the same opacity mapping reference from Task 1.

**InstallDialog (lines 646-819):**

1. Overlay (line 647):
   - Keep `bg-black/70 backdrop-blur-sm`

2. Dialog container (line 649):
   - `rounded-2xl border border-white/[0.08] bg-[#111118] p-5 shadow-2xl`
   -> `rounded-radius-xl border border-border-default bg-dialog-content p-5 shadow-2xl`

3. Header icon container (line 655):
   - `rounded-xl` -> `rounded-radius-lg`
   - Keep gradient `from-violet-500/20 to-blue-500/20` and `text-violet-400`

4. Header title (line 659):
   - `text-[14px] font-semibold text-white/90` -> `text-body font-semibold text-text-primary`

5. Header subtitle (line 660):
   - `text-[11px] text-white/35` -> `text-caption-sm text-text-tertiary`

6. Close button (line 663):
   - `rounded-lg p-1.5 text-white/30 transition-colors hover:bg-white/[0.06] hover:text-white/60`
   -> `rounded-radius-sm p-1.5 text-text-tertiary transition-colors hover:bg-surface-1 hover:text-text-secondary`

7. All form labels (lines 671, 682, 714, 724, 739, 753, 781):
   - `text-[11px] font-medium uppercase tracking-wide text-white/35` -> `text-caption-sm font-medium uppercase tracking-wide text-text-tertiary`

8. All text inputs (lines 676, 720, 730, 745, 787) — apply consistently:
   - `rounded-xl border border-white/[0.08] bg-white/[0.03]` -> `rounded-radius-lg border border-border-default bg-surface-base`
   - `text-[13px] text-white placeholder-white/20` -> `text-body-sm text-text-primary placeholder-text-tertiary`
   - `focus:border-white/[0.15] focus:bg-white/[0.05]` -> `focus-visible:border-brand focus-visible:ring-3 focus-visible:ring-brand/20`

9. Transport toggle buttons (lines 688-691) — convert to cn():
   - `rounded-lg` -> `rounded-radius-sm`
   - `text-[12px]` -> `text-caption`
   - Active: Keep `bg-violet-500/20 text-violet-300 ring-1 ring-violet-500/30` (transport is a deliberate brand accent)
   - Inactive: `bg-white/[0.04] text-white/40 hover:bg-white/[0.08] hover:text-white/60` -> `bg-surface-base text-text-tertiary hover:bg-surface-2 hover:text-text-secondary`

10. Env var key badge (line 759):
    - `rounded-lg bg-white/[0.04]` -> `rounded-radius-sm bg-surface-base`
    - `text-[11px] text-white/40` -> `text-caption-sm text-text-tertiary`

11. Env var value input (line 771):
    - `rounded-lg border border-white/[0.08] bg-white/[0.03]` -> `rounded-radius-sm border border-border-default bg-surface-base`
    - `text-[12px] text-white placeholder-white/20` -> `text-caption text-text-primary placeholder-text-tertiary`
    - `focus:border-white/[0.15]` -> `focus-visible:border-brand`

12. Error card (line 793):
    - `rounded-xl bg-red-500/10` -> `rounded-radius-lg bg-red-500/10`
    - `text-[12px]` -> `text-caption`
    - Keep `text-red-400` (semantic error color)

13. Cancel button (line 803):
    - `rounded-xl bg-white/[0.06]` -> `rounded-radius-lg bg-surface-1`
    - `text-[13px] font-medium text-white/50` -> `text-body-sm font-medium text-text-secondary`
    - `hover:bg-white/[0.1] hover:text-white/70` -> `hover:bg-surface-2 hover:text-text-primary`

14. Install button (line 810):
    - `rounded-xl bg-violet-600` -> `rounded-radius-lg bg-brand`
    - `text-[13px] font-semibold text-white` -> `text-body-sm font-semibold text-white`
    - `hover:bg-violet-500 disabled:opacity-40` -> `hover:bg-brand-lighter disabled:opacity-40`

**InstalledTab (lines 875-1079):**

1. Loading spinner (line 878):
   - `text-white/20` -> `text-text-tertiary`

2. Empty state container (line 885):
   - `text-white/25` -> `text-text-tertiary`

3. Empty state text (line 887):
   - `text-[13px]` -> `text-body-sm`

4. Empty state hint (line 888):
   - `text-[11px] text-white/20` -> `text-caption-sm text-text-tertiary`

5. Summary bar (line 896):
   - `text-[11px] text-white/30` -> `text-caption-sm text-text-tertiary`
   - Keep `text-green-400` status color (line 899)

6. Refresh button (line 903):
   - `rounded-md` -> `rounded-radius-sm`
   - `text-white/25 transition-colors hover:bg-white/[0.06] hover:text-white/50` -> `text-text-tertiary transition-colors hover:bg-surface-1 hover:text-text-secondary`

7. Server card (line 918):
   - `rounded-xl border border-white/[0.06] bg-white/[0.02] transition-all hover:border-white/[0.1]`
   -> `rounded-radius-lg border border-border-subtle bg-surface-base transition-all hover:border-border-default`

8. Expand chevron (line 924):
   - `text-white/30 transition-colors hover:text-white/60` -> `text-text-tertiary transition-colors hover:text-text-secondary`

9. Status dot disabled (line 938):
   - `text-white/15` -> `text-text-tertiary`
   - Keep `text-green-400` and `text-amber-400` (semantic status)

10. Server name (line 950):
    - `text-[13px] font-medium text-white/85` -> `text-body-sm font-medium text-text-primary`

11. Transport badge (line 951):
    - `rounded-md bg-white/[0.05]` -> `rounded-radius-sm bg-surface-1`
    - `text-[10px] font-medium text-white/30` -> `text-caption-sm font-medium text-text-tertiary`

12. Server description (line 966):
    - `text-[11px] text-white/30` -> `text-caption-sm text-text-tertiary`

13. Tool count (line 972):
    - `text-[11px] text-white/25` -> `text-caption-sm text-text-tertiary`

14. Action buttons — toggle enabled (line 986-990) — convert to cn():
    - `rounded-lg` -> `rounded-radius-sm`
    - Keep `text-green-400/70 hover:bg-green-500/10 hover:text-green-400` (semantic status)
    - Disabled: `text-white/20 hover:bg-white/[0.06] hover:text-white/40` -> `text-text-tertiary hover:bg-surface-1 hover:text-text-secondary`

15. Restart button (line 997):
    - `rounded-lg p-1.5 text-white/25 transition-all hover:bg-white/[0.06] hover:text-white/50`
    -> `rounded-radius-sm p-1.5 text-text-tertiary transition-all hover:bg-surface-1 hover:text-text-secondary`

16. Remove button (line 1004):
    - `rounded-lg p-1.5 text-white/25 transition-all hover:bg-red-500/10 hover:text-red-400`
    -> `rounded-radius-sm p-1.5 text-text-tertiary transition-all hover:bg-red-500/10 hover:text-red-400`

17. Loader in actions (line 981):
    - `text-white/30` -> `text-text-tertiary`

18. Expanded details border (line 1016):
    - `border-t border-white/[0.05]` -> `border-t border-border-subtle`

19. Detail labels (lines 1020, 1026, 1032, 1038):
    - `text-white/25` -> `text-text-tertiary`

20. Detail values (lines 1027, 1033, 1039):
    - `text-white/45` -> `text-text-secondary`
    - `text-white/40` -> `text-text-tertiary`

21. Error card in details (line 1048):
    - `rounded-lg bg-red-500/10 text-[11px] text-red-400/80` -> `rounded-radius-sm bg-red-500/10 text-caption-sm text-red-400/80`

22. Tools section header (line 1056):
    - `text-[10px] font-medium uppercase tracking-wider text-white/25` -> `text-caption-sm font-medium uppercase tracking-wider text-text-tertiary`

23. Tool badges (line 1063):
    - `rounded-md bg-white/[0.05]` -> `rounded-radius-sm bg-surface-1`
    - `text-[10px] text-white/40` -> `text-caption-sm text-text-tertiary`

**ConfigTab (lines 1083-1176):**

1. Loading spinner (line 1128):
   - `text-white/20` -> `text-text-tertiary`

2. Config header label (line 1136):
   - `text-[11px] text-white/30` -> `text-caption-sm text-text-tertiary`

3. Reload button (line 1153):
   - `rounded-lg p-1.5 text-white/25 transition-colors hover:bg-white/[0.06] hover:text-white/50`
   -> `rounded-radius-sm p-1.5 text-text-tertiary transition-colors hover:bg-surface-1 hover:text-text-secondary`

4. Save button (line 1161):
   - `rounded-lg bg-violet-600` -> `rounded-radius-sm bg-brand`
   - `text-[11px] font-semibold text-white` -> `text-caption-sm font-semibold text-white`
   - `hover:bg-violet-500 disabled:opacity-40` -> `hover:bg-brand-lighter disabled:opacity-40`

5. Config textarea (line 1172):
   - `rounded-xl border border-white/[0.06] bg-black/30` -> `rounded-radius-lg border border-border-subtle bg-surface-base`
   - `text-[12px] leading-relaxed text-white/70` -> `text-caption leading-relaxed text-text-secondary`
   - `focus:border-white/[0.12]` -> `focus-visible:border-brand`

6. Status text (line 1143) — Keep `text-green-400` and `text-red-400` (semantic status).
   - `text-[11px]` -> `text-caption-sm`

**Use cn() for all conditional class expressions** (transport toggle, server enabled toggle, status text).
  </action>
  <verify>
Run `npx tsc --noEmit --project livos/packages/ui/tsconfig.json` — no type errors.
Search for `bg-\[#111118\]` in file — should not exist (replaced with bg-dialog-content).
Search for `bg-violet-600` in file — should not exist (replaced with bg-brand).
Search for `bg-violet-500` (non-hover) — should only exist in the transport toggle active state (`bg-violet-500/20`).
Search for `white/\[0\.` in file — should not exist (all fractional opacities replaced with semantic tokens).
Verify `bg-brand` appears for install and save buttons.
  </verify>
  <done>
InstallDialog uses bg-dialog-content and border-border-default with brand focus on all inputs. Install/save buttons use bg-brand. InstalledTab server cards use border-subtle, surface-base with hover to border-default. All action buttons use rounded-radius-sm. ConfigTab textarea uses semantic tokens with brand focus. All ~81 raw opacity values replaced with semantic equivalents. Status colors (green/red/amber), category colors, and gradients preserved.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. `npx tsc --noEmit --project livos/packages/ui/tsconfig.json` passes
2. `grep -c 'white/\[' livos/packages/ui/src/routes/ai-chat/mcp-panel.tsx` — should return 0 (all fractional opacities gone)
3. `grep -c 'bg-violet-600' livos/packages/ui/src/routes/ai-chat/mcp-panel.tsx` — should return 0 (replaced with bg-brand)
4. `grep -c 'bg-brand' livos/packages/ui/src/routes/ai-chat/mcp-panel.tsx` — should return 3+ (install dialog, config save)
5. `grep 'bg-dialog-content' livos/packages/ui/src/routes/ai-chat/mcp-panel.tsx` — present on InstallDialog
6. `grep 'border-brand' livos/packages/ui/src/routes/ai-chat/mcp-panel.tsx` — present on tab bar active state
7. `grep 'focus-visible:border-brand' livos/packages/ui/src/routes/ai-chat/mcp-panel.tsx` — present on search and form inputs
8. FEATURED_MCPS array, CATEGORY_COLORS, and ICON_MAP unchanged
9. All API helper functions unchanged
10. No business logic modified (fetch, useState, useEffect, useCallback calls unchanged)
</verification>

<success_criteria>
- All ~81 raw opacity values replaced with semantic tokens
- Install dialog uses bg-dialog-content (consistent with Phase 3)
- All violet-600 buttons replaced with bg-brand
- All form inputs use brand focus pattern (focus-visible:border-brand + ring)
- Tab bar uses border-brand for active state
- All text-[Npx] values replaced with semantic typography tokens
- All rounded-XX values replaced with semantic radius tokens
- Status colors (green/red/amber) preserved for server status
- Category badge colors preserved (CATEGORY_COLORS untouched)
- Featured card gradients preserved (brand identity)
- No business logic modified
- No type errors introduced
</success_criteria>

<output>
After completion, create `.planning/phases/v1.1-05-ai-chat-redesign/05-03-SUMMARY.md`
</output>

---
phase: v1.1-06-app-store-files
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - livos/packages/ui/src/features/files/components/listing/file-item/index.tsx
  - livos/packages/ui/src/features/files/components/listing/file-item/list-view-file-item.tsx
  - livos/packages/ui/src/features/files/components/listing/file-item/icons-view-file-item.tsx
  - livos/packages/ui/src/features/files/components/listing/listing-body.tsx
  - livos/packages/ui/src/features/files/components/listing/listing-and-file-item-context-menu.tsx
  - livos/packages/ui/src/features/files/components/listing/directory-listing/empty-state.tsx
  - livos/packages/ui/src/features/files/components/listing/actions-bar/path-bar/path-bar-desktop.tsx
  - livos/packages/ui/src/features/files/components/listing/actions-bar/path-bar/path-bar-mobile.tsx
  - livos/packages/ui/src/features/files/components/listing/actions-bar/navigation-controls.tsx
  - livos/packages/ui/src/features/files/components/listing/actions-bar/search-input.tsx
  - livos/packages/ui/src/features/files/components/listing/actions-bar/sort-dropdown.tsx
  - livos/packages/ui/src/features/files/components/listing/actions-bar/view-toggle.tsx
  - livos/packages/ui/src/features/files/components/listing/actions-bar/mobile-actions.tsx
  - livos/packages/ui/src/features/files/components/sidebar/sidebar-item.tsx
  - livos/packages/ui/src/features/files/components/sidebar/index.tsx
  - livos/packages/ui/src/features/files/components/shared/drag-and-drop.tsx
  - livos/packages/ui/src/features/files/components/shared/file-upload-drop-zone.tsx
  - livos/packages/ui/src/features/files/components/files-dnd-wrapper/files-dnd-overlay.tsx
autonomous: true

must_haves:
  truths:
    - "File list view items use semantic text-text-tertiary/secondary/primary instead of text-white/40,60,70"
    - "File grid view cards use semantic surface tokens instead of raw bg-black/35"
    - "File item hover states use semantic surface-1/surface-2 instead of raw white/5,6"
    - "Breadcrumb path bar uses semantic text-text-secondary instead of text-white/50"
    - "Search input uses brand focus pattern (focus-visible:border-brand + ring-brand/20)"
    - "View toggle uses semantic surface/border/brand tokens"
    - "Sort dropdown uses semantic text tokens"
    - "Sidebar items use semantic surface/border/text tokens for active/inactive/disabled states"
    - "DnD overlay uses semantic brand tokens for drag feedback"
    - "File upload drop zone uses brand-colored overlay with semantic tokens"
    - "Context menu className changes only (no logic modification)"
    - "list-view-file-item.css left untouched (already uses theme(colors.brand))"
  artifacts:
    - path: "livos/packages/ui/src/features/files/components/listing/file-item/list-view-file-item.tsx"
      provides: "List view file row with semantic text tokens"
      contains: "text-text-secondary"
    - path: "livos/packages/ui/src/features/files/components/listing/actions-bar/search-input.tsx"
      provides: "Search input with brand focus"
      contains: "focus-visible:border-brand"
    - path: "livos/packages/ui/src/features/files/components/listing/actions-bar/view-toggle.tsx"
      provides: "View toggle with semantic tokens"
      contains: "bg-brand"
    - path: "livos/packages/ui/src/features/files/components/sidebar/sidebar-item.tsx"
      provides: "Sidebar item with semantic states"
      contains: "bg-surface-2"
    - path: "livos/packages/ui/src/features/files/components/shared/file-upload-drop-zone.tsx"
      provides: "Upload drop zone with brand overlay"
      contains: "border-brand"
  key_links:
    - from: "file-item/index.tsx selection styling"
      to: "list-view-file-item.css"
      via: "data-selected attribute + CSS selectors"
      pattern: "data-selected"
    - from: "sidebar-item.tsx active state"
      to: "semantic surface hierarchy"
      via: "bg-surface-2 default, bg-surface-3 active"
      pattern: "bg-surface-2|bg-surface-3"
    - from: "search-input.tsx focus"
      to: "brand focus pattern"
      via: "focus-visible:border-brand class"
      pattern: "focus-visible:border-brand"
---

<objective>
Migrate the File Manager listing components (list view, grid view, table header), actions bar (path bar, navigation, search, sort, view toggle), sidebar, and drag-and-drop feedback to semantic design tokens.

Purpose: The File Manager is the second major feature area in Phase 6. Its listing components, navigation, and DnD feedback use pervasive raw white/XX opacity values and non-semantic border/surface colors. Migrating these ensures the file browser experience matches the design language established across the application.

Output: All File Manager listing, actions bar, sidebar, and DnD components fully migrated to semantic tokens.
</objective>

<execution_context>
@C:\Users\hello\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\hello\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP-v1.1.md
@.planning/STATE.md
@.planning/phases/v1.1-06-app-store-files/06-RESEARCH.md

Source files:
@livos/packages/ui/src/features/files/components/listing/file-item/index.tsx
@livos/packages/ui/src/features/files/components/listing/file-item/list-view-file-item.tsx
@livos/packages/ui/src/features/files/components/listing/file-item/icons-view-file-item.tsx
@livos/packages/ui/src/features/files/components/listing/listing-body.tsx
@livos/packages/ui/src/features/files/components/listing/listing-and-file-item-context-menu.tsx
@livos/packages/ui/src/features/files/components/listing/directory-listing/empty-state.tsx
@livos/packages/ui/src/features/files/components/listing/actions-bar/path-bar/path-bar-desktop.tsx
@livos/packages/ui/src/features/files/components/listing/actions-bar/path-bar/path-bar-mobile.tsx
@livos/packages/ui/src/features/files/components/listing/actions-bar/navigation-controls.tsx
@livos/packages/ui/src/features/files/components/listing/actions-bar/search-input.tsx
@livos/packages/ui/src/features/files/components/listing/actions-bar/sort-dropdown.tsx
@livos/packages/ui/src/features/files/components/listing/actions-bar/view-toggle.tsx
@livos/packages/ui/src/features/files/components/listing/actions-bar/mobile-actions.tsx
@livos/packages/ui/src/features/files/components/sidebar/sidebar-item.tsx
@livos/packages/ui/src/features/files/components/sidebar/index.tsx
@livos/packages/ui/src/features/files/components/shared/drag-and-drop.tsx
@livos/packages/ui/src/features/files/components/shared/file-upload-drop-zone.tsx
@livos/packages/ui/src/features/files/components/files-dnd-wrapper/files-dnd-overlay.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate file item views, listing body, context menu, and empty state (FM-01, FM-03)</name>
  <files>
    livos/packages/ui/src/features/files/components/listing/file-item/index.tsx
    livos/packages/ui/src/features/files/components/listing/file-item/list-view-file-item.tsx
    livos/packages/ui/src/features/files/components/listing/file-item/icons-view-file-item.tsx
    livos/packages/ui/src/features/files/components/listing/listing-body.tsx
    livos/packages/ui/src/features/files/components/listing/listing-and-file-item-context-menu.tsx
    livos/packages/ui/src/features/files/components/listing/directory-listing/empty-state.tsx
  </files>
  <action>
**Opacity mapping reference (apply consistently across ALL files in this plan):**
- `bg-white/5` or `bg-white/[0.04]` -> `bg-surface-base`
- `bg-white/6` or `bg-white/[0.06]` -> `bg-surface-1`
- `bg-white/[0.08]` or `bg-white/10` -> `bg-surface-2`
- `bg-white/[0.14]` -> `bg-surface-3`
- `bg-black/35` -> `bg-surface-1` (dark semi-transparent on grid cards)
- `border-white/6` -> `border-border-subtle`
- `border-white/[0.10]` -> `border-border-default`
- `border-neutral-600`, `border-neutral-800` -> `border-border-default`, `border-border-subtle`
- `hover:!bg-white/5` -> `hover:!bg-surface-base`
- `hover:!border-white/6` -> `hover:!border-border-subtle`
- `hover:bg-white/10` -> `hover:bg-surface-2`
- `hover:bg-transparent` -> keep as-is
- `text-white/40` -> `text-text-tertiary`
- `text-white/50` -> `text-text-secondary`
- `text-white/60` -> `text-text-secondary`
- `text-white/70` -> `text-text-primary`
- `opacity-50` (on text/icon) -> replace with `text-text-secondary` or `opacity-60` if on non-text element
- `opacity-70` -> replace with `text-text-primary` if on text
- `text-neutral-500` -> `text-text-tertiary`
- `ring-white/6` -> `ring-border-subtle`
- `focus:ring-0` -> keep as-is (intentional removal)
- Pixel typography: `text-11` -> `text-caption-sm`, `text-12` -> `text-caption`, `text-13` -> `text-body-sm`

**file-item/index.tsx (~258 lines):**
1. Selection styling — the file uses `bg-brand/10` and `shadow-[0_0_0_1px_theme(colors.brand)]` for selected state. **PRESERVE these** — they already use the brand token correctly.
2. Hover states:
   - `hover:!border-white/6` -> `hover:!border-border-subtle`
   - `hover:!bg-white/5` -> `hover:!bg-surface-base`
3. Any other raw white/XX values -> migrate per mapping.
4. **Do NOT touch the data-selected, data-selection-position attributes** — these drive the CSS in list-view-file-item.css.

**list-view-file-item.tsx (~131 lines):**
1. Column text colors:
   - `text-white/40` (size, date columns) -> `text-text-tertiary`
   - `text-white/60` (filename) -> `text-text-secondary`
2. `opacity-50`, `opacity-70` on elements -> replace with `text-text-secondary`, `text-text-primary` respectively
3. Typography: `text-12` -> `text-caption`, `text-11` -> `text-caption-sm`
4. Keep flex ratios and structural layout unchanged.

**icons-view-file-item.tsx (~82 lines):**
1. Grid card:
   - `w-28` (112px) — keep as functional size
   - `bg-black/35` -> `bg-surface-1`
   - `text-12` -> `text-caption`
   - `text-white/40` -> `text-text-tertiary`
   - `opacity-50` -> replace with `text-text-secondary`

**listing-body.tsx (~93 lines):**
1. Table header row:
   - `text-12` -> `text-caption`
   - `text-white/70` -> `text-text-primary`
2. Keep flex ratios matching list-view-file-item layout.

**listing-and-file-item-context-menu.tsx (~333 lines):**
This is mostly logic. **Only touch className props on ContextMenuContent, ContextMenuItem, etc.**
- If `w-48`, `w-28`, `w-24` widths exist — keep (functional menu widths)
- If there are `contextMenuClasses.item.rootDestructive` references — keep (these use shared menu styles from Phase 2)
- Migrate any raw white/XX values in className strings to semantic tokens.
- **Do NOT modify the 300+ lines of context menu logic, handlers, or conditional rendering.**

**directory-listing/empty-state.tsx (~62 lines):**
- `text-12` -> `text-caption`
- `text-white/40` -> `text-text-tertiary`

**CRITICAL: Do NOT touch list-view-file-item.css** — it already uses `theme(colors.brand)` and `hsl(var(--color-brand))` which are correct. Leave this file completely unchanged.

**Do NOT modify:**
- Selection logic, data attributes, or selection position CSS
- DnD drag/drop handlers
- Context menu logic (only touch className props)
- File item prop interfaces
- Flex ratios in list view (these control column widths)
- list-view-file-item.css (already correct)
  </action>
  <verify>
Run `npx tsc --noEmit --project livos/packages/ui/tsconfig.json` — no type errors.
Search for `text-white/40` in list-view-file-item.tsx — should not exist (replaced with text-text-tertiary).
Search for `text-white/60` in list-view-file-item.tsx — should not exist (replaced with text-text-secondary).
Search for `bg-black/35` in icons-view-file-item.tsx — should not exist (replaced with bg-surface-1).
Verify `bg-brand/10` preserved in file-item/index.tsx (selection styling).
Verify `data-selected` and `data-selection-position` attributes preserved in file-item/index.tsx.
  </verify>
  <done>
File list view items use text-text-tertiary for size/date, text-text-secondary for filename. Grid view uses bg-surface-1 instead of bg-black/35. File item hover uses border-border-subtle and surface-base. Selection styling (bg-brand/10) preserved. Context menu has className-only changes. Empty state uses text-caption and text-text-tertiary. list-view-file-item.css untouched.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate actions bar (path bar, nav, search, sort, view toggle, mobile) and sidebar (FM-02, FM-03)</name>
  <files>
    livos/packages/ui/src/features/files/components/listing/actions-bar/path-bar/path-bar-desktop.tsx
    livos/packages/ui/src/features/files/components/listing/actions-bar/path-bar/path-bar-mobile.tsx
    livos/packages/ui/src/features/files/components/listing/actions-bar/navigation-controls.tsx
    livos/packages/ui/src/features/files/components/listing/actions-bar/search-input.tsx
    livos/packages/ui/src/features/files/components/listing/actions-bar/sort-dropdown.tsx
    livos/packages/ui/src/features/files/components/listing/actions-bar/view-toggle.tsx
    livos/packages/ui/src/features/files/components/listing/actions-bar/mobile-actions.tsx
    livos/packages/ui/src/features/files/components/sidebar/sidebar-item.tsx
    livos/packages/ui/src/features/files/components/sidebar/index.tsx
  </files>
  <action>
Use the same opacity mapping reference from Task 1.

**path-bar-desktop.tsx (~244 lines):**
1. Breadcrumb text:
   - `text-xs` -> keep as-is (standard Tailwind, maps well enough)
   - `text-white/50` -> `text-text-secondary`
2. Breadcrumb separator/overflow styling: migrate raw opacity values.
3. **Do NOT modify the complex width calculation logic** for breadcrumb overflow. Only change className values.

**path-bar-mobile.tsx (~79 lines):**
- Migrate any raw white/XX values to semantic tokens.

**navigation-controls.tsx (~131 lines):**
- `opacity-50` -> replace with `text-text-secondary` (on disabled state)
- `hover:bg-transparent` -> keep as-is
- `focus:ring-0` -> keep as-is

**search-input.tsx (~85 lines):**
1. Input container:
   - `border-neutral-600` -> `border-border-default`
   - `border-neutral-800` -> `border-border-subtle`
   - `border-white/6` -> `border-border-subtle`
   - `bg-white/5` -> `bg-surface-base`
   - `text-neutral-500` -> `text-text-tertiary` (placeholder)
2. Focus state:
   - Add brand focus: `focus-visible:border-brand focus-visible:ring-2 focus-visible:ring-brand/20`
3. `focus:w-[calc(100vw-11rem)]` -> keep as-is (responsive behavior)

**sort-dropdown.tsx (~48 lines):**
- `text-13` -> `text-body-sm`
- `text-white/40` -> `text-text-tertiary`

**view-toggle.tsx (~41 lines):**
- Container: `border-white/6` -> `border-border-subtle`, `bg-white/6` -> `bg-surface-1`, `ring-white/6` -> `ring-border-subtle`
- Active button: `bg-brand` — keep (already correct)
- Inactive hover: `hover:bg-white/10` -> `hover:bg-surface-2`
- `text-white/50` -> `text-text-secondary`

**mobile-actions.tsx (~112 lines):**
- Migrate any raw white/XX values to semantic tokens.

**sidebar-item.tsx (~58 lines):**
1. States (active/inactive/disabled):
   - Default: `white/[0.04]` -> `bg-surface-base`
   - Active: `white/[0.08]` -> `bg-surface-2`
   - `border-white/6` -> `border-border-subtle`
   - `shadow-button-highlight-soft-hpx` -> keep if it's a custom shadow token, or replace with `shadow-elevation-sm`
2. Text:
   - `text-12` -> `text-caption`
   - `white/40` -> `text-text-tertiary` (disabled/secondary)
   - `white/60` -> `text-text-secondary`
3. Hover: `hover:bg-white/10` -> `hover:bg-surface-2`

**sidebar/index.tsx (~138 lines):**
- Section layout — migrate any raw values found.

**Do NOT modify:**
- Breadcrumb width calculation logic in path-bar-desktop.tsx
- Search focus:w-[calc(100vw-11rem)] responsive width
- Navigation history logic
- Sort/view state management
- Sidebar section data structures
  </action>
  <verify>
Run `npx tsc --noEmit --project livos/packages/ui/tsconfig.json` — no type errors.
Search for `border-neutral-600\|border-neutral-800` in search-input.tsx — should not exist (replaced with border-border-*).
Search for `text-white/50` in path-bar-desktop.tsx — should not exist (replaced with text-text-secondary).
Search for `bg-white/5` in search-input.tsx — should not exist (replaced with bg-surface-base).
Verify `focus-visible:border-brand` in search-input.tsx.
Verify `bg-brand` preserved in view-toggle.tsx (active state).
Verify `bg-surface-2` in sidebar-item.tsx (active state).
  </verify>
  <done>
Path bar breadcrumbs use text-text-secondary. Search input uses bg-surface-base with brand focus pattern. Sort dropdown uses text-body-sm and text-text-tertiary. View toggle uses bg-surface-1 container with bg-brand active and hover:bg-surface-2 inactive. Sidebar items use bg-surface-base default, bg-surface-2 active, text-caption typography. Navigation controls use text-text-secondary disabled state. All raw neutral-* and white/XX values replaced.
  </done>
</task>

<task type="auto">
  <name>Task 3: Migrate drag-and-drop feedback components (FM-04)</name>
  <files>
    livos/packages/ui/src/features/files/components/shared/drag-and-drop.tsx
    livos/packages/ui/src/features/files/components/shared/file-upload-drop-zone.tsx
    livos/packages/ui/src/features/files/components/files-dnd-wrapper/files-dnd-overlay.tsx
  </files>
  <action>
Use the same opacity mapping reference from Task 1.

**drag-and-drop.tsx (~145 lines):**
- `dropOverClassName = 'bg-brand text-white'` default prop — this already uses brand. **Keep as-is** or verify it still works well visually.
- Migrate any other raw white/XX values in className strings.

**file-upload-drop-zone.tsx (~97 lines):**
1. Drop zone border:
   - `border-[hsl(var(--color-brand))]/30` -> `border-brand/30` (if Tailwind supports brand/30, otherwise keep the hsl pattern)
   - Actually, check if `border-brand/30` works in the project's Tailwind config. If brand is defined as a CSS variable, use `border-brand` with opacity modifier `border-brand/30`.
2. Overlay:
   - `bg-black/50` -> keep (overlay backdrop, not a surface)
   - `bg-brand/25` -> keep (brand-colored overlay, correct)
3. Text: `text-5xl` -> keep (large upload icon)
4. Ripple animation — preserve entirely (visual feedback)

**files-dnd-overlay.tsx (~45 lines):**
1. Drag preview:
   - `bg-brand` -> keep (already correct)
   - `border-brand/90` -> keep (already correct)
   - `bg-brand/20` -> keep (already correct, brand overlay)
   - `text-12` -> `text-caption`
   - `border-white/25` -> `border-border-emphasis`

**Do NOT modify:**
- DnD hook integration (@dnd-kit)
- Drag event handlers
- Drop zone state logic
- Ripple animation keyframes
  </action>
  <verify>
Run `npx tsc --noEmit --project livos/packages/ui/tsconfig.json` — no type errors.
Search for `border-white/25` in files-dnd-overlay.tsx — should not exist (replaced with border-border-emphasis).
Verify `bg-brand` preserved in files-dnd-overlay.tsx and drag-and-drop.tsx.
Verify `border-brand` or `border-[hsl(var(--color-brand))]` in file-upload-drop-zone.tsx.
  </verify>
  <done>
Drag-and-drop feedback uses brand tokens (bg-brand, border-brand) for drop target highlighting. Upload drop zone preserves brand-colored overlay with border-brand/30. DnD overlay uses text-caption and border-border-emphasis. All raw white/XX values replaced. DnD logic and animation untouched.
  </done>
</task>

</tasks>

<verification>
After all three tasks complete:

1. `npx tsc --noEmit --project livos/packages/ui/tsconfig.json` passes
2. `grep -r 'text-white/40\|text-white/60\|text-white/70' livos/packages/ui/src/features/files/components/listing/file-item/` — should return 0 matches
3. `grep -r 'border-neutral-600\|border-neutral-800' livos/packages/ui/src/features/files/components/listing/actions-bar/` — should return 0 matches
4. `grep -r 'bg-white/5\b\|bg-white/6\b' livos/packages/ui/src/features/files/components/listing/actions-bar/` — should return 0 matches
5. `grep 'focus-visible:border-brand' livos/packages/ui/src/features/files/components/listing/actions-bar/search-input.tsx` — should return match
6. `grep 'bg-brand' livos/packages/ui/src/features/files/components/listing/actions-bar/view-toggle.tsx` — should return match (active state preserved)
7. `grep 'bg-brand/10' livos/packages/ui/src/features/files/components/listing/file-item/index.tsx` — should return match (selection preserved)
8. `grep 'data-selected' livos/packages/ui/src/features/files/components/listing/file-item/index.tsx` — should return match (CSS hook preserved)
9. list-view-file-item.css unchanged (verify with git diff)
10. No DnD logic, selection logic, or breadcrumb width calculations modified
</verification>

<success_criteria>
- List view file items: text-text-tertiary for size/date, text-text-secondary for secondary text, text-text-primary for primary text
- Grid view cards: bg-surface-1 background, text-text-tertiary filename
- File item selection (bg-brand/10 + brand box-shadow) preserved unchanged
- list-view-file-item.css completely untouched
- Breadcrumb path bar: text-text-secondary for segments
- Search input: bg-surface-base, border-border-subtle, brand focus pattern
- View toggle: bg-surface-1 container, bg-brand active button, hover:bg-surface-2 inactive
- Sort dropdown: text-body-sm, text-text-tertiary
- Sidebar items: surface-base default, surface-2 active, text-caption typography, border-border-subtle
- Navigation controls: text-text-secondary disabled, clean hover states
- DnD overlay: bg-brand preserved, text-caption, border-border-emphasis
- Upload drop zone: brand border and overlay preserved
- Context menu: className-only changes, all logic intact
- No type errors introduced
- No business logic, DnD handlers, or selection logic modified
</success_criteria>

<output>
After completion, create `.planning/phases/v1.1-06-app-store-files/06-03-SUMMARY.md`
</output>

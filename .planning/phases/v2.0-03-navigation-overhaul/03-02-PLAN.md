---
phase: v2.0-03-navigation-overhaul
plan: 02
type: execute
wave: 2
depends_on: [01]
files_modified:
  - livos/packages/ui/src/router.tsx
  - livos/packages/ui/src/layouts/desktop.tsx
  - livos/packages/ui/src/modules/desktop/desktop-content.tsx
autonomous: true

must_haves:
  truths:
    - "Desktop layout uses sidebar + main content area (not dock + centered icon grid)"
    - "Dock is hidden on desktop (md+ breakpoint)"
    - "Sidebar renders on desktop, hidden on mobile"
    - "Main content area fills remaining space after sidebar"
---

<objective>
Integrate the new sidebar into the desktop layout, replacing the dock+icon-grid pattern with sidebar+main-content.

Key changes:
1. Add Sidebar to router.tsx layout (before Desktop)
2. Modify Desktop layout to flex horizontally with sidebar
3. Hide dock on desktop (keep for mobile)
4. Desktop content area fills remaining space
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Add Sidebar to main layout in router.tsx</name>
  <files>livos/packages/ui/src/router.tsx</files>
  <action>
Add the Sidebar import at the top:
```tsx
import {Sidebar} from './modules/sidebar'
```

In the desktop route element (the '/' path), add Sidebar inside the WindowManagerProvider, wrapping the existing content in a flex layout. The structure should become:

```tsx
<WindowManagerProvider>
    <CmdkProvider>
    <AiQuickProvider>
        <div className='flex h-[100dvh]'>
            <Sidebar />
            <div className='flex-1 flex flex-col min-w-0'>
                <DesktopContextMenu>
                    <Desktop />
                </DesktopContextMenu>
                <CmdkMenu />
                <AiQuickDialog />
                <Suspense>
                    <Outlet />
                </Suspense>
                <WindowsContainer />
                <FloatingIslandContainer />
            </div>
        </div>
    </AiQuickProvider>
    </CmdkProvider>
    <DockBottomPositioner>
        <Dock />
    </DockBottomPositioner>
</WindowManagerProvider>
```

Note: The Dock stays OUTSIDE the flex layout so it can remain as a mobile-only element.
  </action>
</task>

<task type="auto">
  <name>Task 2: Hide dock on desktop</name>
  <files>livos/packages/ui/src/modules/desktop/dock.tsx</files>
  <action>
In the Dock component, add a mobile-only check at the start:

Add after the existing hooks (around line 67, after `const windowManager = useWindowManagerOptional()`):

```tsx
// Dock is only shown on mobile (desktop uses sidebar)
if (!isMobile) return (
    <>
        <LogoutDialog />
        <ErrorBoundary fallbackRender={() => null}>
            <Suspense>
                <LiveUsageDialog />
            </Suspense>
        </ErrorBoundary>
        <ErrorBoundary fallbackRender={() => null}>
            <Suspense>
                <WhatsNewModal />
            </Suspense>
        </ErrorBoundary>
    </>
)
```

This keeps the dock's dialog children rendered but hides the dock itself on desktop. On mobile, the full dock renders normally.

Also in DockBottomPositioner, add a check:
```tsx
export function DockBottomPositioner({children}: {children: React.ReactNode}) {
    const isMobile = useIsMobile()
    if (!isMobile) return <>{children}</>
    return (
        <div className='fixed bottom-0 left-1/2 z-50 -translate-x-1/2' style={{paddingBottom: DOCK_BOTTOM_PADDING_PX}}>
            {children}
        </div>
    )
}
```

Import useIsMobile if not already imported.
  </action>
</task>

<task type="auto">
  <name>Task 3: Update Desktop layout for sidebar context</name>
  <files>livos/packages/ui/src/layouts/desktop.tsx</files>
  <action>
The Desktop component no longer needs to account for the dock spacer on desktop. Update DesktopPage:

The overflow: hidden is still needed. The layout should be:

```tsx
function DesktopPage() {
    const {setOpen} = useCmdkOpen()

    useEffect(() => {
        document.documentElement.style.overflow = 'hidden'
        return () => {
            document.documentElement.style.overflow = ''
        }
    }, [])

    return (
        <>
            <div className='relative flex h-full w-full flex-col items-center justify-between'>
                <DesktopContent onSearchClick={() => setOpen(true)} />
                <DesktopWifiButtonConnected className={topRightPositionerClass} />
            </div>
            <DefaultCredentialsDialog />
            <AppSettingsDialog />
        </>
    )
}
```

Change `h-[100dvh]` to `h-full` since the parent now handles the full-height layout.
  </action>
</task>

<task type="auto">
  <name>Task 4: Remove DockSpacer from desktop content</name>
  <files>livos/packages/ui/src/modules/desktop/desktop-content.tsx</files>
  <action>
Remove or conditionally render the DockSpacer. On desktop with sidebar, there's no dock so no need for the spacer.

Import useIsMobile:
```tsx
import {useIsMobile} from '@/hooks/use-is-mobile'
```

In the component, add:
```tsx
const isMobile = useIsMobile()
```

Change the DockSpacer at the bottom of the return to only show on mobile:
```tsx
{isMobile && <DockSpacer />}
```
  </action>
</task>

</tasks>

<verification>
1. Desktop shows sidebar on left + main content area on right
2. Dock does NOT appear on desktop
3. Dock still appears on mobile
4. DockSpacer only shows on mobile
5. Desktop layout fills full height
6. Run `cd livos && pnpm build` to verify
</verification>

---
phase: v2.0-03-navigation-overhaul
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - livos/packages/ui/src/modules/sidebar/sidebar.tsx (NEW)
  - livos/packages/ui/src/modules/sidebar/sidebar-item.tsx (NEW)
  - livos/packages/ui/src/modules/sidebar/index.ts (NEW)
autonomous: true

must_haves:
  truths:
    - "Sidebar component exists with logo, navigation items, installed apps with status dots, collapse toggle"
    - "Sidebar is collapsible between full-width (240px) and icon-only (64px) modes"
    - "Sidebar items support icon, label, badge/notification count, and active state"
---

<objective>
Create the new collapsible sidebar navigation component. This replaces the dock as the primary desktop navigation.

The sidebar has:
- Logo/brand at top
- Navigation items: Home, Files, AI Chat, Terminal
- Separator
- Installed apps list with running status dots
- Separator
- Settings, App Store at bottom
- Collapse toggle
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Create SidebarItem component</name>
  <files>livos/packages/ui/src/modules/sidebar/sidebar-item.tsx (NEW)</files>
  <action>
Create a new file `livos/packages/ui/src/modules/sidebar/sidebar-item.tsx`:

```tsx
import {Link} from 'react-router-dom'
import {cn} from '@/shadcn-lib/utils'

type SidebarItemProps = {
    icon: React.ReactNode
    label: string
    to?: string
    onClick?: () => void
    isActive?: boolean
    isCollapsed?: boolean
    badge?: number
    statusColor?: 'green' | 'amber' | 'red'
}

export function SidebarItem({icon, label, to, onClick, isActive, isCollapsed, badge, statusColor}: SidebarItemProps) {
    const content = (
        <>
            <div className='relative flex h-8 w-8 shrink-0 items-center justify-center'>
                {icon}
                {statusColor && (
                    <div className={cn(
                        'absolute -right-0.5 -top-0.5 h-2 w-2 rounded-full border border-[#111111]',
                        statusColor === 'green' && 'bg-emerald-400',
                        statusColor === 'amber' && 'bg-amber-400',
                        statusColor === 'red' && 'bg-red-400',
                    )} />
                )}
            </div>
            {!isCollapsed && (
                <>
                    <span className='flex-1 truncate text-body-sm'>{label}</span>
                    {badge !== undefined && badge > 0 && (
                        <span className='flex h-5 min-w-5 items-center justify-center rounded-full bg-brand px-1.5 text-caption-sm font-medium text-white'>
                            {badge > 99 ? '99+' : badge}
                        </span>
                    )}
                </>
            )}
        </>
    )

    const className = cn(
        'flex items-center gap-3 rounded-radius-sm px-2 py-1.5 transition-colors duration-150',
        'text-text-secondary hover:text-text-primary hover:bg-surface-1',
        isActive && 'bg-surface-1 text-text-primary',
        isCollapsed && 'justify-center px-0',
    )

    if (to) {
        return <Link to={to} className={className}>{content}</Link>
    }

    return <button onClick={onClick} className={className}>{content}</button>
}
```
  </action>
</task>

<task type="auto">
  <name>Task 2: Create Sidebar component</name>
  <files>livos/packages/ui/src/modules/sidebar/sidebar.tsx (NEW)</files>
  <action>
Create a new file `livos/packages/ui/src/modules/sidebar/sidebar.tsx`:

```tsx
import {useState} from 'react'
import {useLocation} from 'react-router-dom'
import {
    RiHomeLine,
    RiFolderLine,
    RiChat3Line,
    RiTerminalBoxLine,
    RiSettings4Line,
    RiAppsLine,
    RiServerLine,
    RiRobotLine,
    RiCalendarLine,
    RiMenuFoldLine,
    RiMenuUnfoldLine,
} from 'react-icons/ri'

import {useApps} from '@/providers/apps'
import {useWindowManagerOptional} from '@/providers/window-manager'
import {useIsMobile} from '@/hooks/use-is-mobile'
import {cn} from '@/shadcn-lib/utils'
import {SidebarItem} from './sidebar-item'

export function Sidebar() {
    const [isCollapsed, setIsCollapsed] = useState(false)
    const {pathname} = useLocation()
    const {userApps} = useApps()
    const windowManager = useWindowManagerOptional()
    const isMobile = useIsMobile()

    if (isMobile) return null

    const handleOpenWindow = (appId: string, route: string, title: string, icon: string) => {
        if (windowManager) {
            windowManager.openWindow(appId, route, title, icon)
        }
    }

    return (
        <div className={cn(
            'flex h-full flex-col border-r border-border-subtle bg-[#111111] transition-all duration-200',
            isCollapsed ? 'w-16' : 'w-60',
        )}>
            {/* Logo */}
            <div className={cn('flex items-center gap-3 px-4 py-4', isCollapsed && 'justify-center px-2')}>
                <div className='flex h-8 w-8 shrink-0 items-center justify-center rounded-radius-sm bg-brand'>
                    <span className='text-sm font-bold text-white'>L</span>
                </div>
                {!isCollapsed && <span className='text-heading-sm text-text-primary'>LivOS</span>}
            </div>

            {/* Main Navigation */}
            <nav className='flex flex-col gap-0.5 px-2'>
                <SidebarItem
                    icon={<RiHomeLine className='h-5 w-5' />}
                    label='Home'
                    to='/'
                    isActive={pathname === '/'}
                    isCollapsed={isCollapsed}
                />
                <SidebarItem
                    icon={<RiFolderLine className='h-5 w-5' />}
                    label='Files'
                    to='/files/Home'
                    isActive={pathname.startsWith('/files')}
                    isCollapsed={isCollapsed}
                />
                <SidebarItem
                    icon={<RiChat3Line className='h-5 w-5' />}
                    label='AI Chat'
                    onClick={() => handleOpenWindow('LIVINITY_ai-chat', '/ai-chat', 'AI Chat', 'ðŸ¤–')}
                    isCollapsed={isCollapsed}
                />
                <SidebarItem
                    icon={<RiTerminalBoxLine className='h-5 w-5' />}
                    label='Terminal'
                    onClick={() => handleOpenWindow('LIVINITY_terminal', '/terminal', 'Terminal', 'ðŸ’»')}
                    isCollapsed={isCollapsed}
                />
            </nav>

            {/* Separator */}
            <div className='mx-3 my-2 border-t border-border-subtle' />

            {/* System */}
            <nav className='flex flex-col gap-0.5 px-2'>
                <SidebarItem
                    icon={<RiServerLine className='h-5 w-5' />}
                    label='Server'
                    onClick={() => handleOpenWindow('LIVINITY_server-control', '/server-control', 'Server', 'ðŸ–¥ï¸')}
                    isCollapsed={isCollapsed}
                />
                <SidebarItem
                    icon={<RiRobotLine className='h-5 w-5' />}
                    label='Agents'
                    onClick={() => handleOpenWindow('LIVINITY_subagents', '/subagents', 'Agents', 'ðŸ¤–')}
                    isCollapsed={isCollapsed}
                />
                <SidebarItem
                    icon={<RiCalendarLine className='h-5 w-5' />}
                    label='Schedules'
                    onClick={() => handleOpenWindow('LIVINITY_schedules', '/schedules', 'Schedules', 'ðŸ“…')}
                    isCollapsed={isCollapsed}
                />
            </nav>

            {/* Separator */}
            <div className='mx-3 my-2 border-t border-border-subtle' />

            {/* Installed Apps */}
            <div className='flex-1 overflow-y-auto px-2'>
                {!isCollapsed && (
                    <div className='mb-1 px-2 text-caption text-text-tertiary'>Apps</div>
                )}
                <nav className='flex flex-col gap-0.5'>
                    {userApps?.map((app) => (
                        <SidebarItem
                            key={app.id}
                            icon={
                                <img
                                    src={app.icon}
                                    alt={app.name}
                                    className='h-5 w-5 rounded'
                                />
                            }
                            label={app.name}
                            onClick={() => {
                                if (app.url) window.open(app.url, '_blank')
                            }}
                            isCollapsed={isCollapsed}
                            statusColor={app.state === 'running' ? 'green' : app.state === 'installing' ? 'amber' : undefined}
                        />
                    ))}
                </nav>
            </div>

            {/* Bottom section */}
            <div className='flex flex-col gap-0.5 border-t border-border-subtle px-2 py-2'>
                <SidebarItem
                    icon={<RiAppsLine className='h-5 w-5' />}
                    label='App Store'
                    onClick={() => handleOpenWindow('LIVINITY_app-store', '/app-store', 'App Store', 'ðŸª')}
                    isCollapsed={isCollapsed}
                />
                <SidebarItem
                    icon={<RiSettings4Line className='h-5 w-5' />}
                    label='Settings'
                    to='/settings'
                    isActive={pathname.startsWith('/settings')}
                    isCollapsed={isCollapsed}
                />

                {/* Collapse toggle */}
                <button
                    onClick={() => setIsCollapsed(!isCollapsed)}
                    className='flex items-center gap-3 rounded-radius-sm px-2 py-1.5 text-text-tertiary transition-colors hover:text-text-secondary'
                >
                    {isCollapsed ? (
                        <RiMenuUnfoldLine className='h-5 w-5 mx-auto' />
                    ) : (
                        <>
                            <RiMenuFoldLine className='h-5 w-5' />
                            <span className='text-body-sm'>Collapse</span>
                        </>
                    )}
                </button>
            </div>
        </div>
    )
}
```
  </action>
</task>

<task type="auto">
  <name>Task 3: Create sidebar index</name>
  <files>livos/packages/ui/src/modules/sidebar/index.ts (NEW)</files>
  <action>
Create `livos/packages/ui/src/modules/sidebar/index.ts`:

```ts
export {Sidebar} from './sidebar'
export {SidebarItem} from './sidebar-item'
```
  </action>
</task>

</tasks>

<verification>
1. All 3 files created in modules/sidebar/
2. Sidebar renders with proper sections (logo, nav, apps, bottom)
3. SidebarItem supports icon, label, to/onClick, badge, status
4. Collapse toggle works
5. Run `cd livos && pnpm build` to verify no import errors
</verification>

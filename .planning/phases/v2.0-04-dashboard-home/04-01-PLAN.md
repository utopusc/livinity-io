---
phase: v2.0-04-dashboard-home
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - livos/packages/ui/src/modules/dashboard/widget-grid.tsx (NEW)
  - livos/packages/ui/src/modules/dashboard/widgets/system-health-widget.tsx (NEW)
  - livos/packages/ui/src/modules/dashboard/widgets/pinned-apps-widget.tsx (NEW)
  - livos/packages/ui/src/modules/dashboard/widgets/quick-actions-widget.tsx (NEW)
  - livos/packages/ui/src/modules/dashboard/widgets/recent-files-widget.tsx (NEW)
  - livos/packages/ui/src/modules/dashboard/index.ts (NEW)
autonomous: true

must_haves:
  truths:
    - "Dashboard widget grid component exists with bento-style mixed-size layout"
    - "System health widget shows CPU, RAM, disk usage with progress bars"
    - "Pinned apps widget shows installed apps with status dots"
    - "Quick actions widget has buttons for common operations"
    - "Recent files widget placeholder exists"
---

<objective>
Create the dashboard widget system to replace the current icon grid home screen. The dashboard uses a bento-style grid layout with mixed-size widgets showing live system data.

Widgets use existing hooks:
- useCpu() from @/hooks/use-cpu
- useMemoryForUi() from @/hooks/use-memory
- useDiskForUi() from @/hooks/use-disk
- useCpuTemperature() from @/hooks/use-cpu-temperature
- useApps() from @/providers/apps
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Create SystemHealthWidget</name>
  <files>livos/packages/ui/src/modules/dashboard/widgets/system-health-widget.tsx (NEW)</files>
  <action>
Create directory structure `livos/packages/ui/src/modules/dashboard/widgets/` and file:

```tsx
import {useCpu} from '@/hooks/use-cpu'
import {useMemoryForUi} from '@/hooks/use-memory'
import {useDiskForUi} from '@/hooks/use-disk'
import {useCpuTemperature} from '@/hooks/use-cpu-temperature'

function ProgressBar({value, color}: {value: number; color: string}) {
    return (
        <div className='h-1.5 w-full rounded-full bg-surface-2'>
            <div
                className='h-full rounded-full transition-all duration-500'
                style={{width: `${Math.min(100, value)}%`, backgroundColor: color}}
            />
        </div>
    )
}

function StatRow({label, value, percent, color}: {label: string; value: string; percent: number; color: string}) {
    return (
        <div className='flex flex-col gap-1.5'>
            <div className='flex items-center justify-between'>
                <span className='text-caption text-text-secondary'>{label}</span>
                <span className='text-caption font-medium text-text-primary'>{value}</span>
            </div>
            <ProgressBar value={percent} color={color} />
        </div>
    )
}

export function SystemHealthWidget() {
    const cpu = useCpu({poll: true})
    const memory = useMemoryForUi({poll: true})
    const disk = useDiskForUi({poll: true})
    const temp = useCpuTemperature({poll: true})

    const cpuPercent = cpu.data ?? 0
    const memPercent = (memory.progress ?? 0) * 100
    const diskPercent = (disk.progress ?? 0) * 100
    const temperature = temp.data

    return (
        <div className='flex flex-col gap-4 rounded-radius-md border border-border-subtle bg-surface-base p-4'>
            <div className='flex items-center justify-between'>
                <h3 className='text-body font-medium text-text-primary'>System Health</h3>
                {temperature !== undefined && (
                    <span className='text-caption text-text-tertiary'>{temperature}Â°C</span>
                )}
            </div>
            <div className='flex flex-col gap-3'>
                <StatRow
                    label='CPU'
                    value={`${Math.round(cpuPercent)}%`}
                    percent={cpuPercent}
                    color={cpuPercent > 80 ? '#EF4444' : cpuPercent > 50 ? '#F59E0B' : '#10B981'}
                />
                <StatRow
                    label='Memory'
                    value={memory.isLoading ? 'â€”' : memory.value}
                    percent={memPercent}
                    color={memPercent > 80 ? '#EF4444' : memPercent > 50 ? '#F59E0B' : '#3B82F6'}
                />
                <StatRow
                    label='Disk'
                    value={disk.isLoading ? 'â€”' : disk.value}
                    percent={diskPercent}
                    color={diskPercent > 90 ? '#EF4444' : diskPercent > 70 ? '#F59E0B' : '#8B5CF6'}
                />
            </div>
        </div>
    )
}
```

IMPORTANT: Read the actual hook files (use-cpu.ts, use-memory.ts, use-disk.ts, use-cpu-temperature.ts) first to verify the exact return types and parameter names before writing the component. Adjust the code to match the actual hook APIs.
  </action>
</task>

<task type="auto">
  <name>Task 2: Create PinnedAppsWidget</name>
  <files>livos/packages/ui/src/modules/dashboard/widgets/pinned-apps-widget.tsx (NEW)</files>
  <action>
```tsx
import {useApps} from '@/providers/apps'
import {cn} from '@/shadcn-lib/utils'

export function PinnedAppsWidget() {
    const {userApps} = useApps()

    if (!userApps || userApps.length === 0) {
        return (
            <div className='flex flex-col items-center justify-center gap-2 rounded-radius-md border border-border-subtle bg-surface-base p-6'>
                <p className='text-body text-text-secondary'>No apps installed</p>
                <p className='text-caption text-text-tertiary'>Visit the App Store to get started</p>
            </div>
        )
    }

    return (
        <div className='flex flex-col gap-3 rounded-radius-md border border-border-subtle bg-surface-base p-4'>
            <h3 className='text-body font-medium text-text-primary'>Installed Apps</h3>
            <div className='grid grid-cols-4 gap-3'>
                {userApps.slice(0, 8).map((app) => (
                    <a
                        key={app.id}
                        href={app.url || '#'}
                        target='_blank'
                        rel='noopener noreferrer'
                        className='flex flex-col items-center gap-1.5 rounded-radius-sm p-2 transition-colors hover:bg-surface-1'
                    >
                        <div className='relative'>
                            <img
                                src={app.icon}
                                alt={app.name}
                                className='h-10 w-10 rounded-radius-sm'
                            />
                            <div className={cn(
                                'absolute -bottom-0.5 -right-0.5 h-2.5 w-2.5 rounded-full border-2 border-surface-base',
                                app.state === 'running' ? 'bg-emerald-400' : 'bg-text-tertiary',
                            )} />
                        </div>
                        <span className='max-w-full truncate text-caption text-text-secondary'>{app.name}</span>
                    </a>
                ))}
            </div>
        </div>
    )
}
```

IMPORTANT: Read the apps provider (providers/apps.tsx) to verify what properties are available on app objects (app.icon, app.url, app.state, app.name, etc.). Adjust the code to match.
  </action>
</task>

<task type="auto">
  <name>Task 3: Create QuickActionsWidget</name>
  <files>livos/packages/ui/src/modules/dashboard/widgets/quick-actions-widget.tsx (NEW)</files>
  <action>
```tsx
import {RiRefreshLine, RiShieldCheckLine, RiRestartLine, RiTerminalBoxLine} from 'react-icons/ri'
import {useWindowManagerOptional} from '@/providers/window-manager'

function ActionButton({icon, label, onClick}: {icon: React.ReactNode; label: string; onClick?: () => void}) {
    return (
        <button
            onClick={onClick}
            className='flex flex-col items-center gap-1.5 rounded-radius-sm p-3 text-text-secondary transition-colors hover:bg-surface-1 hover:text-text-primary'
        >
            {icon}
            <span className='text-caption'>{label}</span>
        </button>
    )
}

export function QuickActionsWidget() {
    const windowManager = useWindowManagerOptional()

    return (
        <div className='flex flex-col gap-3 rounded-radius-md border border-border-subtle bg-surface-base p-4'>
            <h3 className='text-body font-medium text-text-primary'>Quick Actions</h3>
            <div className='grid grid-cols-2 gap-1'>
                <ActionButton
                    icon={<RiRefreshLine className='h-5 w-5' />}
                    label='Update Apps'
                />
                <ActionButton
                    icon={<RiShieldCheckLine className='h-5 w-5' />}
                    label='System Info'
                />
                <ActionButton
                    icon={<RiTerminalBoxLine className='h-5 w-5' />}
                    label='Terminal'
                    onClick={() => windowManager?.openWindow('LIVINITY_terminal', '/terminal', 'Terminal', 'ðŸ’»')}
                />
                <ActionButton
                    icon={<RiRestartLine className='h-5 w-5' />}
                    label='Restart'
                />
            </div>
        </div>
    )
}
```
  </action>
</task>

<task type="auto">
  <name>Task 4: Create WidgetGrid layout and dashboard index</name>
  <files>livos/packages/ui/src/modules/dashboard/widget-grid.tsx (NEW), livos/packages/ui/src/modules/dashboard/index.ts (NEW)</files>
  <action>
Create `widget-grid.tsx`:

```tsx
import {SystemHealthWidget} from './widgets/system-health-widget'
import {PinnedAppsWidget} from './widgets/pinned-apps-widget'
import {QuickActionsWidget} from './widgets/quick-actions-widget'

export function WidgetGrid() {
    return (
        <div className='mx-auto w-full max-w-5xl px-6 py-8'>
            <div className='mb-6'>
                <h1 className='text-heading-lg text-text-primary'>Dashboard</h1>
                <p className='mt-1 text-body text-text-secondary'>Welcome back</p>
            </div>
            <div className='grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3'>
                {/* System Health - spans 1 column */}
                <SystemHealthWidget />
                {/* Pinned Apps - spans 2 columns on large screens */}
                <div className='lg:col-span-2'>
                    <PinnedAppsWidget />
                </div>
                {/* Quick Actions - spans 1 column */}
                <QuickActionsWidget />
            </div>
        </div>
    )
}
```

Create `index.ts`:
```ts
export {WidgetGrid} from './widget-grid'
```
  </action>
</task>

</tasks>

<verification>
1. All widget files created in modules/dashboard/widgets/
2. WidgetGrid renders a responsive grid layout
3. System health widget uses existing hooks
4. Run `cd livos && pnpm build` to verify
</verification>

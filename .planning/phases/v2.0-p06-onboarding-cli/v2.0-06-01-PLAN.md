---
phase: v2.0-p06-onboarding-cli
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - nexus/packages/cli/package.json
  - nexus/packages/cli/tsconfig.json
  - nexus/packages/cli/src/index.ts
  - nexus/packages/cli/src/commands/status.ts
  - nexus/packages/cli/src/lib/checks.ts
  - nexus/packages/cli/src/lib/ui.ts
  - nexus/package.json
autonomous: true

must_haves:
  truths:
    - "Running `npx livinity status` shows health of services with colored indicators"
    - "Running `npx livinity` with no args displays help with available commands"
    - "System prerequisite checks report Docker, Node.js 22+, Redis, disk, RAM status"
  artifacts:
    - path: "nexus/packages/cli/package.json"
      provides: "CLI package manifest with bin entry for livinity"
      contains: '"bin"'
    - path: "nexus/packages/cli/src/index.ts"
      provides: "CLI entrypoint with commander program definition"
      contains: "program"
    - path: "nexus/packages/cli/src/commands/status.ts"
      provides: "Status command showing PM2 service health"
      contains: "status"
    - path: "nexus/packages/cli/src/lib/checks.ts"
      provides: "System prerequisite check functions"
      contains: "checkPrerequisites"
  key_links:
    - from: "nexus/packages/cli/src/index.ts"
      to: "nexus/packages/cli/src/commands/status.ts"
      via: "commander .command() registration"
      pattern: "program\\.command"
    - from: "nexus/packages/cli/src/commands/status.ts"
      to: "PM2 process list"
      via: "execSync pm2 jlist"
      pattern: "pm2 jlist"
---

<objective>
Scaffold the `nexus/packages/cli` package with commander + @clack/prompts, implement system prerequisite checks, and create the `livinity status` command.

Purpose: This is the foundation of the onboarding CLI. It establishes the package structure, CLI entrypoint with commander, shared UI utilities with @clack/prompts, and the first useful command (`status`) that shows PM2 service health. The prerequisite check module will be reused by the `onboard` command in Plan 02.

Output: A working `livinity` CLI package that can be run via `npx livinity status` and displays PM2 service health with colored indicators.
</objective>

<execution_context>
@C:\Users\hello\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\hello\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Key codebase references:
@nexus/package.json — workspace config (npm workspaces, packages/*)
@nexus/packages/core/package.json — example of existing nexus package structure
@nexus/deploy/ecosystem.config.cjs — PM2 service definitions for nexus
@livos/ecosystem.config.cjs — PM2 service definitions for livos
@livos/.env.example — canonical environment variable template
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold CLI package with commander + clack + system checks</name>
  <files>
    nexus/packages/cli/package.json
    nexus/packages/cli/tsconfig.json
    nexus/packages/cli/src/index.ts
    nexus/packages/cli/src/lib/checks.ts
    nexus/packages/cli/src/lib/ui.ts
    nexus/package.json
  </files>
  <action>
    Create `nexus/packages/cli/` directory with the following structure:

    **package.json:**
    - name: "livinity" (this is the npx-invocable name)
    - version: "2.0.0"
    - type: "module"
    - bin: { "livinity": "./dist/index.js" }
    - main: "dist/index.js"
    - scripts: { "build": "tsc", "dev": "tsx src/index.ts" }
    - dependencies: commander (^13.0.0), @clack/prompts (^0.10.0), picocolors (^1.1.0)
    - devDependencies: typescript (^5.7.0), @types/node (^22.0.0), tsx (^4.0.0)

    **tsconfig.json:**
    - Extend nothing (standalone), target ES2022, module NodeNext, moduleResolution NodeNext
    - outDir: "dist", rootDir: "src", strict: true, esModuleInterop: true
    - include: ["src/**/*.ts"]

    **src/index.ts** — CLI entrypoint:
    - Add `#!/usr/bin/env node` shebang at top
    - Import { program } from 'commander'
    - Set program name 'livinity', description 'LivOS Onboarding CLI', version from package.json
    - Register `status` command (from ./commands/status.js)
    - Register `onboard` command as placeholder: `.command('onboard').description('Set up LivOS on this server').action(() => { console.log('Not yet implemented') })`
    - Call program.parse()

    **src/lib/checks.ts** — System prerequisite checks:
    - Export interface `CheckResult { name: string; ok: boolean; version?: string; message: string }`
    - Export async function `checkPrerequisites(): Promise<CheckResult[]>` that checks:
      1. Node.js >= 22 (via `node --version`, parse major)
      2. Docker installed (via `docker --version`)
      3. Redis reachable (via `redis-cli ping`, expect PONG)
      4. PM2 installed (via `pm2 --version`)
      5. Disk space >= 10GB (via `df -BG /` and parse available column)
      6. RAM >= 4GB (via reading `/proc/meminfo` MemTotal or `free -g`)
    - Each check should catch errors gracefully and return ok:false with helpful message
    - Use `execSync` with stdio: ['pipe','pipe','pipe'] and encoding: 'utf-8'

    **src/lib/ui.ts** — Shared UI utilities:
    - Export ANSI color helpers using picocolors: `success()`, `warning()`, `error()`, `info()`, `dim()`
    - Export `banner()` function that prints the Livinity ASCII art banner (use a simple stylized "LIVINITY" text, not elaborate)
    - Export `printCheckResults(results: CheckResult[])` that formats prerequisite check results with green checkmark / red X indicators

    **Update nexus/package.json:**
    - The workspaces array is already `["packages/*"]` so cli will be auto-detected
    - No changes needed to root package.json unless workspaces pattern is different

    IMPORTANT: Do NOT use @clack/prompts in this plan (save for Plan 02). This plan only uses commander and picocolors for the CLI framework and status display.
  </action>
  <verify>
    Run from nexus/packages/cli:
    ```
    npm install
    npx tsc --noEmit
    ```
    TypeScript compiles without errors.
  </verify>
  <done>CLI package exists at nexus/packages/cli with commander entrypoint, prerequisite check module, and UI utilities. TypeScript compiles cleanly.</done>
</task>

<task type="auto">
  <name>Task 2: Implement `livinity status` command with PM2 health display</name>
  <files>
    nexus/packages/cli/src/commands/status.ts
  </files>
  <action>
    Create `src/commands/status.ts`:

    Export a function `registerStatusCommand(program: Command)` that registers the `status` command.

    The `status` command should:
    1. Print the Livinity banner
    2. Run prerequisite checks and display results via `printCheckResults()`
    3. Check PM2 services by running `pm2 jlist` and parsing JSON output
    4. Display a table of services with columns: Name, Status, Uptime, Memory, Restarts
    5. Color the status: green for "online", red for "errored"/"stopped", yellow for "launching"
    6. Expected services (from production setup): livos, nexus-core, nexus-mcp, nexus-memory, nexus-worker
    7. If PM2 is not installed or `pm2 jlist` fails, show a warning message instead of crashing
    8. At the bottom, show a summary line: "X/Y services running"

    PM2 jlist output format (JSON array of objects):
    ```json
    [{ "name": "livos", "pm2_env": { "status": "online", "pm_uptime": 1234567890 }, "monit": { "memory": 123456789, "cpu": 1.5 } }]
    ```

    Format uptime as human-readable (e.g., "2d 3h", "45m", "12s").
    Format memory as MB (e.g., "123 MB").

    Use picocolors for all coloring. Use console.log with manual padding for table alignment (no external table library needed).
  </action>
  <verify>
    Run:
    ```
    cd nexus/packages/cli
    npx tsc --noEmit
    ```
    TypeScript compiles without errors. The status command is properly registered and handles missing PM2 gracefully.
  </verify>
  <done>`livinity status` command shows system prerequisites and PM2 service health table with colored status indicators, uptime, memory, and restart count. Handles missing PM2 gracefully.</done>
</task>

</tasks>

<verification>
1. `nexus/packages/cli/package.json` exists with correct bin entry
2. `npx tsc --noEmit` passes in the cli package directory
3. The CLI entrypoint has proper shebang and commander setup
4. System checks cover all 6 prerequisites (Node, Docker, Redis, PM2, disk, RAM)
5. Status command parses PM2 jlist output and displays formatted table
</verification>

<success_criteria>
- CLI package scaffolded at nexus/packages/cli with commander framework
- `livinity status` shows prerequisite checks and PM2 service health
- `livinity --help` shows available commands (status, onboard)
- All TypeScript compiles without errors
- No external dependencies beyond commander, picocolors (clack saved for Plan 02)
</success_criteria>

<output>
After completion, create `.planning/phases/v2.0-p06-onboarding-cli/v2.0-06-01-SUMMARY.md`
</output>

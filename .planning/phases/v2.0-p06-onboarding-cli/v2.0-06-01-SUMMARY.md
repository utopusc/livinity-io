---
phase: v2.0-p06-onboarding-cli
plan: 01
subsystem: cli
tags: [commander, picocolors, cli, pm2, system-checks]

# Dependency graph
requires: []
provides:
  - CLI package scaffold at nexus/packages/cli with commander entrypoint
  - System prerequisite check module (Node, Docker, Redis, PM2, disk, RAM)
  - Shared UI utilities (banner, colored output, table formatting)
  - livinity status command with PM2 health display
affects: [v2.0-06-02, v2.0-06-03]

# Tech tracking
tech-stack:
  added: [commander@13, picocolors@1.1]
  patterns: [registerCommand pattern for modular CLI commands, CheckResult interface for system checks]

key-files:
  created:
    - nexus/packages/cli/package.json
    - nexus/packages/cli/tsconfig.json
    - nexus/packages/cli/src/index.ts
    - nexus/packages/cli/src/commands/status.ts
    - nexus/packages/cli/src/lib/checks.ts
    - nexus/packages/cli/src/lib/ui.ts
  modified:
    - nexus/package-lock.json

key-decisions:
  - "Standalone tsconfig (NodeNext module) instead of extending nexus/tsconfig.base.json — CLI runs as direct Node binary"
  - "registerStatusCommand(program) pattern — each command gets its own file and registers on the shared program instance"
  - "picocolors only (no @clack/prompts) — clack saved for Plan 02 onboard wizard"

patterns-established:
  - "CLI command registration: export registerXCommand(program: Command) from commands/*.ts"
  - "CheckResult interface: { name, ok, version?, message } for all system checks"
  - "Graceful PM2 detection: try pm2 jlist, show warning if unavailable"

# Metrics
duration: 3min
completed: 2026-02-21
---

# Phase 6 Plan 01: CLI Scaffold + Status Command Summary

**Commander-based CLI with system prerequisite checks (Node/Docker/Redis/PM2/disk/RAM) and PM2 service health table with colored status indicators**

## Performance

- **Duration:** 3 min
- **Started:** 2026-02-21T03:01:12Z
- **Completed:** 2026-02-21T03:04:18Z
- **Tasks:** 2
- **Files modified:** 7

## Accomplishments
- CLI package at nexus/packages/cli with `livinity` bin entry and commander framework
- System prerequisite checks covering all 6 categories with graceful error handling
- `livinity status` command showing PM2 service health as formatted table with uptime, memory, restarts
- `livinity --help` shows available commands (status, onboard placeholder)
- All TypeScript compiles cleanly with strict mode

## Task Commits

Each task was committed atomically:

1. **Task 1: Scaffold CLI package with commander, checks, and UI utils** - `1211320` (feat)
2. **Task 2: Implement livinity status command with PM2 health display** - `ef37f93` (feat)

## Files Created/Modified
- `nexus/packages/cli/package.json` - CLI package manifest with bin entry for livinity
- `nexus/packages/cli/tsconfig.json` - Standalone TypeScript config (NodeNext module)
- `nexus/packages/cli/src/index.ts` - CLI entrypoint with commander program definition
- `nexus/packages/cli/src/commands/status.ts` - Status command: prerequisites + PM2 service table
- `nexus/packages/cli/src/lib/checks.ts` - System prerequisite check functions (6 checks)
- `nexus/packages/cli/src/lib/ui.ts` - Shared UI: banner, color helpers, table formatting
- `nexus/package-lock.json` - Updated lockfile with commander + picocolors

## Decisions Made
- Used standalone tsconfig with `module: "NodeNext"` instead of extending nexus/tsconfig.base.json. The CLI runs as a direct Node.js binary and needs proper ESM module resolution, not bundler-style.
- Each command follows `registerXCommand(program)` pattern for modular registration. This keeps the entrypoint clean and allows Plan 02/03 to add commands without modifying existing files.
- Deferred @clack/prompts to Plan 02 as specified. This plan uses only commander and picocolors.
- Expected services list includes all 5 production PM2 processes: livos, nexus-core, nexus-mcp, nexus-memory, nexus-worker.

## Deviations from Plan
None - plan executed exactly as written.

## Issues Encountered
None.

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- CLI package ready for Plan 02 to add the interactive `onboard` wizard with @clack/prompts
- `checkPrerequisites()` function ready for reuse in onboard command
- `registerStatusCommand` pattern established for adding new commands

---
*Phase: v2.0-p06-onboarding-cli*
*Completed: 2026-02-21*

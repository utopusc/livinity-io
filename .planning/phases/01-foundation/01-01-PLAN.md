---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - livos/packages/config/package.json
  - livos/packages/config/tsconfig.json
  - livos/packages/config/src/index.ts
  - livos/packages/config/src/paths.ts
  - livos/packages/config/src/domains.ts
  - livos/packages/config/src/services.ts
  - livos/packages/config/src/env.ts
autonomous: true

must_haves:
  truths:
    - "Config module can be imported by other livos packages"
    - "Path configuration provides typed access to base, data, logs, skills directories"
    - "Domain configuration provides typed access to primary domain"
    - "Service URLs configuration provides typed access to Nexus API URL"
    - "All config values have sensible defaults for development"
    - "Environment variables override defaults at runtime"
  artifacts:
    - path: "livos/packages/config/package.json"
      provides: "Package manifest with @livos/config name"
      contains: "@livos/config"
    - path: "livos/packages/config/src/index.ts"
      provides: "Main export with paths, domains, services"
      exports: ["paths", "domains", "services"]
    - path: "livos/packages/config/src/paths.ts"
      provides: "Path configuration with Zod schema"
      contains: "PathsConfigSchema"
    - path: "livos/packages/config/src/domains.ts"
      provides: "Domain configuration with Zod schema"
      contains: "DomainsConfigSchema"
    - path: "livos/packages/config/src/services.ts"
      provides: "Service URLs configuration with Zod schema"
      contains: "ServicesConfigSchema"
  key_links:
    - from: "livos/packages/config/src/index.ts"
      to: "livos/packages/config/src/paths.ts"
      via: "import and re-export"
      pattern: "from './paths'"
    - from: "livos/packages/config/src/index.ts"
      to: "livos/packages/config/src/domains.ts"
      via: "import and re-export"
      pattern: "from './domains'"
---

<objective>
Create a centralized configuration package (@livos/config) that provides typed access to paths, domains, and service URLs.

Purpose: Replace scattered hardcoded values with a single source of truth that can be imported across the livos monorepo. This is the foundation for Phase 5 (Configurability) where hardcoded values will be replaced with config imports.

Output: A new `livos/packages/config/` package with Zod schemas for validation and typed exports.
</objective>

<execution_context>
@C:\Users\hello\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\hello\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md

Reference the existing Zod config patterns:
@nexus/packages/core/src/config/schema.ts
@nexus/packages/core/src/config/manager.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create config package structure</name>
  <files>
    livos/packages/config/package.json
    livos/packages/config/tsconfig.json
    livos/packages/config/src/env.ts
  </files>
  <action>
Create the config package directory and base files:

1. Create `livos/packages/config/package.json`:
   - name: "@livos/config"
   - version: "0.1.0"
   - type: "module"
   - main: "dist/index.js"
   - types: "dist/index.d.ts"
   - exports: { ".": { "import": "./dist/index.js", "types": "./dist/index.d.ts" } }
   - scripts: { "build": "tsc", "dev": "tsc --watch" }
   - dependencies: { "zod": "^3.21.4", "dotenv": "^16.3.1" }
   - devDependencies: { "typescript": "^5.7.0" }

2. Create `livos/packages/config/tsconfig.json`:
   - Extend from root tsconfig if exists, otherwise create standalone
   - compilerOptions: module "ESNext", target "ES2022", moduleResolution "bundler"
   - outDir: "dist", rootDir: "src"
   - declaration: true, declarationMap: true
   - strict: true

3. Create `livos/packages/config/src/env.ts`:
   - Import 'dotenv/config' at top to load .env
   - Export a helper function `getEnv(key: string, defaultValue?: string): string | undefined`
   - This centralizes all process.env access
  </action>
  <verify>
Run: `ls livos/packages/config/` shows package.json, tsconfig.json, src/
Run: `cat livos/packages/config/package.json | grep "@livos/config"` returns the name
  </verify>
  <done>
Package structure exists with valid package.json and tsconfig.json
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Zod schemas for paths, domains, and services</name>
  <files>
    livos/packages/config/src/paths.ts
    livos/packages/config/src/domains.ts
    livos/packages/config/src/services.ts
  </files>
  <action>
Create the three configuration schemas following patterns from research:

1. Create `livos/packages/config/src/paths.ts`:
```typescript
import { z } from 'zod';

export const PathsConfigSchema = z.object({
  /** Base installation directory for LivOS */
  base: z.string().default('/opt/livos'),
  /** Base installation directory for Nexus */
  nexusBase: z.string().default('/opt/nexus'),
  /** Data directory for persistent storage */
  data: z.string().default('/opt/livos/data'),
  /** Logs directory */
  logs: z.string().default('/opt/livos/logs'),
  /** Skills directory for LivOS */
  skills: z.string().default('/opt/livos/skills'),
  /** Skills directory for Nexus */
  nexusSkills: z.string().default('/opt/nexus/app/skills'),
  /** Workspace directory */
  workspace: z.string().default('/opt/nexus/workspace'),
});

export type PathsConfig = z.infer<typeof PathsConfigSchema>;
```

2. Create `livos/packages/config/src/domains.ts`:
```typescript
import { z } from 'zod';

export const DomainsConfigSchema = z.object({
  /** Primary domain for the installation */
  primary: z.string().default('localhost'),
  /** Whether to use HTTPS */
  useHttps: z.boolean().default(false),
});

export type DomainsConfig = z.infer<typeof DomainsConfigSchema>;
```

3. Create `livos/packages/config/src/services.ts`:
```typescript
import { z } from 'zod';

export const ServicesConfigSchema = z.object({
  /** Nexus API base URL */
  nexusApi: z.string().url().default('http://localhost:3200'),
  /** Memory service URL */
  memoryService: z.string().url().default('http://localhost:3300'),
  /** Redis URL */
  redis: z.string().default('redis://localhost:6379'),
});

export type ServicesConfig = z.infer<typeof ServicesConfigSchema>;
```

All schemas use `.default()` for development-friendly defaults. Production values come from environment variables.
  </action>
  <verify>
Run: `cat livos/packages/config/src/paths.ts | grep "PathsConfigSchema"` returns the export
Run: `cat livos/packages/config/src/domains.ts | grep "DomainsConfigSchema"` returns the export
Run: `cat livos/packages/config/src/services.ts | grep "ServicesConfigSchema"` returns the export
  </verify>
  <done>
Three schema files exist with Zod schemas and TypeScript types exported
  </done>
</task>

<task type="auto">
  <name>Task 3: Create main index.ts with frozen config exports</name>
  <files>
    livos/packages/config/src/index.ts
  </files>
  <action>
Create the main export file that loads environment and exports frozen config objects:

Create `livos/packages/config/src/index.ts`:
```typescript
import 'dotenv/config';
import { PathsConfigSchema, type PathsConfig } from './paths.js';
import { DomainsConfigSchema, type DomainsConfig } from './domains.js';
import { ServicesConfigSchema, type ServicesConfig } from './services.js';

// Load paths from environment with LIVOS_ prefix
export const paths: PathsConfig = Object.freeze(PathsConfigSchema.parse({
  base: process.env.LIVOS_BASE_DIR,
  nexusBase: process.env.NEXUS_BASE_DIR,
  data: process.env.LIVOS_DATA_DIR,
  logs: process.env.LIVOS_LOGS_DIR,
  skills: process.env.LIVOS_SKILLS_DIR,
  nexusSkills: process.env.NEXUS_SKILLS_DIR,
  workspace: process.env.NEXUS_WORKSPACE_DIR,
}));

// Load domains from environment
export const domains: DomainsConfig = Object.freeze(DomainsConfigSchema.parse({
  primary: process.env.LIVOS_DOMAIN,
  useHttps: process.env.LIVOS_USE_HTTPS === 'true',
}));

// Load service URLs from environment
export const services: ServicesConfig = Object.freeze(ServicesConfigSchema.parse({
  nexusApi: process.env.NEXUS_API_URL,
  memoryService: process.env.MEMORY_SERVICE_URL,
  redis: process.env.REDIS_URL,
}));

// Re-export types and schemas for consumers who need them
export { PathsConfigSchema, type PathsConfig } from './paths.js';
export { DomainsConfigSchema, type DomainsConfig } from './domains.js';
export { ServicesConfigSchema, type ServicesConfig } from './services.js';
```

Key design decisions:
- Use Object.freeze() to prevent runtime mutations (anti-pattern from research)
- Zod's .parse() validates at load time, failing fast on invalid config
- Environment variables use LIVOS_ prefix for shared, NEXUS_ for Nexus-specific
- Re-export schemas for consumers who need custom validation
  </action>
  <verify>
Run from livos/packages/config:
```bash
cd livos/packages/config && pnpm install && pnpm build
```
Build should complete without errors.

Then verify exports:
```bash
cat livos/packages/config/dist/index.d.ts | grep "export"
```
Should show paths, domains, services exports.
  </verify>
  <done>
- index.ts exports paths, domains, services as frozen objects
- Package builds successfully with TypeScript
- Type definitions are generated in dist/
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Package structure is correct:
   ```bash
   ls -la livos/packages/config/src/
   # Should show: env.ts, index.ts, paths.ts, domains.ts, services.ts
   ```

2. Package builds without errors:
   ```bash
   cd livos/packages/config && pnpm build
   # Should complete with no errors
   ```

3. TypeScript types are generated:
   ```bash
   ls livos/packages/config/dist/
   # Should show: .js and .d.ts files
   ```

4. Config can be imported (create a quick test):
   ```bash
   cd livos/packages/config
   node -e "import('./dist/index.js').then(c => console.log('paths:', c.paths, 'domains:', c.domains))"
   ```
   Should output the default config values.
</verification>

<success_criteria>
1. `livos/packages/config/` directory exists with all source files
2. `pnpm build` succeeds in the config package
3. Exports `paths`, `domains`, `services` as frozen typed objects
4. All config values have development-friendly defaults
5. Environment variables can override defaults (tested by setting LIVOS_DOMAIN=test.local)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>

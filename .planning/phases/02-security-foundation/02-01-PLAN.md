---
phase: 02-security-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - livos/packages/ui/.gitignore
  - livos/packages/livinityd/.gitignore
  - livos/.env.example
  - livos/packages/liv/.env.example
  - nexus/.env.example
autonomous: true

must_haves:
  truths:
    - "No .env files are tracked by git (verified with git ls-files)"
    - "Existing local .env files (livos/.env, livos/packages/liv/.env) are gitignored and not in repository history"
    - "Developer can copy .env.example to .env and know what to fill in"
    - "All environment variables from @livos/config are documented"
    - "Secret generation instructions are provided in comments"
    - "No placeholder values look like real credentials"
  artifacts:
    - path: "livos/.env.example"
      provides: "Canonical environment template for deployment"
      contains: "LIVOS_BASE_DIR"
    - path: "livos/packages/ui/.gitignore"
      provides: ".env exclusion for UI package"
      contains: ".env"
    - path: "livos/packages/livinityd/.gitignore"
      provides: ".env exclusion for daemon package"
      contains: ".env"
  key_links:
    - from: "livos/.env.example"
      to: "@livos/config variables"
      via: "documented environment variables"
      pattern: "LIVOS_BASE_DIR|NEXUS_BASE_DIR|LIVOS_DOMAIN"
---

<objective>
Secure environment configuration by ensuring all .gitignore files exclude .env files and creating a comprehensive, well-documented .env.example template.

Purpose: Prevent accidental secret commits and enable developers to set up the project from documentation alone.
Output: Updated .gitignore files and a canonical .env.example with all 23 environment variables documented.

**SEC-01 Clarification:** The existing .env files on disk (livos/.env, livos/packages/liv/.env) contain real secrets but are already gitignored and have never been committed to the repository. SEC-01 is satisfied because no hardcoded secrets exist in version control. This plan ensures the gitignore coverage is complete across all subdirectories and provides proper .env.example templates for developers setting up from a clean clone.
</objective>

<execution_context>
@C:\Users\hello\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\hello\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-security-foundation/02-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Complete .gitignore coverage for .env files</name>
  <files>
    livos/packages/ui/.gitignore
    livos/packages/livinityd/.gitignore
  </files>
  <action>
Add .env exclusion patterns to the two subdirectory .gitignore files that are missing them:

1. **livos/packages/ui/.gitignore** - Currently only has `*.local`, add:
```gitignore
# Environment files (never commit secrets)
.env
.env.*
!.env.example
```

2. **livos/packages/livinityd/.gitignore** - Has no .env coverage, add:
```gitignore
# Environment files (never commit secrets)
.env
.env.*
!.env.example
```

Place these patterns near the top of each file after existing entries.

Note: Root .gitignore and livos/.gitignore already have proper coverage from Phase 1, no changes needed there.
  </action>
  <verify>
Run: `git status | grep -E "\.env$"` - should return no .env files
Run: `git check-ignore livos/packages/ui/.env` - should output the path (meaning it's ignored)
Run: `git check-ignore livos/packages/livinityd/.env` - should output the path
  </verify>
  <done>
All .gitignore files in the monorepo exclude .env files while preserving .env.example
  </done>
</task>

<task type="auto">
  <name>Task 2: Create canonical .env.example with comprehensive documentation</name>
  <files>
    livos/.env.example
    livos/packages/liv/.env.example
    nexus/.env.example
  </files>
  <action>
**Replace** `livos/.env.example` with the canonical template that documents ALL 23 environment variables:

```
# ==============================================================================
# LIVINITY ENVIRONMENT CONFIGURATION
# ==============================================================================
# Copy this file to .env and fill in the values:
#   cp .env.example .env
#
# NEVER commit .env files with real values!
# ==============================================================================

# === AI API Keys ===
# At least one AI API key is required for AI features.
# Get from: https://aistudio.google.com/app/apikey
GEMINI_API_KEY=
# Get from: https://console.anthropic.com/settings/keys
ANTHROPIC_API_KEY=

# === Security ===
# Required: JWT signing secret (min 32 bytes)
# Generate with: openssl rand -hex 32
JWT_SECRET=

# Required: Internal API authentication key
# Generate with: openssl rand -hex 32
LIV_API_KEY=

# === Database ===
# Redis connection for caching and pub/sub
# Format: redis://[:password@]host[:port]
REDIS_URL=redis://localhost:6379

# PostgreSQL for persistent storage (optional in dev)
# Format: postgresql://user:pass@host:port/database
DATABASE_URL=

# === Server Ports ===
# Defaults shown - change if ports conflict
MCP_PORT=3100
API_PORT=3200
MEMORY_PORT=3300

# === Daemon Configuration ===
# AI daemon polling interval in milliseconds
DAEMON_INTERVAL_MS=30000
# Default AI model to use
DEFAULT_MODEL=gemini-2.0-flash

# === Paths (@livos/config) ===
# Override defaults for custom installations
# Defaults: /opt/livos and /opt/nexus
LIVOS_BASE_DIR=
NEXUS_BASE_DIR=
LIVOS_DATA_DIR=
LIVOS_LOGS_DIR=
LIVOS_SKILLS_DIR=
NEXUS_SKILLS_DIR=
NEXUS_WORKSPACE_DIR=

# === Domains (@livos/config) ===
# Primary domain for the installation
LIVOS_DOMAIN=localhost
# Set to true if using HTTPS
LIVOS_USE_HTTPS=false

# === Service URLs (@livos/config) ===
# Override if services run on different hosts
NEXUS_API_URL=http://localhost:3200
MEMORY_SERVICE_URL=http://localhost:3300

# === Environment ===
NODE_ENV=development

# === Notifications (optional) ===
# Email notifications for system alerts
NOTIFICATION_EMAIL=
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=
SMTP_PASS=

# === Integrations (optional) ===
# WhatsApp integration toggle
WHATSAPP_ENABLED=false
```

**Simplify** `livos/packages/liv/.env.example` to just reference the main file:

```
# ==============================================================================
# See livos/.env.example for the canonical template
# ==============================================================================
# This package inherits from the root .env file.
# Copy livos/.env.example to livos/.env and fill in the values.
```

**Simplify** `nexus/.env.example` to just reference the main file:

```
# ==============================================================================
# See livos/.env.example for the canonical template
# ==============================================================================
# Nexus shares environment configuration with LivOS.
# Copy livos/.env.example to livos/.env and fill in the values.
```

Key improvements from current state:
- Empty values for secrets (not "xxx" or "sk-ant-xxx")
- Generation commands provided for JWT_SECRET and LIV_API_KEY
- All @livos/config variables documented with defaults
- Clear Required vs Optional labeling
- Single source of truth (canonical template in livos/)
  </action>
  <verify>
Run: `grep -E "xxx|LivDB2024|LivRedis2024|NexusDB2024" livos/.env.example livos/packages/liv/.env.example nexus/.env.example` - should return nothing (no fake-looking passwords)
Run: `grep "LIVOS_BASE_DIR" livos/.env.example` - should return the variable (confirms @livos/config vars documented)
Run: `grep "openssl rand" livos/.env.example` - should return generation instructions
  </verify>
  <done>
- livos/.env.example is the canonical template with all 23 variables documented
- Subdirectory .env.example files reference the canonical template
- No placeholder values that look like real credentials
- Secret generation instructions included
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **No .env files tracked by git (SEC-01 verification):**
   ```bash
   git ls-files | grep -E "\.env$"
   # Should return nothing (no .env files in repository)
   ```

2. **Git status clean for .env files:**
   ```bash
   git status | grep -E "\.env$"
   # Should return nothing (no .env files staged or untracked)
   ```

3. **All .env patterns ignored:**
   ```bash
   git check-ignore livos/.env
   git check-ignore livos/packages/ui/.env
   git check-ignore livos/packages/livinityd/.env
   git check-ignore nexus/.env
   # All should output their paths (meaning ignored)
   ```

4. **Canonical template complete:**
   ```bash
   grep -c "^[A-Z].*=" livos/.env.example
   # Should return ~23 (number of variables)
   ```

5. **No dangerous placeholders:**
   ```bash
   grep -E "xxx|password|secret" livos/.env.example | grep -v "^#"
   # Should return empty (all dangerous patterns are in comments only)
   ```
</verification>

<success_criteria>
- [ ] No .env files exist in git history (git ls-files verification)
- [ ] All .gitignore files exclude .env (but preserve .env.example)
- [ ] livos/.env.example contains all 23 documented environment variables
- [ ] No placeholder values look like real credentials (no "xxx", no fake passwords)
- [ ] Generation instructions provided for JWT_SECRET and LIV_API_KEY
- [ ] All @livos/config variables documented (12 variables)
- [ ] Subdirectory .env.example files reference canonical template
</success_criteria>

<output>
After completion, create `.planning/phases/02-security-foundation/02-01-SUMMARY.md`

**SUMMARY note for SEC-01:** Document that existing local .env files (livos/.env, livos/packages/liv/.env) were already gitignored and never committed. For production deployments, recommend rotating any secrets that may have been shared during development.
</output>

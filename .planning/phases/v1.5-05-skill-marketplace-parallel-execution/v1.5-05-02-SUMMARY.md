---
phase: v1.5-05-skill-marketplace-parallel-execution
plan: 02
subsystem: skills
tags: [skill-installer, marketplace-ui, rest-api, permissions, install-uninstall]

# Dependency graph
requires:
  - phase: v1.5-05-01
    provides: SkillManifest parser, SkillRegistryClient, extended Skill interface
provides:
  - SkillInstaller class for marketplace skill lifecycle (preview, install, uninstall, list)
  - SkillLoader extensions for marketplace lazy-loading and unloading
  - Six REST API endpoints for skill marketplace operations
  - SkillsPanel UI component in LivOS AI Chat
affects:
  - frontend-skill-experience (future enhancements to skill browsing/management)
  - deployment (requires SKILL_INSTALL_DIR, SKILL_CACHE_DIR, SKILL_REGISTRY_URL env vars)

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "SkillInstaller: preview + permission gate + install + uninstall lifecycle"
    - "Redis metadata for installed skills (nexus:skills:installed:{name})"
    - "Lazy skill loading: loadSkillLazy for on-demand marketplace skill activation"
    - "Code-split SkillsPanel via React.lazy for optimal bundle size"

key-files:
  created:
    - nexus/packages/core/src/skill-installer.ts
    - livos/packages/ui/src/routes/ai-chat/skills-panel.tsx
  modified:
    - nexus/packages/core/src/skill-loader.ts
    - nexus/packages/core/src/api.ts
    - nexus/packages/core/src/index.ts
    - livos/packages/ui/src/routes/ai-chat/index.tsx

key-decisions:
  - "Permission gate: required permissions must be explicitly accepted before install proceeds"
  - "Redis SCAN for listing installed skills (production-safe, avoids KEYS)"
  - "Marketplace skills loaded from installDir at boot (loadMarketplaceSkills)"
  - "SkillsPanel follows same code-split lazy-loading pattern as McpPanel"
  - "Three-tab sidebar in AI Chat: Chat, MCP, Skills"

patterns-established:
  - "Skill marketplace lifecycle: browse -> preview permissions -> accept -> install -> use"
  - "Marketplace skill install metadata in Redis for persistence across restarts"
  - "SkillLoader.unloadSkill removes tools from ToolRegistry for clean uninstall"

# Metrics
duration: 6min
completed: 2026-02-15
---

# Phase 5 Plan 2: Skill Marketplace Install/Uninstall + UI Summary

**SkillInstaller with permission-gated install flow, six REST API endpoints, extended SkillLoader with lazy-load/unload, and SkillsPanel UI in LivOS AI Chat**

## Performance

- **Duration:** 6 min
- **Started:** 2026-02-15T11:26:30Z
- **Completed:** 2026-02-15T11:33:00Z
- **Tasks:** 3 (+ 1 auto-approved checkpoint)
- **Files modified:** 6

## Accomplishments
- SkillInstaller class: previewInstall (fetch permissions for user review), install (with permission gate), uninstall (cleanup files + Redis + ToolRegistry), listInstalled, isInstalled
- SkillLoader extended: loadMarketplaceSkills (scan subdirectories at boot), loadSkillLazy (on-demand after install), unloadSkill (remove skill + unregister tools)
- Six REST API endpoints: GET /api/skills/marketplace, GET /api/skills/installed, POST /api/skills/preview, POST /api/skills/install, POST /api/skills/uninstall, GET /api/skills/builtin
- SkillRegistryClient and SkillInstaller created and wired at Nexus startup
- SkillsPanel UI with Marketplace and Installed tabs in LivOS AI Chat
- Permission review dialog with required/optional distinction and accept-before-install flow

## Task Commits

Each task was committed atomically:

1. **Task 1: Create SkillInstaller and extend SkillLoader** - `e4b88b1` (feat)
2. **Task 2: Add REST API endpoints and wire installer** - `c5c3b1b` (feat)
3. **Task 3: Create Skills Marketplace panel in UI** - `dccc1d3` (feat)

## Files Created/Modified
- `nexus/packages/core/src/skill-installer.ts` - SkillInstaller class: preview, install (permission-gated), uninstall, listInstalled, isInstalled
- `nexus/packages/core/src/skill-loader.ts` - Extended with loadMarketplaceSkills, loadSkillLazy, unloadSkill methods
- `nexus/packages/core/src/api.ts` - Six REST endpoints for skill marketplace, SkillInstaller/SkillRegistryClient/SkillLoader in ApiDeps
- `nexus/packages/core/src/index.ts` - SkillRegistryClient + SkillInstaller creation, marketplace skills loaded at boot
- `livos/packages/ui/src/routes/ai-chat/skills-panel.tsx` - SkillsPanel component with Marketplace tab, Installed tab, PermissionDialog
- `livos/packages/ui/src/routes/ai-chat/index.tsx` - Skills tab added to AI Chat sidebar, SkillsPanel lazy-loaded

## Decisions Made
- Permission gate requires all required permissions to be explicitly accepted before install proceeds (optional permissions can be declined)
- Redis SCAN used for listing installed skills (production-safe pattern, consistent with other parts of the codebase)
- Marketplace skills auto-loaded from installDir at server boot via loadMarketplaceSkills
- SkillsPanel is code-split via React.lazy (same pattern as McpPanel) for optimal bundle size (16.35 kB chunk)
- AI Chat sidebar expanded to three tabs: Chat, MCP, Skills

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

- `SKILL_REGISTRY_URL` env var (default: `https://github.com/utopusc/livinity-skills`)
- `SKILL_INSTALL_DIR` env var (default: `/opt/nexus/skills/marketplace`)
- `SKILL_CACHE_DIR` env var (default: `/opt/nexus/data/skill-cache`)

## Next Phase Readiness
- Skill marketplace is fully functional end-to-end
- This is the FINAL plan of v1.5 - all phases complete
- The system is ready for production deployment

---
*Phase: v1.5-05-skill-marketplace-parallel-execution*
*Completed: 2026-02-15*

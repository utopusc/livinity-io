---
phase: v1.5-05-skill-marketplace-parallel-execution
plan: 01
subsystem: skills
tags: [skill-manifest, yaml-parser, github-api, registry, marketplace]

# Dependency graph
requires:
  - phase: v1.5-04-websocket-gateway-hitl
    provides: Core Nexus infrastructure (skill-types, skill-loader, tool-registry)
provides:
  - SkillManifest type and SKILL.md parser for standardized skill packaging
  - SKILL.md validation (kebab-case name, semver version, permissions)
  - Directory-based skill scanner (SKILL.md + index.ts)
  - Git-based SkillRegistryClient for fetching catalogs from GitHub repos
  - RegistryCatalogEntry type for marketplace skill discovery
  - Extended Skill interface with manifest, installedAt, source fields
affects:
  - v1.5-05-02 (skill installer, lifecycle manager)
  - v1.5-05-03 (parallel execution, tRPC routes)

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "SKILL.md manifest format: YAML frontmatter with permissions, tools, triggers"
    - "Git-based skill registry: GitHub Contents API for directory listing, raw.githubusercontent.com for file fetch"
    - "File-based catalog caching with configurable TTL"
    - "Directory-based skill format: SKILL.md + index.ts in a named directory"

key-files:
  created:
    - nexus/packages/core/src/skill-manifest.ts
    - nexus/packages/core/src/skill-registry-client.ts
  modified:
    - nexus/packages/core/src/skill-types.ts

key-decisions:
  - "Simple YAML parser for SKILL.md (no js-yaml dependency) â€” handles scalars, lists, and nested objects for permissions"
  - "Permissions as structured objects (name + reason + required) rather than plain strings"
  - "GitHub raw content fetching for individual files instead of git clone"
  - "MD5 hash of registry URL as cache key for file-based catalog caching"
  - "Default branch detection via GitHub repo metadata API"

patterns-established:
  - "SKILL.md format: YAML frontmatter (---) at top of .md file with name, version, description, tools, triggers, permissions"
  - "Skill directory layout: {skill-name}/SKILL.md + {skill-name}/index.ts"
  - "Registry catalog pattern: GitHub Contents API for listing, raw content for fetching"

# Metrics
duration: 3min
completed: 2026-02-15
---

# Phase 5 Plan 1: Skill Manifest Schema & Registry Client Summary

**SKILL.md manifest parser with YAML frontmatter, directory-based skill scanner, and GitHub-backed SkillRegistryClient with file-based caching**

## Performance

- **Duration:** 3 min
- **Started:** 2026-02-15T11:19:55Z
- **Completed:** 2026-02-15T11:23:07Z
- **Tasks:** 2
- **Files modified:** 3

## Accomplishments
- Defined SkillManifest type with permissions, tools, triggers, execution config, and marketplace metadata
- Built SKILL.md parser that handles YAML frontmatter including nested permission objects
- Created SkillRegistryClient that fetches skill catalogs from GitHub repos via Contents API
- Extended Skill interface with marketplace fields (manifest, installedAt, source)

## Task Commits

Each task was committed atomically:

1. **Task 1: Create SKILL.md manifest schema and directory scanner** - `db68dc0` (feat)
2. **Task 2: Create Git-based skill registry client** - `79328f2` (feat)

## Files Created/Modified
- `nexus/packages/core/src/skill-manifest.ts` - SkillManifest type, parseSkillManifest, validateManifest, scanSkillDirectory
- `nexus/packages/core/src/skill-registry-client.ts` - SkillRegistryClient class, RegistryCatalogEntry type, catalog fetching/caching/search/download
- `nexus/packages/core/src/skill-types.ts` - Extended Skill interface with manifest?, installedAt?, source? fields

## Decisions Made
- Used a simple hand-rolled YAML parser (no js-yaml dependency) consistent with the existing parseFrontmatter in skill-loader.ts. Extended it to handle nested objects (for permissions with name/reason/required sub-keys).
- Permissions are structured as objects with name, reason, and required fields rather than plain permission name strings, providing clear audit trail for what each skill needs and why.
- Used GitHub raw content fetching for individual files (SKILL.md, index.ts) rather than git clone, keeping downloads lightweight and avoiding git dependency.
- Cache keys use MD5 hash of registry URL (first 8 chars), matching the pattern used by the existing app-store gallery cache.

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness
- Manifest schema and registry client are ready for the skill installer (v1.5-05-02)
- SkillRegistryClient can be instantiated and connected to GitHub repos like utopusc/livinity-skills
- Skill interface extended with marketplace fields for tracking installed skills
- Pre-existing type errors in ws-gateway.ts are unrelated (task stub methods referenced but not implemented)

---
*Phase: v1.5-05-skill-marketplace-parallel-execution*
*Completed: 2026-02-15*

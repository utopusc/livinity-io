---
phase: v1.1-08-mobile-polish
plan: 04
type: execute
wave: 2
depends_on: ["08-01", "08-02", "08-03"]
files_modified:
  - livos/packages/ui/src/shadcn-components/ui/drawer.tsx
  - livos/packages/ui/src/components/ui/immersive-dialog.tsx
autonomous: false

must_haves:
  truths:
    - "Drawer background uses semantic token instead of hardcoded hex"
    - "Immersive dialog close button is visible and tappable on mobile viewports"
    - "All mobile views work at 375px viewport width"
    - "No responsive breakpoint regressions across redesigned views"
  artifacts:
    - path: "livos/packages/ui/src/shadcn-components/ui/drawer.tsx"
      provides: "Drawer with semantic background token"
      contains: "bg-black/90"
    - path: "livos/packages/ui/src/components/ui/immersive-dialog.tsx"
      provides: "Mobile-safe immersive dialog close button positioning"
      contains: "md:mt-5"
  key_links:
    - from: "livos/packages/ui/src/shadcn-components/ui/drawer.tsx"
      to: "all drawer consumers (settings mobile, files mobile, ai-chat mobile)"
      via: "DrawerContent component"
      pattern: "DrawerContent"
---

<objective>
Apply final polish to drawer/modal mobile rendering and verify all responsive changes from Plans 01-03 work correctly across viewports.

Purpose: This plan addresses remaining LOW/MEDIUM issues from the research: the drawer's hardcoded `bg-[#0F0F0F]` hex color (should use a semantic token or near-equivalent), and the immersive dialog close button that may be off-screen on small mobile viewports. It also includes a visual verification checkpoint.

Output: Polished drawer and immersive dialog mobile behavior, plus user verification of the complete mobile experience.
</objective>

<execution_context>
@C:\Users\hello\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\hello\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP-v1.1.md
@.planning/STATE.md
@livos/packages/ui/src/shadcn-components/ui/drawer.tsx
@livos/packages/ui/src/components/ui/immersive-dialog.tsx
@.planning/phases/v1.1-08-mobile-polish/08-01-SUMMARY.md
@.planning/phases/v1.1-08-mobile-polish/08-02-SUMMARY.md
@.planning/phases/v1.1-08-mobile-polish/08-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate drawer bg to semantic token and fix immersive dialog close button</name>
  <files>
    livos/packages/ui/src/shadcn-components/ui/drawer.tsx
    livos/packages/ui/src/components/ui/immersive-dialog.tsx
  </files>
  <action>
  **1. drawer.tsx — Migrate hardcoded bg color (line ~35):**
  The DrawerContent has `bg-[#0F0F0F]` which is a hardcoded near-black hex. Replace with a semantic equivalent:
  - Current: `bg-[#0F0F0F]`
  - New: `bg-black/90`

  Why `bg-black/90` and not a surface token:
  - `#0F0F0F` is essentially black (rgb 15,15,15) with full opacity
  - `bg-black/90` gives the same near-black appearance while being slightly translucent, which is more consistent with the glassmorphism design language
  - Surface tokens (surface-base at 0.04 opacity) are too transparent for a full-screen drawer
  - `bg-black/90` is already used in other overlay contexts (ImmersiveDialogSplitContent uses `bg-black/40`, overlays use `bg-black/30-50`)
  - The drawer already has an inset box-shadow for glass highlight, so slight translucency through `bg-black/90` complements this

  **2. immersive-dialog.tsx — Fix close button visibility on mobile (ImmersiveDialogClose function, line ~129):**
  The close button is positioned `absolute left-1/2 top-full mt-5 -translate-x-1/2` (below the dialog). On small viewports where the dialog takes most of the screen height, this button may be cut off at the bottom.

  Fix by making the margin responsive:
  - Current: `mt-5`
  - New: `mt-2 md:mt-5`
  (Reduce gap on mobile from 20px to 8px, keeping the button visible even on 667px-tall viewports)

  Also increase the close button touch target on mobile:
  - Current: `h-[36px] w-[36px]`
  - New: `h-[44px] w-[44px] md:h-[36px] md:w-[36px]`
  (Match the 44px mobile touch target pattern from Plan 02)
  </action>
  <verify>
  - `cd livos/packages/ui && pnpm build` succeeds
  - Grep confirms `bg-[#0F0F0F]` no longer exists in drawer.tsx
  - Grep confirms `bg-black/90` in drawer.tsx
  - Grep confirms `mt-2 md:mt-5` in immersive-dialog.tsx
  - Grep confirms responsive close button size in immersive-dialog.tsx
  </verify>
  <done>
  - Drawer uses `bg-black/90` instead of hardcoded `#0F0F0F`
  - Immersive dialog close button has reduced margin on mobile (mt-2 vs mt-5)
  - Immersive dialog close button has 44px touch target on mobile
  - No build errors
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
  Complete mobile responsive optimization across all redesigned views:
  - Plan 01: AI Chat mobile layout with drawer sidebar
  - Plan 02: 44px touch targets on all buttons at mobile viewport
  - Plan 03: Reduced backdrop-blur on mobile, GPU compositing hints
  - Plan 04: Drawer semantic background, immersive dialog close button fix
  </what-built>
  <how-to-verify>
  Open the app in a browser and use DevTools to set viewport to 375px width (iPhone SE):

  1. **AI Chat (MR-01):**
     - Navigate to AI Chat
     - Verify sidebar is hidden on mobile
     - Tap hamburger menu — drawer should open with conversation list
     - Select a conversation — drawer should close
     - Verify chat messages are readable without horizontal overflow
     - Verify input area has appropriate padding

  2. **Touch Targets (MR-02):**
     - Check button heights in Settings, AI Chat, App Store
     - All buttons should appear taller on mobile (44px) vs desktop (34px)
     - Toggle viewport between 375px and 1200px to see the size change

  3. **Animations (MR-03):**
     - Open a sheet (e.g., Settings, App Store)
     - Check that open/close animation is smooth (no jank)
     - Open a dialog — check smooth animation
     - Scroll within sheets — check for scroll jank

  4. **Drawer/Modal (MR-04):**
     - Open Settings on mobile — should use drawer
     - Check drawer background is near-black (not noticeably different from before)
     - Open an immersive dialog — check close button is visible and tappable below the dialog
     - Test at 375px width AND 768px width (tablet boundary)

  5. **Cross-viewport (MR-04):**
     - Toggle between 375px, 390px, 768px, 1024px, 1280px
     - Verify no layout breaks at any breakpoint
     - Verify desktop layout is unchanged at 1280px
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
- Build passes: `cd livos/packages/ui && pnpm build`
- No hardcoded `#0F0F0F` in drawer.tsx
- Immersive dialog close button responsive margin and size
- Human verification confirms all mobile views work at 375px+
</verification>

<success_criteria>
- Drawer uses semantic color
- Immersive dialog close button visible on mobile
- Human confirms all mobile views work correctly
- No responsive breakpoint regressions
</success_criteria>

<output>
After completion, create `.planning/phases/v1.1-08-mobile-polish/08-04-SUMMARY.md`
</output>

---
phase: v1.1-02-desktop-shell
plan: 05
type: execute
wave: 3
depends_on: ["02-01"]
files_modified:
  - livos/packages/ui/src/providers/wallpaper.tsx
  - livos/packages/ui/src/modules/desktop/desktop-preview.tsx
  - livos/packages/ui/src/modules/desktop/desktop-preview-basic.tsx
autonomous: true

must_haves:
  truths:
    - "Wallpaper blur transition timing is refined for smoother perceived performance"
    - "Wallpaper thumbnail blur layer still uses scale-125 to prevent edge artifacts"
    - "Brand color extraction (--color-brand, --color-brand-lighter, --color-brand-lightest) is completely unchanged"
    - "Desktop preview components have basic token alignment for border radii"
    - "The animate-unblur CSS keyframes timing is unchanged (the keyframes are in index.css, not in this plan's scope)"
  artifacts:
    - path: "livos/packages/ui/src/providers/wallpaper.tsx"
      provides: "Wallpaper system with refined transition timing"
      contains: "duration-"
    - path: "livos/packages/ui/src/modules/desktop/desktop-preview.tsx"
      provides: "Desktop preview with aligned border radii"
      contains: "rounded-radius-"
    - path: "livos/packages/ui/src/modules/desktop/desktop-preview-basic.tsx"
      provides: "Basic desktop preview with aligned border radii"
      contains: "rounded-radius-"
  key_links:
    - from: "livos/packages/ui/src/providers/wallpaper.tsx"
      to: "livos/packages/ui/tailwind.config.ts"
      via: "CSS variables --color-brand set by wallpaper provider, consumed by token system"
      pattern: "--color-brand"
    - from: "livos/packages/ui/src/providers/wallpaper.tsx"
      to: "livos/packages/ui/src/index.css"
      via: "animate-unblur keyframes defined in CSS, referenced in wallpaper component"
      pattern: "animate-unblur"
    - from: "livos/packages/ui/src/modules/desktop/desktop-preview.tsx"
      to: "livos/packages/ui/src/modules/desktop/dock.tsx"
      via: "Preview renders miniature dock, should match dock styling"
      pattern: "rounded-radius-"
---

<objective>
Refine the wallpaper system's blur transitions and update desktop preview components for visual consistency. This covers requirement DD-04 (better blur transitions and edge handling).

Purpose: The wallpaper system controls the background layer of the entire desktop. Its blur transition from thumbnail to full image is one of the first things users see on load. This plan makes conservative refinements to transition timing for smoother perceived performance while explicitly preserving the scale-125 edge artifact workaround and all brand color extraction logic. Desktop previews are updated to match the dock/desktop token changes from earlier plans.

Output: Updated wallpaper.tsx with refined transitions, updated desktop-preview.tsx and desktop-preview-basic.tsx with aligned tokens.
</objective>

<execution_context>
@C:\Users\hello\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\hello\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP-v1.1.md
@.planning/STATE.md
@.planning/phases/v1.1-02-desktop-shell/02-RESEARCH.md
@.planning/phases/v1.1-01-design-system/01-01-SUMMARY.md

@livos/packages/ui/tailwind.config.ts
@livos/packages/ui/src/providers/wallpaper.tsx
@livos/packages/ui/src/index.css
@livos/packages/ui/src/modules/desktop/desktop-preview.tsx
@livos/packages/ui/src/modules/desktop/desktop-preview-basic.tsx
@livos/packages/ui/src/modules/desktop/dock.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refine wallpaper blur transitions</name>
  <files>livos/packages/ui/src/providers/wallpaper.tsx</files>
  <action>
Make conservative refinements to wallpaper transition classes. The wallpaper system is the visual foundation — changes here affect perceived app quality. Be conservative.

**Thumbnail/blur layer (line ~265):**
Current:
```
pointer-events-none fixed inset-0 w-full scale-125 object-cover object-center blur-[var(--wallpaper-blur)] duration-700
```

New:
```
pointer-events-none fixed inset-0 w-full scale-125 object-cover object-center blur-[var(--wallpaper-blur)] duration-500
```

Changes:
- `duration-700` -> `duration-500` (faster thumbnail transitions feel snappier — the blur is applied via CSS variable, so this controls how quickly the thumbnail layer opacity/visibility changes, not the blur itself)
- Keep `scale-125` (CRITICAL: this prevents edge artifacts during blur. The research explicitly warns against removing this without an alternative.)
- Keep `blur-[var(--wallpaper-blur)]` (controlled by CSS variable)

**Full wallpaper layer (line ~278):**
Current:
```
pointer-events-none fixed inset-0 w-full bg-black object-cover object-center duration-700 animate-in fade-in
```

New:
```
pointer-events-none fixed inset-0 w-full bg-black object-cover object-center duration-500 animate-in fade-in
```

Changes:
- `duration-700` -> `duration-500` (the full wallpaper fade-in feels slightly snappier; the animate-unblur CSS animation at 0.7s still controls the blur-to-clear effect independently)

**Previous wallpaper exit (line ~293):**
Current:
```
pointer-events-none fixed inset-0 bg-cover bg-center duration-700 animate-out fade-out zoom-out-125 fill-mode-both
```

New:
```
pointer-events-none fixed inset-0 bg-cover bg-center duration-500 animate-out fade-out zoom-out-125 fill-mode-both
```

Changes:
- `duration-700` -> `duration-500` (consistent exit transition timing)
- Keep `zoom-out-125` (matches the scale-125 on entry)

**CRITICAL: Do NOT change:**
- The brand color extraction logic (extractColors function, --color-brand CSS variables)
- The wallpaper loading state machine (isFirstLoad, wallpaperUrl, previousWallpaperUrl)
- The `scale-125` on the blur layer
- The `animate-unblur 0.7s` inline CSS animation style (this is set via JS, not in these Tailwind classes)
- The `--wallpaper-blur: 12px` CSS variable (defined in index.css)
- The index.css `@keyframes animate-unblur` (not in scope — that's a separate CSS file)
- Any wallpaper URL fetching, caching, or state management
- The img element's `onLoad` handler

**Why duration-500 is safe:**
The transition durations control Tailwind's CSS transition-duration property, which applies to opacity and transform transitions. The actual blur-to-clear animation is a separate CSS animation (`animate-unblur 0.7s`) that runs independently. Shortening the transition duration makes the wallpaper layers swap faster while the blur animation runs at its own pace.
  </action>
  <verify>
Grep for `duration-500` in wallpaper.tsx to confirm updated transition timing (should appear 3 times).
Grep for `scale-125` in wallpaper.tsx to confirm the blur edge artifact prevention is preserved.
Grep for `--color-brand` in wallpaper.tsx to confirm brand color extraction is unchanged.
Grep for `animate-unblur` in wallpaper.tsx to confirm the blur animation reference is unchanged.
Verify no `duration-700` remains in wallpaper.tsx class strings.
Run `npx tsc --noEmit` in the ui package.
  </verify>
  <done>
Wallpaper transitions refined from 700ms to 500ms across all three layers (thumbnail, full, previous exit) for snappier visual feedback. Scale-125 edge artifact prevention preserved. Brand color extraction completely untouched. animate-unblur CSS animation unaffected (runs at its own 0.7s pace).
  </done>
</task>

<task type="auto">
  <name>Task 2: Align desktop preview components with new tokens</name>
  <files>livos/packages/ui/src/modules/desktop/desktop-preview.tsx, livos/packages/ui/src/modules/desktop/desktop-preview-basic.tsx</files>
  <action>
Desktop previews render miniature versions of the desktop at ~18% scale for the wallpaper settings picker. They have their own hardcoded sizes for the scaled-down view. Apply basic token alignment without investing heavily — these are tiny previews where pixel precision matters less.

**desktop-preview.tsx — scan for raw tokens and migrate:**

Look for these patterns in the file and replace them:
- Any `rounded-2xl` -> `rounded-radius-xl` (matching dock change)
- Any `bg-white/10` -> `bg-surface-2`
- Any `border-white/10` -> `border-border-default`
- Any `bg-black/10` -> `bg-surface-base` (matching dock)
- Any `text-white/90` -> `text-text-primary`
- Any `rounded-xl` -> `rounded-radius-lg`
- Any `rounded-10` or `rounded-15` for app icons -> `rounded-radius-sm` or `rounded-radius-md`

Only replace tokens that appear in Tailwind class strings. Do NOT change:
- Inline styles with pixel dimensions (these are scale-specific)
- Width/height values for the preview scale
- Any structural layout classes

**desktop-preview-basic.tsx — same approach:**
Apply the same token replacements as above. This is the simpler preview variant.

**NOTE:** These preview files may contain unique class strings not covered in the research because they are scaled-down renderings. Read each file carefully before making changes. If a class string doesn't map cleanly to a semantic token (e.g., a preview-specific size), leave it as-is.

**Do NOT change:**
- Preview scale factors or dimensions
- Component props or exports
- Any preview-specific sizing that doesn't correspond to a semantic token
  </action>
  <verify>
Grep for `rounded-radius-` in desktop-preview.tsx to confirm semantic radii applied.
Grep for `bg-surface-` in desktop-preview.tsx to confirm surface tokens applied where applicable.
Grep for `border-border-` in desktop-preview.tsx to confirm border tokens applied where applicable.
Grep for `rounded-radius-` in desktop-preview-basic.tsx to confirm semantic radii.
Run `npx tsc --noEmit` in the ui package.
  </verify>
  <done>
Desktop preview components aligned with semantic tokens for border radii, surface colors, and border colors where applicable. Preview-specific sizing preserved. These miniature renderings now use consistent tokens with the full-size dock and desktop components.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes in ui package
2. Wallpaper: all three layers use `duration-500` instead of `duration-700`
3. Wallpaper: `scale-125` still present on blur layer
4. Wallpaper: `--color-brand` extraction logic completely unchanged
5. Wallpaper: `animate-unblur` inline style reference unchanged
6. Desktop preview: semantic radii (`rounded-radius-xl`, `rounded-radius-lg`, etc.) applied
7. Desktop preview: semantic surface/border tokens applied where raw opacity values existed
8. No `duration-700` in wallpaper.tsx Tailwind class strings
9. Preview scale factors and dimensions unchanged
</verification>

<success_criteria>
- Wallpaper transitions feel snappier (500ms vs 700ms)
- Scale-125 blur edge prevention explicitly preserved
- Brand color extraction completely untouched
- Desktop preview components visually consistent with full-size dock/desktop
- TypeScript compilation succeeds
- No changes to wallpaper state management, loading logic, or brand color system
</success_criteria>

<output>
After completion, create `.planning/phases/v1.1-02-desktop-shell/02-05-SUMMARY.md`
</output>

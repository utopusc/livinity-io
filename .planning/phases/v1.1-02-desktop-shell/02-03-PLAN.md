---
phase: v1.1-02-desktop-shell
plan: 03
type: execute
wave: 2
depends_on: []
files_modified:
  - livos/packages/ui/src/shadcn-components/ui/shared/menu.ts
  - livos/packages/ui/src/modules/desktop/desktop-context-menu.tsx
  - livos/packages/ui/src/components/cmdk.tsx
  - livos/packages/ui/src/shadcn-components/ui/command.tsx
autonomous: true

must_haves:
  truths:
    - "Context menu items use semantic body-sm typography instead of raw text-13"
    - "Context menu item focus state uses semantic surface-base instead of raw bg-white/5"
    - "Context menu item rounded corners use semantic radius-sm instead of raw rounded-5"
    - "Command palette input uses semantic body-lg typography instead of raw text-15"
    - "Command palette items use semantic body-sm typography and surface-base selected state"
    - "Frequent apps hover state uses semantic surface-base and border tokens"
    - "Shared menu base classes are updated consistently for BOTH context menu and dropdown menu"
    - "Dialog base class (shared/dialog.ts) is NOT modified (deferred to Phase 3)"
  artifacts:
    - path: "livos/packages/ui/src/shadcn-components/ui/shared/menu.ts"
      provides: "Shared menu classes with semantic tokens"
      contains: "text-body-sm"
    - path: "livos/packages/ui/src/modules/desktop/desktop-context-menu.tsx"
      provides: "Desktop context menu with semantic close button"
      contains: "bg-surface-2"
    - path: "livos/packages/ui/src/components/cmdk.tsx"
      provides: "Command palette feature component with semantic tokens"
      contains: "text-body-lg"
    - path: "livos/packages/ui/src/shadcn-components/ui/command.tsx"
      provides: "Command primitive wrapper with semantic tokens"
      contains: "text-body-sm"
  key_links:
    - from: "livos/packages/ui/src/shadcn-components/ui/shared/menu.ts"
      to: "livos/packages/ui/src/shadcn-components/ui/context-menu.tsx"
      via: "contextMenuClasses export used by ContextMenuContent/Item"
      pattern: "contextMenuClasses"
    - from: "livos/packages/ui/src/shadcn-components/ui/shared/menu.ts"
      to: "livos/packages/ui/src/shadcn-components/ui/dropdown-menu.tsx"
      via: "dropdownMenuClasses export used by DropdownMenuContent/Item"
      pattern: "dropdownMenuClasses"
    - from: "livos/packages/ui/src/shadcn-components/ui/command.tsx"
      to: "livos/packages/ui/src/shadcn-components/ui/shared/dialog.ts"
      via: "dialogContentClass import for command palette dialog base"
      pattern: "dialogContentClass"
---

<objective>
Migrate the context menu shared classes and command palette to semantic tokens. This covers requirements DD-05 (minimal style context menu) and CN-01 (refined command palette styling).

Purpose: The context menu and command palette are high-visibility overlay components. They share foundational classes through menu.ts and dialog.ts. This plan carefully updates the shared menu classes (which affect both context menus and dropdown menus) while explicitly leaving dialog.ts untouched for Phase 3.

Output: Updated shared/menu.ts with semantic token classes, updated desktop-context-menu.tsx close button, updated cmdk.tsx and command.tsx with semantic tokens.
</objective>

<execution_context>
@C:\Users\hello\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\hello\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP-v1.1.md
@.planning/STATE.md
@.planning/phases/v1.1-02-desktop-shell/02-RESEARCH.md
@.planning/phases/v1.1-01-design-system/01-01-SUMMARY.md

@livos/packages/ui/tailwind.config.ts
@livos/packages/ui/src/shadcn-components/ui/shared/menu.ts
@livos/packages/ui/src/shadcn-components/ui/shared/dialog.ts
@livos/packages/ui/src/shadcn-components/ui/context-menu.tsx
@livos/packages/ui/src/shadcn-components/ui/dropdown-menu.tsx
@livos/packages/ui/src/modules/desktop/desktop-context-menu.tsx
@livos/packages/ui/src/components/cmdk.tsx
@livos/packages/ui/src/shadcn-components/ui/command.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate shared menu classes and desktop context menu to semantic tokens</name>
  <files>livos/packages/ui/src/shadcn-components/ui/shared/menu.ts, livos/packages/ui/src/modules/desktop/desktop-context-menu.tsx</files>
  <action>
Update shared/menu.ts class strings. This file is shared between context-menu.tsx AND dropdown-menu.tsx, so all changes affect BOTH component types. Only migrate tokens that are safe for both contexts.

**CRITICAL: Do NOT modify shared/dialog.ts. That file is deferred to Phase 3.**

**menuContentClass (line ~8) — shared between context and dropdown:**
Current:
```
bg-[color-mix(in_hsl,hsl(var(--color-brand))_20%,black_80%)] z-[9999] min-w-[8rem] p-1 animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 text-white
```

New:
```
bg-[color-mix(in_hsl,hsl(var(--color-brand))_20%,black_80%)] z-[9999] min-w-[8rem] p-1 animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 text-text-primary
```

Changes:
- `text-white` -> `text-text-primary` (0.90 opacity — menus should use the standard text hierarchy)
- Keep `bg-[color-mix(...)]` (brand-tinted background is a key brand element, not a surface token)
- Keep all animation classes unchanged
- Keep z-[9999]

**menuItemClass (line ~10) — shared between context and dropdown:**
Current:
```
relative flex cursor-default select-none items-center px-3 py-2 text-13 font-medium -tracking-3 leading-tight outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-white/5 focus:text-white data-[highlighted]:bg-white/5 data-[highlighted]:text-white
```

New:
```
relative flex cursor-default select-none items-center px-3 py-2 text-body-sm font-medium -tracking-3 leading-tight outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-surface-base focus:text-white data-[highlighted]:bg-surface-base data-[highlighted]:text-white
```

Changes:
- `text-13` -> `text-body-sm` (13px with line-height)
- `focus:bg-white/5` -> `focus:bg-surface-base` (0.04 vs 0.05, close)
- `data-[highlighted]:bg-white/5` -> `data-[highlighted]:bg-surface-base`
- Keep `focus:text-white` and `data-[highlighted]:text-white` (full white on focus is intentional for contrast against the brand-tinted bg)
- Keep `-tracking-3` and `leading-tight` (overrides semantic defaults)

**contextMenuItemClass (line ~16) — context menu specific:**
Current:
```
cn(menuItemClass, 'rounded-5')
```

New:
```
cn(menuItemClass, 'rounded-radius-sm')
```

Changes:
- `rounded-5` -> `rounded-radius-sm` (8px vs 5px — slightly larger rounding, aligns to design system)

**Context menu content (line ~19):**
Current:
```
content: cn(menuContentClass, 'shadow-context-menu rounded-8')
```

New:
```
content: cn(menuContentClass, 'shadow-context-menu rounded-radius-sm')
```

Changes:
- `rounded-8` -> `rounded-radius-sm` (8px, same value)
- Keep `shadow-context-menu` (component-specific shadow)

**Dropdown menu content (line ~34-36):**
Current:
```
content: cn(menuContentClass, 'shadow-dropdown rounded-15 p-2.5')
item: { root: cn(menuItemClass, 'rounded-8') }
```

New:
```
content: cn(menuContentClass, 'shadow-dropdown rounded-radius-md p-2.5')
item: { root: cn(menuItemClass, 'rounded-radius-sm') }
```

Changes:
- `rounded-15` -> `rounded-radius-md` (12px vs 15px — aligns to design system)
- `rounded-8` -> `rounded-radius-sm` (8px, same value)
- Keep `shadow-dropdown` and `p-2.5`

**desktop-context-menu.tsx — close button (line ~57):**
Current:
```
rounded-full opacity-30 outline-none ring-white/60 transition-opacity hover:opacity-40 focus-visible:opacity-40 focus-visible:ring-2
```

New:
```
rounded-full opacity-30 outline-none ring-white/60 transition-opacity hover:opacity-40 focus-visible:opacity-40 focus-visible:ring-2
```

No changes needed — this close button uses opacity modulation on an icon, not surface/border tokens. The ring-white/60 is appropriate for focus visibility on a dark background. Leave as-is.

**Do NOT change:**
- shared/dialog.ts (deferred to Phase 3)
- The color-mix background in menuContentClass (brand-tinted menus are a design feature)
- context-menu.tsx or dropdown-menu.tsx component code (they consume the shared classes)
- Any animation classes
  </action>
  <verify>
Grep for `text-body-sm` in menu.ts to confirm semantic typography.
Grep for `focus:bg-surface-base` in menu.ts to confirm semantic focus state.
Grep for `data-\\[highlighted\\]:bg-surface-base` in menu.ts to confirm semantic highlight.
Grep for `rounded-radius-sm` in menu.ts to confirm semantic radius on context menu items.
Grep for `rounded-radius-md` in menu.ts to confirm semantic radius on dropdown content.
Grep for `text-text-primary` in menu.ts to confirm semantic text color on content.
Verify shared/dialog.ts is UNCHANGED by checking its content matches original.
Run `npx tsc --noEmit` in the ui package.
  </verify>
  <done>
Shared menu classes migrated: body-sm typography, surface-base focus/highlight states, text-primary content text, radius-sm/md for context/dropdown rounding. Both context menu and dropdown menu consumers benefit from these changes. Dialog base class untouched (Phase 3 scope).
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate command palette to semantic tokens</name>
  <files>livos/packages/ui/src/components/cmdk.tsx, livos/packages/ui/src/shadcn-components/ui/command.tsx</files>
  <action>
Update command.tsx (shadcn wrapper) and cmdk.tsx (feature component) class strings. The command palette uses shared dialog.ts as a base — do NOT modify dialog.ts. Only change command-specific overrides and the feature-level cmdk classes.

**command.tsx — CommandDialog content (line ~31-38):**
Keep unchanged. This uses `cn(dialogContentClass, dialogContentAnimationClass, ...)` which layers on top of the shared dialog base. The overrides here (top-4, translate-y-0, overflow-hidden, p-3, max-w, z-[999]) are positioning, not design tokens.

**command.tsx — Command wrapper (line ~42):**
Keep unchanged — this is structural CSS for cmdk group headings.

**command.tsx — CommandInput (line ~58-60):**
Current:
```
flex w-full rounded-md bg-transparent p-2 text-15 font-medium -tracking-2 outline-none placeholder:text-white/25 disabled:cursor-not-allowed disabled:opacity-50
```

New:
```
flex w-full rounded-md bg-transparent p-2 text-body-lg font-medium -tracking-2 outline-none placeholder:text-text-tertiary disabled:cursor-not-allowed disabled:opacity-50
```

Changes:
- `text-15` -> `text-body-lg` (15px)
- `placeholder:text-white/25` -> `placeholder:text-text-tertiary` (0.40 vs 0.25 — more readable placeholder)
- Keep `-tracking-2` (overrides semantic default)

**command.tsx — CommandItem (line ~121-123):**
Current:
```
group relative flex cursor-default select-none items-center gap-3 rounded-8 p-2 text-13 font-medium -tracking-2 outline-none aria-selected:bg-white/4 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 md:text-15
```

New:
```
group relative flex cursor-default select-none items-center gap-3 rounded-radius-sm p-2 text-body-sm font-medium -tracking-2 outline-none aria-selected:bg-surface-base data-[disabled]:pointer-events-none data-[disabled]:opacity-50 md:text-body-lg
```

Changes:
- `rounded-8` -> `rounded-radius-sm` (8px, same)
- `text-13` -> `text-body-sm` (13px)
- `aria-selected:bg-white/4` -> `aria-selected:bg-surface-base` (0.04, same)
- `md:text-15` -> `md:text-body-lg` (15px)
- Keep `-tracking-2`

**command.tsx — CommandShortcut (line ~152):**
Current:
```
ml-auto text-xs tracking-widest text-white/30
```

New:
```
ml-auto text-xs tracking-widest text-text-tertiary
```

Changes:
- `text-white/30` -> `text-text-tertiary` (0.40 vs 0.30 — slightly more visible shortcut hints)
- Keep `text-xs` (this is a standard Tailwind size, not a custom numeric token)

**command.tsx — close button (line ~182):**
Current:
```
rounded-full opacity-30 outline-none ring-white/60 transition-opacity hover:opacity-40 focus-visible:opacity-40 focus-visible:ring-2
```

Keep unchanged — same pattern as context menu close button, opacity-based styling on icon.

**command.tsx — blur overlay (line ~172):**
Keep unchanged — `cn(dialogOverlayClass, 'z-[999] bg-black/30 backdrop-blur-xl contrast-more:backdrop-blur-none')` is functional overlay styling.

**cmdk.tsx — FrequentApps heading (line ~304):**
Current:
```
mb-5 ml-2 hidden text-15 font-semibold leading-tight -tracking-2 md:block
```

New:
```
mb-5 ml-2 hidden text-body-lg font-semibold leading-tight -tracking-2 md:block
```

Changes:
- `text-15` -> `text-body-lg` (15px)

**cmdk.tsx — FrequentApp button (line ~362):**
Current:
```
inline-flex w-[75px] flex-col items-center gap-2 overflow-hidden rounded-8 border border-transparent p-1.5 outline-none transition-all hover:border-white/10 hover:bg-white/4 focus-visible:border-white/10 focus-visible:bg-white/4 active:border-white/20 md:w-[100px] md:p-2
```

New:
```
inline-flex w-[75px] flex-col items-center gap-2 overflow-hidden rounded-radius-sm border border-transparent p-1.5 outline-none transition-all hover:border-border-default hover:bg-surface-base focus-visible:border-border-default focus-visible:bg-surface-base active:border-border-emphasis md:w-[100px] md:p-2
```

Changes:
- `rounded-8` -> `rounded-radius-sm` (8px, same)
- `hover:border-white/10` -> `hover:border-border-default` (0.10, same)
- `hover:bg-white/4` -> `hover:bg-surface-base` (0.04, same)
- `focus-visible:border-white/10` -> `focus-visible:border-border-default`
- `focus-visible:bg-white/4` -> `focus-visible:bg-surface-base`
- `active:border-white/20` -> `active:border-border-emphasis` (0.20, same)

**cmdk.tsx — FrequentApp name (line ~376):**
Current:
```
w-full truncate text-[10px] -tracking-2 text-white/75 md:text-13
```

New:
```
w-full truncate text-[10px] -tracking-2 text-text-secondary md:text-body-sm
```

Changes:
- `text-white/75` -> `text-text-secondary` (0.60 vs 0.75 — slightly more muted)
- `md:text-13` -> `md:text-body-sm` (13px)
- Keep `text-[10px]` (mobile size, below our smallest semantic token caption-sm which is 11px — acceptable as a one-off arbitrary value for a very small label)

**Do NOT change:**
- shared/dialog.ts (Phase 3)
- The dialogContentClass or dialogOverlayClass imports/usage
- Any cmdk library integration code or provider architecture
- Framer Motion animations in cmdk.tsx
- The CommandInput search icon or any structural HTML
- Component exports or props
  </action>
  <verify>
Grep for `text-body-lg` in command.tsx to confirm input typography.
Grep for `placeholder:text-text-tertiary` in command.tsx to confirm placeholder color.
Grep for `text-body-sm` in command.tsx to confirm item typography.
Grep for `rounded-radius-sm` in command.tsx to confirm item radius.
Grep for `aria-selected:bg-surface-base` in command.tsx to confirm selection state.
Grep for `text-text-tertiary` in command.tsx to confirm shortcut color.
Grep for `text-body-lg` in cmdk.tsx to confirm heading typography.
Grep for `hover:bg-surface-base` in cmdk.tsx to confirm frequent app hover.
Grep for `hover:border-border-default` in cmdk.tsx to confirm frequent app border.
Grep for `text-text-secondary` in cmdk.tsx to confirm frequent app name color.
Verify shared/dialog.ts is unchanged.
Run `npx tsc --noEmit` in the ui package.
  </verify>
  <done>
Command palette and context menu migrated to semantic tokens. Shared menu.ts uses body-sm, surface-base focus states, and semantic radii (affecting both context menus and dropdowns consistently). Command palette uses body-lg input, body-sm items, surface-base selection, and semantic border tokens on frequent apps. Dialog base class untouched for Phase 3.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes in ui package
2. Shared menu.ts: `text-body-sm`, `focus:bg-surface-base`, `rounded-radius-sm`, `text-text-primary`
3. Context menu: `rounded-radius-sm` items, `shadow-context-menu` preserved
4. Dropdown menu: `rounded-radius-md` content, `rounded-radius-sm` items
5. Command input: `text-body-lg`, `placeholder:text-text-tertiary`
6. Command items: `text-body-sm`, `rounded-radius-sm`, `aria-selected:bg-surface-base`
7. Command shortcuts: `text-text-tertiary`
8. Frequent apps: `hover:bg-surface-base`, `hover:border-border-default`, `text-text-secondary`
9. shared/dialog.ts is IDENTICAL to its state before this plan (not modified)
10. color-mix brand background in menuContentClass preserved
11. All dropdown menus across the app (settings, app store, file manager) render correctly with the shared class changes
</verification>

<success_criteria>
- Shared menu classes migrated to semantic tokens without breaking dropdown menus
- Command palette uses semantic typography and surface tokens
- All context menus across the app use the updated shared classes
- Dialog base class (dialog.ts) explicitly NOT modified
- TypeScript compilation succeeds
- No changes to component behavior, props, or exports
</success_criteria>

<output>
After completion, create `.planning/phases/v1.1-02-desktop-shell/02-03-SUMMARY.md`
</output>

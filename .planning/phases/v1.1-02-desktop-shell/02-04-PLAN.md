---
phase: v1.1-02-desktop-shell
plan: 04
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - livos/packages/ui/src/components/ui/toast.tsx
  - livos/packages/ui/src/modules/floating-island/bare-island.tsx
  - livos/packages/ui/src/modules/floating-island/container.tsx
autonomous: true

must_haves:
  truths:
    - "Toast container uses semantic surface token and radius instead of raw hex color and rounded-12"
    - "Toast typography uses semantic body-lg instead of raw text-15"
    - "Toast description uses semantic text-secondary instead of raw opacity-60"
    - "Toast close button uses semantic surface-3 instead of raw bg-neutral-600/70"
    - "Floating island close button uses semantic surface-2/3 instead of raw bg-white/10 and hover:bg-white/20"
    - "Floating island container bottom positioning accounts for the dock padding reduction in Plan 02-01"
    - "Floating island border radius values in JS animation config are NOT changed (not Tailwind classes)"
  artifacts:
    - path: "livos/packages/ui/src/components/ui/toast.tsx"
      provides: "Toast component with semantic surface/text/radius tokens"
      contains: "bg-surface-3"
    - path: "livos/packages/ui/src/modules/floating-island/bare-island.tsx"
      provides: "Island base component with semantic surface tokens on close button"
      contains: "bg-surface-2"
    - path: "livos/packages/ui/src/modules/floating-island/container.tsx"
      provides: "Island positioning container"
      contains: "bottom-"
  key_links:
    - from: "livos/packages/ui/src/modules/floating-island/container.tsx"
      to: "livos/packages/ui/src/modules/desktop/dock.tsx"
      via: "Bottom positioning must clear dock height"
      pattern: "bottom-\\["
    - from: "livos/packages/ui/src/modules/floating-island/bare-island.tsx"
      to: "livos/packages/ui/tailwind.config.ts"
      via: "Semantic token classes for surface colors"
      pattern: "(bg-surface-|hover:bg-surface-)"
    - from: "livos/packages/ui/src/components/ui/toast.tsx"
      to: "livos/packages/ui/tailwind.config.ts"
      via: "Semantic token classes for surface, text, radius"
      pattern: "(bg-surface-|text-text-|rounded-radius-)"
---

<objective>
Migrate the toast notification system and floating island components to semantic tokens. This covers requirements CN-02 (cleaner toast style) and CN-03 (redesign floating island notifications).

Purpose: Toasts and floating islands are notification overlays that appear above all other content. They need to look consistent with the new design language while maintaining their distinctive visual weight (solid black islands, semi-transparent toasts). This plan also adjusts island container positioning to account for the dock padding change from Plan 02-01.

Output: Updated toast.tsx with semantic tokens, updated bare-island.tsx with semantic close button, updated container.tsx with adjusted positioning.
</objective>

<execution_context>
@C:\Users\hello\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\hello\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP-v1.1.md
@.planning/STATE.md
@.planning/phases/v1.1-02-desktop-shell/02-RESEARCH.md
@.planning/phases/v1.1-01-design-system/01-01-SUMMARY.md

@livos/packages/ui/tailwind.config.ts
@livos/packages/ui/src/components/ui/toast.tsx
@livos/packages/ui/src/modules/floating-island/bare-island.tsx
@livos/packages/ui/src/modules/floating-island/container.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate toast component to semantic tokens</name>
  <files>livos/packages/ui/src/components/ui/toast.tsx</files>
  <action>
Update toast.tsx class strings. Preserve the sonner integration, icon color system, and component exports.

**Toast close button (line ~21):**
Current:
```
absolute top-0 right-0 p-1 -translate-y-1/3 translate-x-1/3 bg-neutral-600/70 rounded-full hover:scale-105 transition-[transform,opacity] duration-300 hidden sm:block
```

New:
```
absolute top-0 right-0 p-1 -translate-y-1/3 translate-x-1/3 bg-surface-3 rounded-full hover:scale-105 transition-[transform,opacity] duration-300 hidden sm:block
```

Changes:
- `bg-neutral-600/70` -> `bg-surface-3` (semantic surface instead of hardcoded neutral gray)

**Toast container (line ~22):**
Current:
```
bg-[#404040]/40 rounded-12 py-4 px-5 backdrop-blur-md flex items-center gap-2 shadow-dialog text-15 text-white -tracking-4 w-full
```

New:
```
bg-surface-3 rounded-radius-md py-4 px-5 backdrop-blur-md flex items-center gap-2 shadow-elevation-lg text-body-lg text-text-primary -tracking-4 w-full
```

Changes:
- `bg-[#404040]/40` -> `bg-surface-3` (0.14 opacity — with backdrop-blur this provides a similar visible effect to the hardcoded gray)
- `rounded-12` -> `rounded-radius-md` (12px, same)
- `shadow-dialog` -> `shadow-elevation-lg` (cleaner elevation shadow)
- `text-15` -> `text-body-lg` (15px)
- `text-white` -> `text-text-primary` (0.90 — slightly less harsh than pure white)
- Keep `backdrop-blur-md`, `-tracking-4`

**Toast title (line ~23):**
Keep unchanged:
```
font-medium leading-[18px]
```
This is structural — no raw color/border tokens to migrate.

**Toast description (line ~24):**
Current:
```
opacity-60 leading-[18px]
```

New:
```
text-text-secondary leading-[18px]
```

Changes:
- `opacity-60` -> `text-text-secondary` (0.60 — same visual effect but using semantic token instead of generic opacity which affects the entire element)

**Icon glow (line ~54):**
Keep unchanged — the inline style `{color: hexColor, filter: 'drop-shadow(...)'}` uses hardcoded hex colors for status semantics (success green, error red, etc.). These are functional colors, not surface tokens.

**Do NOT change:**
- The sonner library integration
- The icon color hex values (success=#00AD79, info=#139EED, warning=#D7BF44, error=#F45A5A)
- The toast positioning/stacking (handled by sonner)
- Component exports or props
  </action>
  <verify>
Grep for `bg-surface-3` in toast.tsx to confirm semantic surface on container and close button.
Grep for `rounded-radius-md` in toast.tsx to confirm semantic radius.
Grep for `shadow-elevation-lg` in toast.tsx to confirm elevation shadow.
Grep for `text-body-lg` in toast.tsx to confirm semantic typography.
Grep for `text-text-primary` in toast.tsx to confirm semantic text color.
Grep for `text-text-secondary` in toast.tsx to confirm description uses semantic color instead of opacity.
Verify no instances of `bg-\\[#404040\\]` remain in toast.tsx.
Run `npx tsc --noEmit` in the ui package.
  </verify>
  <done>
Toast component uses semantic tokens: surface-3 for container and close button backgrounds, radius-md for corners, elevation-lg for shadow, body-lg for typography, text-primary/secondary for text hierarchy. Hardcoded hex background and opacity-60 hack eliminated.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate floating island base and container to semantic tokens</name>
  <files>livos/packages/ui/src/modules/floating-island/bare-island.tsx, livos/packages/ui/src/modules/floating-island/container.tsx</files>
  <action>
Update bare-island.tsx class strings and container.tsx positioning. Preserve the Framer Motion size animation system (the spring-based expand/collapse with hardcoded borderRadius values in JS). The island border-radius animation is in JS (sizes object), NOT in Tailwind classes — do not touch the sizes object.

**bare-island.tsx — island container (line ~89):**
Current:
```
relative select-none bg-black text-white shadow-floating-island
```

Keep unchanged. The island intentionally uses solid `bg-black` (not a surface token) for maximum contrast against any wallpaper. The `shadow-floating-island` is a component-specific complex inset shadow. The `text-white` is appropriate since the background is solid black (not semi-transparent).

**bare-island.tsx — close button (line ~107):**
Current:
```
absolute right-4 top-4 rounded-full bg-white/10 p-1 transition-colors hover:bg-white/20
```

New:
```
absolute right-4 top-4 rounded-full bg-surface-2 p-1 transition-colors hover:bg-surface-3
```

Changes:
- `bg-white/10` -> `bg-surface-2` (0.10, same value)
- `hover:bg-white/20` -> `hover:bg-surface-3` (0.14 vs 0.20 — slightly subtler hover, but within the island's solid black context this still provides adequate contrast)

**container.tsx — positioning (line ~50):**
Current:
```
fixed bottom-[76px] left-1/2 z-50 flex w-full -translate-x-1/2 flex-col items-center justify-center gap-1 md:bottom-[90px] md:flex-row md:items-baseline md:gap-2
```

The dock height is changing from 74px to 70px (Plan 02-01 reduces desktop padding from 12 to 10). The current positioning values include buffer space:
- Mobile: `bottom-[76px]` — dock is 48+8+8=64px + 10px bottom padding = 74px, so 76px gives 2px gap. With the padding unchanged on mobile, keep this.
- Desktop: `bottom-[90px]` — dock is 50+12+12=74px + 10px bottom = 84px, so 90px gives 6px gap. With new padding: 50+10+10=70px + 10px = 80px, so 90px gives 10px gap (acceptable, slightly more spacing).

The desktop positioning of `bottom-[90px]` is still fine with the new dock height — the islands will just have slightly more gap above the dock (10px instead of 6px), which actually looks cleaner. However, to maintain the tighter relationship, update to `bottom-[86px]`:

New:
```
fixed bottom-[76px] left-1/2 z-50 flex w-full -translate-x-1/2 flex-col items-center justify-center gap-1 md:bottom-[86px] md:flex-row md:items-baseline md:gap-2
```

Changes:
- `md:bottom-[90px]` -> `md:bottom-[86px]` (maintains ~6px gap above the new 80px dock+padding total)
- Keep `bottom-[76px]` for mobile (mobile dock dimensions unchanged)
- Keep all other positioning and layout classes

**IMPORTANT: Do NOT modify the `sizes` object in bare-island.tsx.** The border-radius animation values (minimized: 22, expanded: 32) are Framer Motion inline styles, not Tailwind classes. They cannot be migrated to semantic tokens because they are animated values interpolated by the spring system.

**Feature island content (uploading, backups, etc.):**
These files are NOT in scope for this plan. They are inside feature directories (features/files/, features/backups/) and will be migrated when those features are redesigned in later phases. Only the core bare-island.tsx and container.tsx are in scope.

**Do NOT change:**
- The Framer Motion animation system (spring stiffness:400, damping:30)
- The `sizes` object (minimized/expanded dimensions and borderRadius)
- AnimatePresence or scale entry/exit animations in container.tsx
- The solid `bg-black` on the island container
- The `shadow-floating-island` shadow
- Component exports or props
  </action>
  <verify>
Grep for `bg-surface-2` in bare-island.tsx to confirm close button surface token.
Grep for `hover:bg-surface-3` in bare-island.tsx to confirm close button hover.
Grep for `bg-black` in bare-island.tsx to confirm island background is still solid black.
Grep for `shadow-floating-island` in bare-island.tsx to confirm component shadow preserved.
Grep for `bottom-\\[86px\\]` in container.tsx to confirm adjusted desktop positioning.
Grep for `bottom-\\[76px\\]` in container.tsx to confirm mobile positioning unchanged.
Verify the `sizes` object in bare-island.tsx still has borderRadius values (22 and 32) unchanged.
Run `npx tsc --noEmit` in the ui package.
  </verify>
  <done>
Floating island close button uses semantic surface-2/surface-3 tokens. Island container desktop positioning adjusted from bottom-[90px] to bottom-[86px] to maintain consistent gap with the slimmer dock. Island core styling (bg-black, shadow-floating-island) preserved. Framer Motion animation system and sizes object untouched. Feature island content deferred to later phases.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes in ui package
2. Toast: `bg-surface-3`, `rounded-radius-md`, `shadow-elevation-lg`, `text-body-lg`, `text-text-primary`, `text-text-secondary`
3. Toast: no `bg-[#404040]` or `opacity-60` remaining
4. Island close button: `bg-surface-2`, `hover:bg-surface-3`
5. Island container: `bg-black` preserved, `shadow-floating-island` preserved
6. Island positioning: `md:bottom-[86px]` (adjusted for slimmer dock)
7. Island border-radius animation values (22, 32) in sizes object unchanged
8. All Framer Motion animations functional
9. Sonner toast integration unchanged
10. No changes to feature island content (features/files/, features/backups/)
</verification>

<success_criteria>
- Toast uses semantic tokens throughout (surface, radius, typography, text colors)
- Hardcoded hex background and opacity hack eliminated from toast
- Island close button migrated to semantic surface tokens
- Island container positioning adjusted for slimmer dock
- Island core identity preserved (solid black bg, floating-island shadow)
- Animation systems untouched (Framer Motion springs, sonner stacking)
- TypeScript compilation succeeds
- No changes to component behavior, props, or exports
</success_criteria>

<output>
After completion, create `.planning/phases/v1.1-02-desktop-shell/02-04-SUMMARY.md`
</output>

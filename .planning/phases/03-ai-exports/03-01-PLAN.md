---
phase: 03-ai-exports
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - nexus/packages/core/src/lib.ts
  - nexus/packages/core/package.json
autonomous: true

must_haves:
  truths:
    - "SubagentManager can be imported from @nexus/core/lib"
    - "ScheduleManager can be imported from @nexus/core/lib"
    - "AgentEvent type can be imported from @nexus/core/lib"
    - "Importing the library does NOT start the daemon"
  artifacts:
    - path: "nexus/packages/core/src/lib.ts"
      provides: "Library exports for external consumers"
      exports: ["SubagentManager", "ScheduleManager", "AgentEvent"]
    - path: "nexus/packages/core/package.json"
      provides: "Package exports configuration"
      contains: '"./lib"'
    - path: "nexus/packages/core/dist/lib.js"
      provides: "Compiled library entry point"
    - path: "nexus/packages/core/dist/lib.d.ts"
      provides: "TypeScript declarations for library"
  key_links:
    - from: "nexus/packages/core/src/lib.ts"
      to: "./subagent-manager.js"
      via: "re-export"
      pattern: "export.*SubagentManager.*from.*subagent-manager"
    - from: "nexus/packages/core/src/lib.ts"
      to: "./schedule-manager.js"
      via: "re-export"
      pattern: "export.*ScheduleManager.*from.*schedule-manager"
    - from: "nexus/packages/core/src/lib.ts"
      to: "./agent.js"
      via: "re-export"
      pattern: "export type.*AgentEvent.*from.*agent"
    - from: "nexus/packages/core/package.json"
      to: "./dist/lib.js"
      via: "exports field"
      pattern: '"./lib".*"./dist/lib.js"'
---

<objective>
Export SubagentManager, ScheduleManager, and AgentEvent from Nexus core package for external consumption.

Purpose: Enable LivOS to import AI managers directly from Nexus instead of maintaining duplicate code in livcoreai. This is the prerequisite for Phase 4's AI migration.

Output:
- `nexus/packages/core/src/lib.ts` - Safe library exports (no side effects)
- Updated `package.json` with exports field mapping `./lib` entry point
- Built `dist/lib.js` and `dist/lib.d.ts` for consumers
</objective>

<execution_context>
@C:\Users\hello\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\hello\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-ai-exports/03-RESEARCH.md

# Source files being exported
@nexus/packages/core/src/subagent-manager.ts
@nexus/packages/core/src/schedule-manager.ts
@nexus/packages/core/src/agent.ts
@nexus/packages/core/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create lib.ts library exports</name>
  <files>nexus/packages/core/src/lib.ts</files>
  <action>
Create a new file `nexus/packages/core/src/lib.ts` that re-exports the required components for external consumption.

Export the following:
1. **SubagentManager** class from `./subagent-manager.js`
2. **SubagentConfig** and **SubagentMessage** types from `./subagent-manager.js`
3. **ScheduleManager** class from `./schedule-manager.js`
4. **ScheduleJob** and **ScheduleJobData** types from `./schedule-manager.js`
5. **AgentEvent** type from `./agent.js`

IMPORTANT:
- Use `.js` extension in imports (ESM requirement, even for .ts source files)
- Use `export type` for interfaces/types to ensure they're erased at runtime
- Do NOT import anything from `./index.js` (that file has side effects - starts daemon)
- Keep the file minimal - only export what's needed for LivOS consumption
- Add a doc comment explaining this is the library entry point

Example structure:
```typescript
/**
 * @nexus/core library exports
 *
 * Safe to import without side effects. For daemon startup, import from '@nexus/core'.
 * For library usage: import { SubagentManager, ScheduleManager } from '@nexus/core/lib';
 */

// Managers
export { SubagentManager } from './subagent-manager.js';
export type { SubagentConfig, SubagentMessage } from './subagent-manager.js';

export { ScheduleManager } from './schedule-manager.js';
export type { ScheduleJob, ScheduleJobData } from './schedule-manager.js';

// Agent types
export type { AgentEvent } from './agent.js';
```
  </action>
  <verify>File exists at `nexus/packages/core/src/lib.ts` with exports for SubagentManager, ScheduleManager, and AgentEvent</verify>
  <done>lib.ts contains re-exports for all three required components using proper ESM syntax</done>
</task>

<task type="auto">
  <name>Task 2: Update package.json exports field</name>
  <files>nexus/packages/core/package.json</files>
  <action>
Update `nexus/packages/core/package.json` to add the `exports` field that exposes both the daemon entry point and the new library exports.

Add the following to package.json:
1. Add `"types": "dist/index.d.ts"` at the top level (for TypeScript)
2. Add `"exports"` field with two entry points:
   - `"."` - Points to the daemon (existing index.js)
   - `"./lib"` - Points to the new library exports

The exports field structure:
```json
{
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "import": "./dist/index.js"
    },
    "./lib": {
      "types": "./dist/lib.d.ts",
      "import": "./dist/lib.js"
    }
  }
}
```

IMPORTANT:
- Keep all existing fields (name, version, main, type, scripts, dependencies, devDependencies)
- Add `types` field at root level pointing to `dist/index.d.ts`
- The `exports` field provides explicit entry points for modern Node.js resolution
- Both entries need `types` condition for TypeScript to find declarations
  </action>
  <verify>package.json contains `exports` field with `"."` and `"./lib"` entries, each having `types` and `import` conditions</verify>
  <done>package.json updated with exports field mapping both daemon and library entry points</done>
</task>

<task type="auto">
  <name>Task 3: Build and verify exports</name>
  <files>nexus/packages/core/dist/lib.js, nexus/packages/core/dist/lib.d.ts</files>
  <action>
Build the Nexus core package to generate the compiled library files and verify the exports work correctly.

Steps:
1. Navigate to nexus/packages/core directory
2. Run `pnpm build` (which runs `tsc`)
3. Verify `dist/lib.js` was generated
4. Verify `dist/lib.d.ts` was generated with proper type exports
5. Verify the types file contains exports for SubagentManager, ScheduleManager, and AgentEvent

Verification commands:
```bash
cd nexus/packages/core
pnpm build
# Check files exist
ls -la dist/lib.*
# Check type declarations contain expected exports
grep -E "SubagentManager|ScheduleManager|AgentEvent" dist/lib.d.ts
```

IMPORTANT:
- The build must succeed without TypeScript errors
- dist/lib.d.ts must contain type declarations for all exported items
- If build fails, check for import path issues (missing .js extensions)
  </action>
  <verify>
Run `pnpm build` in nexus/packages/core - must succeed.
Run `ls nexus/packages/core/dist/lib.*` - must show lib.js and lib.d.ts.
Run `grep -E "SubagentManager|ScheduleManager|AgentEvent" nexus/packages/core/dist/lib.d.ts` - must show all three.
  </verify>
  <done>Build succeeds, dist/lib.js and dist/lib.d.ts exist with all three exports</done>
</task>

</tasks>

<verification>
Phase verification (run after all tasks):

1. **File existence:**
   - [ ] `nexus/packages/core/src/lib.ts` exists
   - [ ] `nexus/packages/core/dist/lib.js` exists
   - [ ] `nexus/packages/core/dist/lib.d.ts` exists

2. **Package.json correctness:**
   - [ ] `exports` field has `"."` entry
   - [ ] `exports` field has `"./lib"` entry
   - [ ] Both entries have `types` and `import` conditions

3. **Type declarations:**
   - [ ] `dist/lib.d.ts` exports SubagentManager
   - [ ] `dist/lib.d.ts` exports ScheduleManager
   - [ ] `dist/lib.d.ts` exports AgentEvent type

4. **No side effects:**
   - [ ] lib.ts does NOT import from index.ts
   - [ ] Importing lib.ts does not start the daemon
</verification>

<success_criteria>
- SubagentManager class is exported from `@nexus/core/lib`
- ScheduleManager class is exported from `@nexus/core/lib`
- AgentEvent type is exported from `@nexus/core/lib`
- TypeScript declarations (.d.ts) are generated for all exports
- Package.json exports field enables clean imports via `@nexus/core/lib`
- Importing the library does NOT trigger daemon startup (no side effects)
</success_criteria>

<output>
After completion, create `.planning/phases/03-ai-exports/03-01-SUMMARY.md` with:
- Files created/modified
- Build output confirmation
- Exported types list
- Any issues encountered
</output>

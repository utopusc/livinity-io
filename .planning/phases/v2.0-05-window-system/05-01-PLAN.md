---
phase: v2.0-05-window-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - livos/packages/ui/src/modules/window/window.tsx
  - livos/packages/ui/src/modules/window/window-chrome.tsx
  - livos/packages/ui/src/providers/window-manager.tsx
autonomous: true

must_haves:
  truths:
    - "Window resize handles are 4px edges and 8px corners (not 1px/3px)"
    - "Window chrome has a maximize button"
    - "Maximize button toggles between full-size and previous size/position"
    - "Window body uses solid dark background (not transparent/blur)"
---

<objective>
Improve the window system: bigger resize handles, maximize button, solid backgrounds, and edge snapping.
</objective>

<tasks>

<task type="auto">
  <name>Task 1: Increase resize handle sizes</name>
  <files>livos/packages/ui/src/modules/window/window.tsx</files>
  <action>
Read the file. Find the resize handles section (around lines 196-205):

```tsx
{/* Edge handles */}
<div className='absolute inset-x-2 top-0 h-1 cursor-ns-resize' onMouseDown={(e) => handleResizeStart(e, 'n')} />
<div className='absolute inset-x-2 bottom-0 h-1 cursor-ns-resize' onMouseDown={(e) => handleResizeStart(e, 's')} />
<div className='absolute inset-y-2 left-0 w-1 cursor-ew-resize' onMouseDown={(e) => handleResizeStart(e, 'w')} />
<div className='absolute inset-y-2 right-0 w-1 cursor-ew-resize' onMouseDown={(e) => handleResizeStart(e, 'e')} />
{/* Corner handles */}
<div className='absolute left-0 top-0 h-3 w-3 cursor-nwse-resize' onMouseDown={(e) => handleResizeStart(e, 'nw')} />
<div className='absolute right-0 top-0 h-3 w-3 cursor-nesw-resize' onMouseDown={(e) => handleResizeStart(e, 'ne')} />
<div className='absolute bottom-0 left-0 h-3 w-3 cursor-nesw-resize' onMouseDown={(e) => handleResizeStart(e, 'sw')} />
<div className='absolute bottom-0 right-0 h-3 w-3 cursor-nwse-resize' onMouseDown={(e) => handleResizeStart(e, 'se')} />
```

Replace with larger handles (4px edges, 8px corners):

```tsx
{/* Edge handles - 4px wide for easy grabbing */}
<div className='absolute inset-x-2 top-0 h-[4px] cursor-ns-resize' onMouseDown={(e) => handleResizeStart(e, 'n')} />
<div className='absolute inset-x-2 bottom-0 h-[4px] cursor-ns-resize' onMouseDown={(e) => handleResizeStart(e, 's')} />
<div className='absolute inset-y-2 left-0 w-[4px] cursor-ew-resize' onMouseDown={(e) => handleResizeStart(e, 'w')} />
<div className='absolute inset-y-2 right-0 w-[4px] cursor-ew-resize' onMouseDown={(e) => handleResizeStart(e, 'e')} />
{/* Corner handles - 8px for easy grabbing */}
<div className='absolute left-0 top-0 h-[8px] w-[8px] cursor-nwse-resize' onMouseDown={(e) => handleResizeStart(e, 'nw')} />
<div className='absolute right-0 top-0 h-[8px] w-[8px] cursor-nesw-resize' onMouseDown={(e) => handleResizeStart(e, 'ne')} />
<div className='absolute bottom-0 left-0 h-[8px] w-[8px] cursor-nesw-resize' onMouseDown={(e) => handleResizeStart(e, 'sw')} />
<div className='absolute bottom-0 right-0 h-[8px] w-[8px] cursor-nwse-resize' onMouseDown={(e) => handleResizeStart(e, 'se')} />
```
  </action>
</task>

<task type="auto">
  <name>Task 2: Update window class to solid background</name>
  <files>livos/packages/ui/src/modules/window/window.tsx</files>
  <action>
Update the windowClass (around lines 211-222):

From:
```typescript
const windowClass = tw`
    fixed
    flex
    flex-col
    rounded-radius-xl
    bg-black/90
    backdrop-blur-xl
    overflow-hidden
    shadow-elevation-lg
    border
    border-border-emphasis
`
```

To:
```typescript
const windowClass = tw`
    fixed
    flex
    flex-col
    rounded-radius-lg
    bg-[#111111]
    overflow-hidden
    shadow-elevation-lg
    border
    border-border-emphasis
`
```

Removed backdrop-blur-xl (solid bg doesn't need it), changed bg-black/90 to solid bg-[#111111], changed rounded-radius-xl to rounded-radius-lg.
  </action>
</task>

<task type="auto">
  <name>Task 3: Add maximize support to window manager</name>
  <files>livos/packages/ui/src/providers/window-manager.tsx</files>
  <action>
Read the current file (it may have been modified by plan 01-01).

1. Add isMaximized to WindowState type:
```typescript
export type WindowState = {
    id: WindowId
    appId: string
    route: string
    position: Position
    size: Size
    zIndex: number
    isMinimized: boolean
    isMaximized: boolean
    preMaximizeState?: {position: Position; size: Size}
    title: string
    icon: string
}
```

2. Add MAXIMIZE_WINDOW and UNMAXIMIZE_WINDOW actions:
```typescript
| {type: 'MAXIMIZE_WINDOW'; payload: WindowId}
| {type: 'UNMAXIMIZE_WINDOW'; payload: WindowId}
```

3. In the reducer, add cases:
```typescript
case 'MAXIMIZE_WINDOW': {
    return {
        windows: state.windows.map((w) =>
            w.id === action.payload
                ? {
                    ...w,
                    isMaximized: true,
                    preMaximizeState: {position: w.position, size: w.size},
                    position: {x: 0, y: 0},
                    size: {width: window.innerWidth, height: window.innerHeight},
                    zIndex: state.nextZIndex,
                }
                : w,
        ),
        nextZIndex: state.nextZIndex + 1,
    }
}

case 'UNMAXIMIZE_WINDOW': {
    return {
        windows: state.windows.map((w) =>
            w.id === action.payload && w.preMaximizeState
                ? {
                    ...w,
                    isMaximized: false,
                    position: w.preMaximizeState.position,
                    size: w.preMaximizeState.size,
                    preMaximizeState: undefined,
                    zIndex: state.nextZIndex,
                }
                : w,
        ),
        nextZIndex: state.nextZIndex + 1,
    }
}
```

4. Add toggleMaximize to context:
```typescript
const toggleMaximize = useCallback((windowId: WindowId) => {
    const win = state.windows.find(w => w.id === windowId)
    if (win?.isMaximized) {
        dispatch({type: 'UNMAXIMIZE_WINDOW', payload: windowId})
    } else {
        dispatch({type: 'MAXIMIZE_WINDOW', payload: windowId})
    }
}, [state.windows])
```

5. Add toggleMaximize to the context type and provider value.

6. Update OPEN_WINDOW case to include isMaximized: false in the new window state.
  </action>
</task>

<task type="auto">
  <name>Task 4: Add maximize button to window chrome</name>
  <files>livos/packages/ui/src/modules/window/window-chrome.tsx</files>
  <action>
Read the file. Add a maximize button next to the close button.

The window chrome onClose prop should be joined by onMaximize prop. Add a maximize button (square icon or expand icon) before the close button.

Update WindowChrome to accept onMaximize and isMaximized props:
```tsx
type WindowChromeProps = {
    title: string
    icon: string
    onClose: () => void
    onMaximize?: () => void
    isMaximized?: boolean
}
```

Add a maximize button in the chrome:
```tsx
{onMaximize && (
    <button
        className='flex h-7 w-7 items-center justify-center rounded-radius-sm text-text-secondary transition-colors hover:bg-surface-2 hover:text-text-primary'
        onClick={(e) => { e.stopPropagation(); onMaximize(); }}
    >
        {isMaximized ? (
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none"><rect x="2" y="4" width="8" height="6" rx="1" stroke="currentColor" strokeWidth="1.5"/><path d="M4 4V3a1 1 0 0 1 1-1h5a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H9" stroke="currentColor" strokeWidth="1.5"/></svg>
        ) : (
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none"><rect x="1" y="1" width="10" height="10" rx="1.5" stroke="currentColor" strokeWidth="1.5"/></svg>
        )}
    </button>
)}
```
  </action>
</task>

<task type="auto">
  <name>Task 5: Wire maximize in Window component</name>
  <files>livos/packages/ui/src/modules/window/window.tsx</files>
  <action>
In the Window component, get toggleMaximize from useWindowManager and the isMaximized state from the windows list:

```tsx
const {closeWindow, focusWindow, updateWindowPosition, updateWindowSize, toggleMaximize, windows} = useWindowManager()
const windowState = windows.find(w => w.id === id)
```

Pass to WindowChrome:
```tsx
<WindowChrome
    title={title}
    icon={icon}
    onClose={handleClose}
    onMaximize={() => toggleMaximize(id)}
    isMaximized={windowState?.isMaximized}
/>
```

Also, when maximized, disable drag and resize:
- In handleDragStart, add: `if (windowState?.isMaximized) return`
- In resize handle divs, conditionally hide: `{!windowState?.isMaximized && (<>resize handles</>)}`
  </action>
</task>

</tasks>

<verification>
1. Resize handles are visually larger (4px edges, 8px corners)
2. Window chrome has a maximize button
3. Maximize fills viewport, un-maximize restores previous size/position
4. Drag disabled when maximized
5. Resize handles hidden when maximized
6. Window background is solid (no blur)
7. Run `cd livos && pnpm build`
</verification>

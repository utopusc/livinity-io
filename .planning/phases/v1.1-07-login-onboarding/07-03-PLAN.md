---
phase: 07-login-onboarding
plan: 03
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - livos/packages/ui/src/routes/onboarding/restore.tsx
  - livos/packages/ui/app-auth/src/login-with-livinity.tsx
autonomous: true

must_haves:
  truths:
    - "Restore flow shows step indicator reflecting current internal step (0-3)"
    - "Restore flow back button and backup snapshots use semantic tokens"
    - "App-auth login page uses semantic tokens instead of raw values"
    - "Both main and app-auth builds compile successfully"
  artifacts:
    - path: "livos/packages/ui/src/routes/onboarding/restore.tsx"
      provides: "Restore onboarding page with StepIndicator and semantic tokens"
      contains: "StepIndicator"
    - path: "livos/packages/ui/app-auth/src/login-with-livinity.tsx"
      provides: "App-auth login page with semantic tokens"
      contains: "text-heading-sm"
  key_links:
    - from: "livos/packages/ui/src/routes/onboarding/restore.tsx"
      to: "livos/packages/ui/src/components/ui/step-indicator.tsx"
      via: "Import and render StepIndicator with steps=4 currentStep=step"
      pattern: "StepIndicator.*steps.*4"
    - from: "livos/packages/ui/app-auth/src/login-with-livinity.tsx"
      to: "livos/packages/ui/src/components/ui/pin-input.tsx"
      via: "Imports PinInput for 2FA step"
      pattern: "PinInput"
---

<objective>
Migrate the restore onboarding flow (restore.tsx) and the standalone app-auth login page (login-with-livinity.tsx) to semantic design tokens, and add step indicators to the restore flow.

Purpose: restore.tsx is the most complex auth page (353 lines, 4 internal steps, inline navigation) with the most raw values. app-auth is a separate build entry that must maintain visual consistency with the main login. Both need semantic token migration to complete the auth page redesign.
Output: Updated restore.tsx with StepIndicator, semantic BackupSnapshot styling, and semantic back/continue buttons. Updated login-with-livinity.tsx with semantic card, text, and layout tokens.
</objective>

<execution_context>
@C:\Users\hello\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\hello\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP-v1.1.md
@.planning/STATE.md

@livos/packages/ui/src/routes/onboarding/restore.tsx
@livos/packages/ui/app-auth/src/login-with-livinity.tsx
@livos/packages/ui/src/layouts/bare/shared.tsx
@.planning/phases/v1.1-07-login-onboarding/07-RESEARCH.md
@.planning/phases/v1.1-07-login-onboarding/07-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate restore.tsx with StepIndicator and semantic tokens</name>
  <files>livos/packages/ui/src/routes/onboarding/restore.tsx</files>
  <action>
Add StepIndicator and migrate all raw Tailwind values to semantic tokens.

**1. Add StepIndicator to Layout:**
Import `StepIndicator` from `@/components/ui/step-indicator`.
Pass step indicator to Layout:
```tsx
<Layout
  title={title}
  transitionTitle={false}
  subTitle={stepSubtitle}
  subTitleMaxWidth={630}
  footer={<OnboardingFooter action={OnboardingAction.CREATE_ACCOUNT} />}
  stepIndicator={<StepIndicator steps={4} currentStep={step} />}
>
```
The `step` state variable is already a 0-indexed enum (ChooseLocation=0, Password=1, Backups=2, Review=3), which maps directly to StepIndicator's `currentStep` prop.

**2. Migrate the inline back button (around line 222-228):**
Current:
```tsx
className='flex size-10 items-center justify-center rounded-full border border-white/10 bg-white/5 transition-colors duration-300 hover:bg-white/10 focus-visible:border-white/50 focus-visible:bg-white/10 focus-visible:outline-none'
```
Replace with semantic tokens:
```tsx
className='flex size-10 items-center justify-center rounded-full border border-border-default bg-surface-base transition-colors duration-300 hover:bg-surface-2 focus-visible:border-brand focus-visible:bg-surface-2 focus-visible:outline-none'
```
Token mapping:
- `border-white/10` -> `border-border-default`
- `bg-white/5` -> `bg-surface-base`
- `hover:bg-white/10` -> `hover:bg-surface-2`
- `focus-visible:border-white/50` -> `focus-visible:border-brand` (brand focus pattern)
- `focus-visible:bg-white/10` -> `focus-visible:bg-surface-2`

**3. Migrate loading state (Backups step, ~line 168):**
- `text-white/70` -> `text-text-secondary`

**4. Migrate empty state (Backups step, ~line 173):**
- `text-xs` -> `text-caption`
- `opacity-60` -> replace class entirely: use `text-caption text-text-secondary` (combines typography and color)

**5. Migrate review step text (~line 200):**
- `text-sm` -> `text-body`

**6. Migrate BackupSnapshot component (lines 305-353):**
Apply these token replacements to the BackupSnapshot function:
- `rounded-8` -> `rounded-radius-sm`
- `border-white/10` (unselected) -> `border-border-default`
- `hover:bg-white/5` -> `hover:bg-surface-base`
- `text-sm` (date label) -> `text-body`
- `bg-white/10` (badge bg) -> `bg-surface-2`
- `text-[10px]` (badge text) -> `text-caption-sm` (11px, close enough — research notes text-[10px] is below caption-sm but consistent with prior decision v1.1-02-03 to keep `text-[10px]` on mobile FrequentApp, however here in onboarding there's enough space for 11px, so use `text-caption-sm`)
- `opacity-80` (badge) -> remove, use `text-text-secondary` instead (combines opacity and color)
- Keep: `border-brand bg-brand/15` on selected state — this is correct brand token usage
- Keep: `cursor-pointer`, `noHover` logic, layout structure

Convert the BackupSnapshot className array `.join(' ')` pattern to `cn()` utility:
```tsx
className={cn(
  'flex w-full items-center justify-between rounded-radius-sm border px-4 py-3',
  selected ? 'border-brand bg-brand/15' : 'border-border-default',
  !noHover && !selected && 'hover:bg-surface-base',
  onClick && 'cursor-pointer',
)}
```
Import `cn` from `@/shadcn-lib/utils` (it may already be imported, check first).

Do NOT change: form structure, MiniBrowser/AddNetworkShareDialog integration, step state machine logic, `canNext` validation, `handleNext` function, backup data fetching hooks.
  </action>
  <verify>
Run `npx tsc --noEmit` from `livos/packages/ui/`.
Grep restore.tsx for `white/10`, `white/5`, `white/70`, `text-xs`, `text-sm` (excluding import lines), `opacity-60`, `opacity-80`, `rounded-8`, `text-[10px]` — should find none.
Grep restore.tsx for `StepIndicator` — should find import and usage.
  </verify>
  <done>
restore.tsx has StepIndicator with steps=4 and currentStep=step (dynamic). Back button uses border-border-default/bg-surface-base/focus-visible:border-brand. BackupSnapshot uses cn(), rounded-radius-sm, border-border-default, bg-surface-2 badges, text-text-secondary. Loading/empty states use semantic tokens.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate app-auth login-with-livinity.tsx to semantic tokens</name>
  <files>livos/packages/ui/app-auth/src/login-with-livinity.tsx</files>
  <action>
Migrate the standalone app-auth login page to semantic tokens for visual consistency with the main login.

**LoginWithLayout card styling (~line 205-209):**
Current:
```tsx
className={cn(
  'w-full rounded-20 bg-dialog-content/70 p-8 shadow-dialog sm:max-w-[480px]',
  'flex flex-col gap-5',
  'duration-200 ease-out animate-in fade-in zoom-in-90',
)}
```
Replace:
- `rounded-20` -> `rounded-radius-xl` (20px -> 20px, semantic match)
- `bg-dialog-content/70` -> keep as-is — this uses the dialog content variable with transparency, which is a semantic token from Phase 3 dialog system
- `shadow-dialog` -> `shadow-elevation-lg` (consistent with Phase 3 dialog pattern)
- Keep: `p-8`, `sm:max-w-[480px]`, `flex flex-col gap-5`, animation classes

**App icons (~line 212-213):**
- `rounded-12` -> `rounded-radius-md` (12px -> 12px semantic match)
- Keep: `bg-neutral-600` on second AppIcon (placeholder app icon background, domain-specific)

**Title text (~line 216):**
- `text-17` -> `text-heading-sm` (17px -> 17px semantic match)
- Keep: `font-semibold`, `leading-tight`, `-tracking-2`, `truncate`

**Description text (~line 219):**
- `text-13` -> `text-body-sm` (13px semantic match)
- `text-white/40` -> `text-text-tertiary` (0.40 opacity -> semantic tertiary)
- Keep: `leading-tight`, `-tracking-2`

**Button text (~line 65):**
- `text-13` -> `text-body-sm`

**Wallpaper overlay (~line 201):**
- `bg-black/50` -> keep as-is (intentional overlay, same as DarkenLayer convention)
- Keep inline wallpaper fetching (app-auth doesn't have access to main app's Wallpaper provider)

**Verify both builds compile after changes:**
The app-auth build uses a separate vite config at `app-auth/vite.config.ts` that aliases `@/` to the main `src/`. Changes to shared components in `src/` (like pin-input.tsx from Plan 02) are automatically available. Ensure this file's imports still resolve.

Do NOT change: useLogin fetch logic, useApp, useWallpaperId, form submission, PinInput usage, query parameter handling.
  </action>
  <verify>
Run `npx tsc --noEmit` from `livos/packages/ui/`.
Run `npx vite build --config app-auth/vite.config.ts` from `livos/packages/ui/` to verify the app-auth build compiles (or the project-specific build command for app-auth if different — check package.json for an `app-auth:build` script).
Grep login-with-livinity.tsx for `text-17`, `text-13`, `text-white/40`, `rounded-20`, `rounded-12`, `shadow-dialog` — should find none.
  </verify>
  <done>
app-auth login page uses semantic tokens: text-heading-sm, text-body-sm, text-text-tertiary, rounded-radius-xl, rounded-radius-md, shadow-elevation-lg. Both main and app-auth builds compile. Visual consistency with main login page maintained.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes from livos/packages/ui/
2. `pnpm run build` succeeds for both main and app-auth builds
3. restore.tsx has StepIndicator with 4 steps
4. restore.tsx BackupSnapshot uses cn() with semantic tokens
5. login-with-livinity.tsx uses semantic typography and radius tokens
6. No raw white/XX opacity values remain in either file
</verification>

<success_criteria>
- Restore flow shows dynamic step indicator (4 steps) matching internal Step enum state
- Restore back button uses semantic tokens with brand focus pattern
- BackupSnapshot component uses cn(), rounded-radius-sm, border-border-default, bg-surface-2
- app-auth card uses rounded-radius-xl, shadow-elevation-lg
- app-auth text uses text-heading-sm, text-body-sm, text-text-tertiary
- Both main build and app-auth build compile successfully
</success_criteria>

<output>
After completion, create `.planning/phases/v1.1-07-login-onboarding/07-03-SUMMARY.md`
</output>

---
phase: 07-login-onboarding
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - livos/packages/ui/src/routes/login.tsx
  - livos/packages/ui/src/components/ui/pin-input.tsx
  - livos/packages/ui/src/routes/onboarding/index.tsx
  - livos/packages/ui/src/routes/onboarding/create-account.tsx
  - livos/packages/ui/src/routes/onboarding/account-created.tsx
autonomous: true

must_haves:
  truths:
    - "Login page uses brand-themed button and semantic form spacing"
    - "2FA step has a back button to return to password step"
    - "PinInput segments use semantic tokens instead of raw white/hex values"
    - "Onboarding pages show step indicators reflecting current position in the flow"
    - "Account created page uses semantic tokens for ToS text"
  artifacts:
    - path: "livos/packages/ui/src/routes/login.tsx"
      provides: "Login page with brand button, 2FA back navigation"
      contains: "secondaryButtonClasss"
    - path: "livos/packages/ui/src/components/ui/pin-input.tsx"
      provides: "PinInput with semantic token styling"
      contains: "border-border-emphasis"
    - path: "livos/packages/ui/src/routes/onboarding/index.tsx"
      provides: "Onboarding start page with StepIndicator"
      contains: "StepIndicator"
    - path: "livos/packages/ui/src/routes/onboarding/create-account.tsx"
      provides: "Create account page with StepIndicator"
      contains: "StepIndicator"
    - path: "livos/packages/ui/src/routes/onboarding/account-created.tsx"
      provides: "Account created page with StepIndicator and semantic tokens"
      contains: "StepIndicator"
  key_links:
    - from: "livos/packages/ui/src/routes/onboarding/index.tsx"
      to: "livos/packages/ui/src/components/ui/step-indicator.tsx"
      via: "Import and render StepIndicator with steps=3 currentStep=0"
      pattern: "StepIndicator.*steps.*3.*currentStep.*0"
    - from: "livos/packages/ui/src/routes/login.tsx"
      to: "livos/packages/ui/src/layouts/bare/shared.tsx"
      via: "Imports buttonClass, secondaryButtonClasss, formGroupClass"
      pattern: "secondaryButtonClasss"
---

<objective>
Redesign the login page (LO-01), PinInput component (LO-04), and onboarding flow pages (LO-02, LO-03) with semantic tokens, step indicators, and improved 2FA UX.

Purpose: These are the user-facing auth pages. The login page gets a brand-themed button and improved 2FA step with back navigation. The PinInput gets semantic token styling. The onboarding flow gets step indicators showing users where they are in the process.
Output: Updated login.tsx, pin-input.tsx, and three onboarding page files with semantic tokens and StepIndicator integration.
</objective>

<execution_context>
@C:\Users\hello\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\hello\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP-v1.1.md
@.planning/STATE.md

@livos/packages/ui/src/routes/login.tsx
@livos/packages/ui/src/components/ui/pin-input.tsx
@livos/packages/ui/src/routes/onboarding/index.tsx
@livos/packages/ui/src/routes/onboarding/create-account.tsx
@livos/packages/ui/src/routes/onboarding/account-created.tsx
@livos/packages/ui/src/layouts/bare/shared.tsx
@.planning/phases/v1.1-07-login-onboarding/07-RESEARCH.md
@.planning/phases/v1.1-07-login-onboarding/07-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Redesign login page and PinInput component</name>
  <files>
    livos/packages/ui/src/routes/login.tsx
    livos/packages/ui/src/components/ui/pin-input.tsx
  </files>
  <action>
**login.tsx changes:**

1. Import `secondaryButtonClasss` from shared.tsx (in addition to existing `buttonClass`).

2. Password step — no structural changes needed. The form already uses `formGroupClass` and `buttonClass`. Since Plan 01 migrated `buttonClass` to `bg-brand`, this step automatically inherits the brand button.

3. 2FA step — add a back button below the PinInput:
```tsx
case '2fa': {
  return (
    <Layout title={t('login-2fa.title')} subTitle={t('login-2fa.subtitle')}>
      <div className='flex w-full flex-col items-center gap-6 px-4 md:px-0'>
        <PinInput autoFocus length={6} onCodeCheck={handleSubmit2fa} />
        <button
          type='button'
          className={secondaryButtonClasss}
          onClick={() => setStep('password')}
        >
          {t('back')}
        </button>
      </div>
    </Layout>
  )
}
```
- Change the wrapping from `<form>` to a `<div>` for the 2FA step (PinInput auto-submits, no form submission needed; the existing form wrapping is redundant and its `onSubmit` calls `handleSubmitPassword` which is wrong for the 2FA step)
- Add `gap-6` (24px) between PinInput and back button for clean spacing
- Use `secondaryButtonClasss` for the back button (secondary action, not primary)

**pin-input.tsx changes:**

Migrate all raw color/radius values to semantic tokens:

1. `dotClass`:
   - `bg-[#D9D9D9]/10` -> `bg-surface-2` (more visible placeholder dot)

2. `renderSegment` callback — update class strings:
   - `baseClassName`: `border-white/20` -> `border-border-emphasis`, `rounded-8` -> `rounded-radius-sm`
   - `activeClassName`: `bg-white/5` -> `bg-surface-base`
   - Keep `[--segment-color:#fff]` — this is a CSS variable for the caret/selection color, and white is correct on dark backgrounds
   - Keep `data-[state]:border-[var(--segment-color)]` — dynamic border, not a static token

3. `caretClassName`:
   - `bg-white` -> `bg-text-primary` (semantic equivalent for caret color on dark background)
   - Keep animation and sizing

4. `selectionClassName`:
   - Keep `bg-[var(--segment-color)]` and `opacity-[0.15625]` — these are part of the rci selection rendering, not generic surface values

5. Improve error feedback duration:
   - Change the error recovery timeout from `500` ms to `800` ms — gives users more time to recognize the error before the input clears and refocuses
   - This is a UX improvement (LO-04): the current 500ms is too fast for users to understand what happened

6. Keep: `padding` (12px), `spacing` (10px), `caret-transparent`, `selection:bg-transparent`, `animate-shake`, all rci library integration, `autoComplete='one-time-code'`, `inputMode='numeric'`.

Do NOT change: the rci library usage, the CodeInput component, the state machine (input/loading/error/success), the onChange auto-submit logic, the loadingClassName pulse animation.
  </action>
  <verify>
Run `npx tsc --noEmit` from `livos/packages/ui/`.
Grep pin-input.tsx for `white/20`, `#D9D9D9`, `rounded-8` — should find none.
Grep login.tsx for `secondaryButtonClasss` — should find the back button usage.
  </verify>
  <done>
Login page has back button on 2FA step using secondaryButtonClasss. PinInput uses semantic tokens (border-border-emphasis, bg-surface-base, bg-surface-2 for dots, rounded-radius-sm). Error feedback duration increased to 800ms.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add StepIndicator to onboarding pages</name>
  <files>
    livos/packages/ui/src/routes/onboarding/index.tsx
    livos/packages/ui/src/routes/onboarding/create-account.tsx
    livos/packages/ui/src/routes/onboarding/account-created.tsx
  </files>
  <action>
Add StepIndicator to the three-page onboarding create flow. The flow is: Start (step 0) -> Create Account (step 1) -> Account Created (step 2). Total: 3 steps.

**onboarding/index.tsx (OnboardingStart):**
1. Import `StepIndicator` from `@/components/ui/step-indicator`
2. Add `stepIndicator` prop to `<Layout>`:
```tsx
<Layout
  title={title}
  transitionTitle={false}
  subTitle={t('onboarding.start.subtitle')}
  subTitleMaxWidth={500}
  footer={<OnboardingFooter action={OnboardingAction.RESTORE} />}
  stepIndicator={<StepIndicator steps={3} currentStep={0} />}
>
```
No other changes needed — the page is already clean.

**onboarding/create-account.tsx (CreateAccount):**
1. Import `StepIndicator` from `@/components/ui/step-indicator`
2. Add `stepIndicator` prop to `<Layout>`:
```tsx
<Layout
  title={title}
  transitionTitle={false}
  subTitle={t('onboarding.create-account.subtitle')}
  subTitleMaxWidth={630}
  footer={<OnboardingFooter action={OnboardingAction.RESTORE} />}
  stepIndicator={<StepIndicator steps={3} currentStep={1} />}
>
```
3. Migrate the error spacer: `-my-2.5` -> `-my-2` (standardize to Tailwind scale, 8px vs 10px — negligible visual difference, cleaner value)
No other changes — the page already uses `formGroupClass` and `buttonClass` which were migrated in Plan 01.

**onboarding/account-created.tsx (AccountCreated):**
1. Import `StepIndicator` from `@/components/ui/step-indicator`
2. Add `stepIndicator` prop to `<Layout>`:
```tsx
<Layout
  title={t('onboarding.account-created.youre-all-set-name', {name})}
  subTitle={t('onboarding.account-created.subtitle')}
  subTitleMaxWidth={470}
  stepIndicator={<StepIndicator steps={3} currentStep={2} />}
  footer={...}
>
```
3. Migrate ToS text raw values:
   - `text-xs` -> `text-caption` (12px semantic match)
   - `opacity-70` -> replace with `text-text-secondary` (0.60 opacity semantic token, slightly more muted but consistent)
   - `mb-2` on the button Link — keep as-is (spacing between button and ToS text)

Do NOT change: view transition links, footer content, auth logic, form validation, useEffect focus logic.
  </action>
  <verify>
Run `npx tsc --noEmit` from `livos/packages/ui/`.
Grep each file for `StepIndicator` — should find import and usage in all three.
Grep account-created.tsx for `opacity-70`, `text-xs` — should find none.
  </verify>
  <done>
All three onboarding pages show StepIndicator: Start (step 0/3), Create Account (step 1/3), Account Created (step 2/3). Account-created.tsx uses text-caption and text-text-secondary instead of raw values. Create-account.tsx error spacer standardized.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes from livos/packages/ui/
2. `pnpm run build` succeeds (or `npx vite build`)
3. Login 2FA step has back button with secondaryButtonClasss
4. PinInput has no raw white/hex color values
5. All three onboarding pages render StepIndicator with correct step numbers
6. No raw opacity-XX or text-xs values remain in account-created.tsx
</verification>

<success_criteria>
- Login page 2FA step has back button allowing return to password step
- PinInput segments use border-border-emphasis, bg-surface-base, rounded-radius-sm
- PinInput dot placeholder uses bg-surface-2 (more visible)
- PinInput error recovery is 800ms (up from 500ms)
- OnboardingStart shows step 0 of 3
- CreateAccount shows step 1 of 3
- AccountCreated shows step 2 of 3, with semantic text tokens
</success_criteria>

<output>
After completion, create `.planning/phases/v1.1-07-login-onboarding/07-02-SUMMARY.md`
</output>
